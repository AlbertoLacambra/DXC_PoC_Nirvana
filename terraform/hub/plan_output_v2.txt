time=2025-10-13T19:00:22+02:00 level=warning msg=No double-slash (//) found in source URL /mnt/c/PROYECTS/DXC_PoC_Nirvana/terraform/environments/hub. Relative paths in downloaded Terraform code may not work.
[0m[1mdata.azurerm_resource_group.dify: Reading...[0m[0m
[0m[1mdata.azurerm_resource_group.dify: Read complete after 1s [id=/subscriptions/739aaf91-5cb2-45a6-ab4f-abf883e9d3f7/resourceGroups/dify-rg][0m
[0m[1mdata.azurerm_virtual_network.dify_vnet: Reading...[0m[0m
[0m[1mdata.azurerm_kubernetes_cluster.dify_aks: Reading...[0m[0m
[0m[1mdata.azurerm_key_vault.dify_kv: Reading...[0m[0m
[0m[1mdata.azurerm_postgresql_flexible_server.dify_postgres: Reading...[0m[0m
[0m[1mdata.azurerm_storage_account.dify_storage: Reading...[0m[0m
[0m[1mdata.azurerm_virtual_network.dify_vnet: Read complete after 1s [id=/subscriptions/739aaf91-5cb2-45a6-ab4f-abf883e9d3f7/resourceGroups/dify-rg/providers/Microsoft.Network/virtualNetworks/dify-private-vnet][0m
[0m[1mdata.azurerm_postgresql_flexible_server.dify_postgres: Read complete after 1s [id=/subscriptions/739aaf91-5cb2-45a6-ab4f-abf883e9d3f7/resourceGroups/dify-rg/providers/Microsoft.DBforPostgreSQL/flexibleServers/dify-postgres-9107e36a][0m
[0m[1mdata.azurerm_storage_account.dify_storage: Read complete after 1s [id=/subscriptions/739aaf91-5cb2-45a6-ab4f-abf883e9d3f7/resourceGroups/dify-rg/providers/Microsoft.Storage/storageAccounts/difyprivatest9107e36a][0m
[0m[1mdata.azurerm_key_vault.dify_kv: Read complete after 1s [id=/subscriptions/739aaf91-5cb2-45a6-ab4f-abf883e9d3f7/resourceGroups/dify-rg/providers/Microsoft.KeyVault/vaults/dify-private-kv-9107e36a][0m
[0m[1mdata.azurerm_kubernetes_cluster.dify_aks: Read complete after 2s [id=/subscriptions/739aaf91-5cb2-45a6-ab4f-abf883e9d3f7/resourceGroups/dify-rg/providers/Microsoft.ContainerService/managedClusters/dify-aks][0m

Terraform used the selected providers to generate the following execution
plan. Resource actions are indicated with the following symbols:
  [32m+[0m create[0m

Terraform planned the following actions, but then encountered a problem:

[1m  # azurerm_resource_group.hub[0m will be created
[0m  [32m+[0m[0m resource "azurerm_resource_group" "hub" {
      [32m+[0m[0m id       = (known after apply)
      [32m+[0m[0m location = "northeurope"
      [32m+[0m[0m name     = "cc-hub-rg"
      [32m+[0m[0m tags     = {
          [32m+[0m[0m "Backup"      = "daily"
          [32m+[0m[0m "CostCenter"  = "shared-services"
          [32m+[0m[0m "Criticality" = "high"
          [32m+[0m[0m "Environment" = "hub"
        }
    }

[1m  # null_resource.enable_aks_monitoring[0][0m will be created
[0m  [32m+[0m[0m resource "null_resource" "enable_aks_monitoring" {
      [32m+[0m[0m id = (known after apply)
    }

[1m  # module.acr[0].azurerm_container_registry.this[0m will be created
[0m  [32m+[0m[0m resource "azurerm_container_registry" "this" {
      [32m+[0m[0m admin_enabled                 = false
      [32m+[0m[0m admin_password                = (sensitive value)
      [32m+[0m[0m admin_username                = (known after apply)
      [32m+[0m[0m encryption                    = (known after apply)
      [32m+[0m[0m export_policy_enabled         = true
      [32m+[0m[0m id                            = (known after apply)
      [32m+[0m[0m location                      = "northeurope"
      [32m+[0m[0m login_server                  = (known after apply)
      [32m+[0m[0m name                          = (known after apply)
      [32m+[0m[0m network_rule_bypass_option    = "AzureServices"
      [32m+[0m[0m network_rule_set              = (known after apply)
      [32m+[0m[0m public_network_access_enabled = true
      [32m+[0m[0m resource_group_name           = "cc-acr-rg"
      [32m+[0m[0m retention_policy              = (known after apply)
      [32m+[0m[0m sku                           = "Standard"
      [32m+[0m[0m tags                          = {
          [32m+[0m[0m "Backup"      = "daily"
          [32m+[0m[0m "Component"   = "container-registry"
          [32m+[0m[0m "CostCenter"  = "shared-services"
          [32m+[0m[0m "Criticality" = "high"
          [32m+[0m[0m "Environment" = "hub"
        }
      [32m+[0m[0m trust_policy                  = (known after apply)
      [32m+[0m[0m zone_redundancy_enabled       = false
    }

[1m  # module.acr[0].azurerm_resource_group.acr[0m will be created
[0m  [32m+[0m[0m resource "azurerm_resource_group" "acr" {
      [32m+[0m[0m id       = (known after apply)
      [32m+[0m[0m location = "northeurope"
      [32m+[0m[0m name     = "cc-acr-rg"
      [32m+[0m[0m tags     = {
          [32m+[0m[0m "Backup"      = "daily"
          [32m+[0m[0m "Component"   = "container-registry"
          [32m+[0m[0m "CostCenter"  = "shared-services"
          [32m+[0m[0m "Criticality" = "high"
          [32m+[0m[0m "Environment" = "hub"
        }
    }

[1m  # module.acr[0].azurerm_role_assignment.acr_pull["13e66819-def8-411d-ae53-a1f9a284ba0c"][0m will be created
[0m  [32m+[0m[0m resource "azurerm_role_assignment" "acr_pull" {
      [32m+[0m[0m id                               = (known after apply)
      [32m+[0m[0m name                             = (known after apply)
      [32m+[0m[0m principal_id                     = "13e66819-def8-411d-ae53-a1f9a284ba0c"
      [32m+[0m[0m principal_type                   = (known after apply)
      [32m+[0m[0m role_definition_id               = (known after apply)
      [32m+[0m[0m role_definition_name             = "AcrPull"
      [32m+[0m[0m scope                            = (known after apply)
      [32m+[0m[0m skip_service_principal_aad_check = (known after apply)
    }

[1m  # module.acr[0].random_string.acr_suffix[0m will be created
[0m  [32m+[0m[0m resource "random_string" "acr_suffix" {
      [32m+[0m[0m id          = (known after apply)
      [32m+[0m[0m length      = 6
      [32m+[0m[0m lower       = true
      [32m+[0m[0m min_lower   = 0
      [32m+[0m[0m min_numeric = 0
      [32m+[0m[0m min_special = 0
      [32m+[0m[0m min_upper   = 0
      [32m+[0m[0m number      = true
      [32m+[0m[0m numeric     = true
      [32m+[0m[0m result      = (known after apply)
      [32m+[0m[0m special     = false
      [32m+[0m[0m upper       = false
    }

[1m  # module.monitoring[0].azurerm_application_insights.this[0m will be created
[0m  [32m+[0m[0m resource "azurerm_application_insights" "this" {
      [32m+[0m[0m app_id                                = (known after apply)
      [32m+[0m[0m application_type                      = "web"
      [32m+[0m[0m connection_string                     = (sensitive value)
      [32m+[0m[0m daily_data_cap_in_gb                  = (known after apply)
      [32m+[0m[0m daily_data_cap_notifications_disabled = (known after apply)
      [32m+[0m[0m disable_ip_masking                    = false
      [32m+[0m[0m force_customer_storage_for_profiler   = false
      [32m+[0m[0m id                                    = (known after apply)
      [32m+[0m[0m instrumentation_key                   = (sensitive value)
      [32m+[0m[0m internet_ingestion_enabled            = true
      [32m+[0m[0m internet_query_enabled                = true
      [32m+[0m[0m local_authentication_disabled         = false
      [32m+[0m[0m location                              = "northeurope"
      [32m+[0m[0m name                                  = "cc-app-insights"
      [32m+[0m[0m resource_group_name                   = "cc-monitoring-rg"
      [32m+[0m[0m retention_in_days                     = 90
      [32m+[0m[0m sampling_percentage                   = 100
      [32m+[0m[0m tags                                  = {
          [32m+[0m[0m "Backup"      = "daily"
          [32m+[0m[0m "Component"   = "monitoring"
          [32m+[0m[0m "CostCenter"  = "shared-services"
          [32m+[0m[0m "Criticality" = "high"
          [32m+[0m[0m "Environment" = "hub"
        }
      [32m+[0m[0m workspace_id                          = (known after apply)
    }

[1m  # module.monitoring[0].azurerm_log_analytics_solution.container_insights[0][0m will be created
[0m  [32m+[0m[0m resource "azurerm_log_analytics_solution" "container_insights" {
      [32m+[0m[0m id                    = (known after apply)
      [32m+[0m[0m location              = "northeurope"
      [32m+[0m[0m resource_group_name   = "cc-monitoring-rg"
      [32m+[0m[0m solution_name         = "ContainerInsights"
      [32m+[0m[0m tags                  = {
          [32m+[0m[0m "Backup"      = "daily"
          [32m+[0m[0m "Component"   = "monitoring"
          [32m+[0m[0m "CostCenter"  = "shared-services"
          [32m+[0m[0m "Criticality" = "high"
          [32m+[0m[0m "Environment" = "hub"
        }
      [32m+[0m[0m workspace_name        = "cc-logs-workspace"
      [32m+[0m[0m workspace_resource_id = (known after apply)

      [32m+[0m[0m plan {
          [32m+[0m[0m name      = (known after apply)
          [32m+[0m[0m product   = "OMSGallery/ContainerInsights"
          [32m+[0m[0m publisher = "Microsoft"
        }
    }

[1m  # module.monitoring[0].azurerm_log_analytics_workspace.this[0m will be created
[0m  [32m+[0m[0m resource "azurerm_log_analytics_workspace" "this" {
      [32m+[0m[0m allow_resource_only_permissions = true
      [32m+[0m[0m daily_quota_gb                  = -1
      [32m+[0m[0m id                              = (known after apply)
      [32m+[0m[0m internet_ingestion_enabled      = true
      [32m+[0m[0m internet_query_enabled          = true
      [32m+[0m[0m local_authentication_disabled   = false
      [32m+[0m[0m location                        = "northeurope"
      [32m+[0m[0m name                            = "cc-logs-workspace"
      [32m+[0m[0m primary_shared_key              = (sensitive value)
      [32m+[0m[0m resource_group_name             = "cc-monitoring-rg"
      [32m+[0m[0m retention_in_days               = 30
      [32m+[0m[0m secondary_shared_key            = (sensitive value)
      [32m+[0m[0m sku                             = "PerGB2018"
      [32m+[0m[0m tags                            = {
          [32m+[0m[0m "Backup"      = "daily"
          [32m+[0m[0m "Component"   = "monitoring"
          [32m+[0m[0m "CostCenter"  = "shared-services"
          [32m+[0m[0m "Criticality" = "high"
          [32m+[0m[0m "Environment" = "hub"
        }
      [32m+[0m[0m workspace_id                    = (known after apply)
    }

[1m  # module.monitoring[0].azurerm_monitor_action_group.this[0][0m will be created
[0m  [32m+[0m[0m resource "azurerm_monitor_action_group" "this" {
      [32m+[0m[0m enabled             = true
      [32m+[0m[0m id                  = (known after apply)
      [32m+[0m[0m location            = "global"
      [32m+[0m[0m name                = "cc-alerts"
      [32m+[0m[0m resource_group_name = "cc-monitoring-rg"
      [32m+[0m[0m short_name          = "cc-alerts"
      [32m+[0m[0m tags                = {
          [32m+[0m[0m "Backup"      = "daily"
          [32m+[0m[0m "Component"   = "monitoring"
          [32m+[0m[0m "CostCenter"  = "shared-services"
          [32m+[0m[0m "Criticality" = "high"
          [32m+[0m[0m "Environment" = "hub"
        }

      [32m+[0m[0m email_receiver {
          [32m+[0m[0m email_address           = "alberto.lacambra@dxc.com"
          [32m+[0m[0m name                    = "email-admin"
          [32m+[0m[0m use_common_alert_schema = true
        }
    }

[1m  # module.monitoring[0].azurerm_resource_group.monitoring[0m will be created
[0m  [32m+[0m[0m resource "azurerm_resource_group" "monitoring" {
      [32m+[0m[0m id       = (known after apply)
      [32m+[0m[0m location = "northeurope"
      [32m+[0m[0m name     = "cc-monitoring-rg"
      [32m+[0m[0m tags     = {
          [32m+[0m[0m "Backup"      = "daily"
          [32m+[0m[0m "Component"   = "monitoring"
          [32m+[0m[0m "CostCenter"  = "shared-services"
          [32m+[0m[0m "Criticality" = "high"
          [32m+[0m[0m "Environment" = "hub"
        }
    }

[1mPlan:[0m 11 to add, 0 to change, 0 to destroy.
[0m
Changes to Outputs:
  [32m+[0m[0m acr_id                                   = (known after apply)
  [32m+[0m[0m acr_login_server                         = (known after apply)
  [32m+[0m[0m acr_name                                 = (known after apply)
  [32m+[0m[0m action_group_id                          = (known after apply)
  [32m+[0m[0m application_insights_connection_string   = (sensitive value)
  [32m+[0m[0m application_insights_id                  = (known after apply)
  [32m+[0m[0m application_insights_instrumentation_key = (sensitive value)
  [32m+[0m[0m dify_aks_id                              = "/subscriptions/739aaf91-5cb2-45a6-ab4f-abf883e9d3f7/resourceGroups/dify-rg/providers/Microsoft.ContainerService/managedClusters/dify-aks"
  [32m+[0m[0m dify_aks_name                            = "dify-aks"
  [32m+[0m[0m dify_key_vault_id                        = "/subscriptions/739aaf91-5cb2-45a6-ab4f-abf883e9d3f7/resourceGroups/dify-rg/providers/Microsoft.KeyVault/vaults/dify-private-kv-9107e36a"
  [32m+[0m[0m dify_key_vault_uri                       = "https://dify-private-kv-9107e36a.vault.azure.net/"
  [32m+[0m[0m dify_postgresql_fqdn                     = "dify-postgres-9107e36a.postgres.database.azure.com"
  [32m+[0m[0m dify_postgresql_id                       = "/subscriptions/739aaf91-5cb2-45a6-ab4f-abf883e9d3f7/resourceGroups/dify-rg/providers/Microsoft.DBforPostgreSQL/flexibleServers/dify-postgres-9107e36a"
  [32m+[0m[0m dify_resource_group_name                 = "dify-rg"
  [32m+[0m[0m dify_storage_account_id                  = "/subscriptions/739aaf91-5cb2-45a6-ab4f-abf883e9d3f7/resourceGroups/dify-rg/providers/Microsoft.Storage/storageAccounts/difyprivatest9107e36a"
  [32m+[0m[0m dify_storage_account_name                = "difyprivatest9107e36a"
  [32m+[0m[0m dify_vnet_id                             = "/subscriptions/739aaf91-5cb2-45a6-ab4f-abf883e9d3f7/resourceGroups/dify-rg/providers/Microsoft.Network/virtualNetworks/dify-private-vnet"
  [32m+[0m[0m dify_vnet_name                           = "dify-private-vnet"
  [32m+[0m[0m hub_resource_group_name                  = "cc-hub-rg"
  [32m+[0m[0m log_analytics_workspace_id               = (known after apply)
  [32m+[0m[0m log_analytics_workspace_name             = "cc-logs-workspace"
[31m╷[0m[0m
[31m│[0m [0m[1m[31mError: [0m[0m[1mInvalid count argument[0m
[31m│[0m [0m
[31m│[0m [0m[0m  on .terraform/modules/acr/terraform/modules/container-registry/main.tf line 84, in resource "azurerm_monitor_diagnostic_setting" "acr":
[31m│[0m [0m  84:   count = [4mvar.log_analytics_workspace_id != null ? 1 : 0[0m[0m
[31m│[0m [0m
[31m│[0m [0mThe "count" value depends on resource attributes that cannot be determined
[31m│[0m [0muntil apply, so Terraform cannot predict how many instances will be
[31m│[0m [0mcreated. To work around this, use the -target argument to first apply only
[31m│[0m [0mthe resources that the count depends on.
[31m╵[0m[0m
time=2025-10-13T19:00:38+02:00 level=error msg=Terraform invocation failed in /mnt/c/PROYECTS/DXC_PoC_Nirvana/terraform/hub/.terragrunt-cache/wsx8wRYUkzUWTAUbk2PC_N4qoEM/9uFuC7xGCWPeqiIr5Qu4QTqFZ8g prefix=[/mnt/c/PROYECTS/DXC_PoC_Nirvana/terraform/hub] 
time=2025-10-13T19:00:38+02:00 level=error msg=1 error occurred:
	* exit status 1


