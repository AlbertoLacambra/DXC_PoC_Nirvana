{"config":{"lang":["es","en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"\ud83d\ude80 Bienvenido a DXC Cloud Mind - Nirvana PoC","text":"<p>Estado del Proyecto</p> <p>Phase: Infrastructure Deployed \u2705 \u00daltima Actualizaci\u00f3n: Enero 2025 Recursos Desplegados: 7 Workflows Operacionales: 5</p>"},{"location":"#vision","title":"\ud83c\udfaf Visi\u00f3n","text":"<p>Transform cloud operations through AI-driven automation, proactive governance, and cost optimization. This PoC implements a Cloud Mind Control Center that enables:</p> <ul> <li> <p> Visibilidad Total</p> <p>Real-time monitoring de operaciones, incidentes y alertas con dashboards unificados</p> </li> <li> <p> Velocidad de Acci\u00f3n</p> <p>Planes de acci\u00f3n generados por IA con comparaci\u00f3n hist\u00f3rica y automated remediation</p> </li> <li> <p> Proactividad</p> <p>Insights continuos que previenen incidentes recurrentes antes de que ocurran</p> </li> <li> <p> Cero Riesgo</p> <p>Enfoque en zero operational risk con automated compliance y security scanning</p> </li> <li> <p> Hiper-automatizaci\u00f3n</p> <p>Ciclo de vida completo de soluciones Cloud con GitOps y CI/CD</p> </li> <li> <p> Optimizaci\u00f3n de Costes</p> <p>~\u20ac250/mes ahorrados con Single-AKS strategy y FinOps automation</p> </li> </ul>"},{"location":"#arquitectura-actual","title":"\ud83c\udfd7\ufe0f Arquitectura Actual","text":""},{"location":"#single-aks-shared-services","title":"Single-AKS Shared Services","text":"<pre><code>graph TB\n    subgraph Azure[\"AZURE SUBSCRIPTION: 739aaf91-5cb2-45a6-ab4f-abf883e9d3f7\"]\n        subgraph DifyRG[\"Resource Group: dify-rg (Existing)\"]\n            AKS[AKS Cluster: dify-aks]\n            subgraph Namespaces[\"Namespaces\"]\n                NS1[dify&lt;br/&gt;Existing]\n                NS2[cloudmind&lt;br/&gt;NEW]\n            end\n            AKS --&gt; Namespaces\n\n            PostgreSQL[PostgreSQL Flexible Server]\n            Storage[Storage Account]\n            KeyVault[Key Vault]\n            VNet[Virtual Network]\n        end\n\n        subgraph HubRG[\"Resource Group: cloudmind-hub-rg (NEW)\"]\n            Hub[Shared Services]\n        end\n\n        subgraph ACRRG[\"Resource Group: cloudmind-acr-rg (NEW)\"]\n            ACR[Azure Container Registry]\n            RoleAssign[Role Assignments]\n        end\n    end\n\n    ACR -.AcrPull.-&gt; AKS\n\n    style NS2 fill:#90EE90\n    style ACR fill:#90EE90\n    style HubRG fill:#90EE90\n    style ACRRG fill:#90EE90</code></pre> <p>Single-AKS Strategy</p> <p>Leveraging existing Dify AKS cluster with namespace isolation:</p> <ul> <li>Dify namespace: Existing workloads (data source, read-only)</li> <li>CloudMind namespace: New PoC workloads (Terraform-managed)</li> <li>Ahorro: ~\u20ac250/mes vs multi-AKS approach</li> </ul>"},{"location":"#metricas-del-proyecto","title":"\ud83d\udcca M\u00e9tricas del Proyecto","text":"M\u00e9trica Valor Estado Recursos Desplegados 7 \u2705 Workflows CI/CD 5 \u2705 Security Gates 6 \u2705 Coste Mensual Incremental ~\u20ac5/mes \u2705 Ahorro vs Multi-AKS ~\u20ac250/mes \u2705 Time-to-Deploy ~10 min \u2705"},{"location":"#quick-start","title":"\ud83d\ude80 Quick Start","text":""},{"location":"#1-clonar-repositorio","title":"1. Clonar Repositorio","text":"<pre><code>git clone https://github.com/DXC-Technology-Spain/DXC_PoC_Nirvana.git\ncd DXC_PoC_Nirvana\n</code></pre>"},{"location":"#2-configurar-credenciales","title":"2. Configurar Credenciales","text":"<p>Ver Gu\u00eda de Configuraci\u00f3n de Secretos</p>"},{"location":"#3-desplegar-infraestructura","title":"3. Desplegar Infraestructura","text":"<pre><code># Opci\u00f3n 1: GitHub Actions (Recomendado)\n# Ir a Actions \u2192 \"\ud83d\ude80 Deploy Infrastructure\" \u2192 Run workflow\n\n# Opci\u00f3n 2: Local (Testing)\ncd terraform/environments/hub\nterraform init\nterraform plan\nterraform apply\n</code></pre>"},{"location":"#use-cases-roadmap","title":"\ud83c\udfaf Use Cases (Roadmap)","text":""},{"location":"#phase-1-foundation","title":"Phase 1: Foundation \u2705","text":"<ul> <li> Infrastructure as Code (Terraform)</li> <li> CI/CD Pipelines (GitHub Actions)</li> <li> Security &amp; Compliance Gates</li> <li> Cost Optimization (Single-AKS)</li> </ul>"},{"location":"#phase-2-documentation-system","title":"Phase 2: Documentation System \ud83d\udcdd","text":"<ul> <li> Next.js Control Center UI with MDX</li> <li> FastAPI API Gateway</li> <li> Dify RAG integration</li> <li> Conversational Q&amp;A bot</li> </ul>"},{"location":"#phase-3-iac-automation","title":"Phase 3: IaC Automation \ud83e\udd16","text":"<ul> <li> Drift detection pipeline</li> <li> AI risk analysis (Dify workflows)</li> <li> Infrastructure state dashboard</li> <li> Auto-remediation workflows</li> </ul>"},{"location":"#phase-4-finops-optimization","title":"Phase 4: FinOps Optimization \ud83d\udcb0","text":"<ul> <li> Azure Cost Management API integration</li> <li> Underutilization detection</li> <li> Automated PR generation (optimizations)</li> <li> Predictive cost dashboards</li> </ul>"},{"location":"#enlaces-rapidos","title":"\ud83d\udd17 Enlaces R\u00e1pidos","text":"<ul> <li> <p> GitHub Repository</p> <p>Ver c\u00f3digo fuente</p> </li> <li> <p> Azure Portal</p> <p>Ver recursos</p> </li> <li> <p> GitHub Actions</p> <p>Ver workflows</p> </li> <li> <p> Documentaci\u00f3n</p> <p>Explorar gu\u00edas</p> </li> </ul>"},{"location":"#soporte","title":"\ud83d\udcde Soporte","text":"<p>CloudOps Team: Alberto Lacambra GitHub Issues: Reportar aqu\u00ed</p> <p>Misi\u00f3n</p> <p>Transformar CloudOps mediante IA, automatizaci\u00f3n end-to-end y gobernanza proactiva, depreciando ClickOps y modernizando operaciones legacy.</p>"},{"location":"ARCHITECTURE_V2/","title":"Arquitectura Cloud Control Center PoC v2.0","text":"<p>Fecha: 14 Octubre 2025 Versi\u00f3n: 2.0 - Optimizada para Costes Estado: En Revisi\u00f3n</p>"},{"location":"ARCHITECTURE_V2/#decisiones-de-arquitectura","title":"\ud83d\udcd0 Decisiones de Arquitectura","text":""},{"location":"ARCHITECTURE_V2/#adr-001-single-subscription-architecture","title":"ADR-001: Single Subscription Architecture","text":"<p>Status: Propuesto Context: Budget limitado (\\(130/mes), PoC sin requisitos HA   **Decision**: Consolidar toda infraestructura en 1 suscripci\u00f3n   **Consequences**: - \u2705 Coste reducido 52% (\\)205 \u2192 $97/mes) - \u2705 Menor complejidad operacional - \u2705 Networking simplificado (VNet peering interno) - \u26a0\ufe0f Sin aislamiento total entre environments - \u26a0\ufe0f L\u00edmite de quotas compartido</p> <p>Migration Path to Production: <pre><code>PoC (1 subscription) \u2192 Dev (dedicated sub) \u2192 Prod (dedicated sub)\nCost: $97/mes     \u2192 $130/mes           \u2192 $200/mes\n</code></pre></p>"},{"location":"ARCHITECTURE_V2/#adr-002-eliminar-servicios-de-observability","title":"ADR-002: Eliminar Servicios de Observability","text":"<p>Status: Propuesto Context: Log Analytics cuesta $100-150/mes, excede budget PoC Decision: NO desplegar Azure Monitor stack en PoC Alternatives Evaluated: 1. \u2705 Prometheus + Grafana self-hosted (usa recursos AKS, $0 extra) 2. \u2705 Container Insights free tier (500MB/d\u00eda, suficiente PoC) 3. \u274c Azure Monitor full stack (fuera de budget)</p> <p>Documentation: <code>docs/production-readiness/01-monitoring.md</code></p>"},{"location":"ARCHITECTURE_V2/#adr-003-standard-skus-vs-premium","title":"ADR-003: Standard SKUs vs Premium","text":"<p>Status: Propuesto Context: Premium SKUs multiplican costes sin valor PoC Decision: Usar Standard/Burstable para todos los servicios</p> Servicio Premium Standard Savings ACR $25/mes $5/mes -$20 PostgreSQL $90/mes (GP) $12/mes (B1ms) -$78 AKS Nodes D4s_v3 B2s -$40/node <p>Total Savings: ~$138/mes</p> <p>Trade-offs: - \u26a0\ufe0f Sin geo-replication (ACR) - \u26a0\ufe0f Performance limitado (PostgreSQL burstable) - \u26a0\ufe0f Sin SLA 99.99% (solo 99.9%)</p>"},{"location":"ARCHITECTURE_V2/#adr-004-gitops-con-github-actions","title":"ADR-004: GitOps con GitHub Actions","text":"<p>Status: Propuesto Context: Necesidad de CI/CD robusto sin coste adicional Decision: GitHub Actions como orchestrator principal Alternatives Considered: - \u274c Azure DevOps (complejidad, otro sistema) - \u274c Jenkins (self-hosted, maintenance overhead) - \u274c GitLab CI (migration cost) - \u2705 GitHub Actions (native integration, 2000min/mes free)</p> <p>Workflows: <pre><code>PR \u2192 terraform-plan.yml \u2192 Security scan \u2192 Cost check \u2192 Approve \u2192 Merge\nMerge \u2192 terraform-apply.yml \u2192 Deploy dev \u2192 Smoke tests \u2192 Notify\nSchedule \u2192 drift-detection.yml \u2192 Compare state \u2192 Create issue if drift\n</code></pre></p>"},{"location":"ARCHITECTURE_V2/#adr-005-git-sources-para-terraform-modules","title":"ADR-005: Git Sources para Terraform Modules","text":"<p>Status: Approved \u2705 Context: Local paths no funcionan con Terragrunt remote sources Decision: Usar Git sources con semantic versioning</p> <pre><code>module \"aks\" {\n  source = \"git::https://github.com/AlbertoLacambra/DXC_PoC_Nirvana.git//terraform/modules/aks?ref=v1.0.0\"\n}\n</code></pre> <p>Benefits: - \u2705 Versioning expl\u00edcito (rollback f\u00e1cil) - \u2705 Module reusability across repos - \u2705 Immutable infrastructure (tagged releases)</p> <p>Costs: - \u26a0\ufe0f Slower init (Git clone) - \u26a0\ufe0f Requires GitHub access (PAT for private repos)</p>"},{"location":"ARCHITECTURE_V2/#arquitectura-fisica","title":"\ud83c\udfd7\ufe0f Arquitectura F\u00edsica","text":""},{"location":"ARCHITECTURE_V2/#opcion-1-poc-consolidada-recomendada","title":"Opci\u00f3n 1: PoC Consolidada (RECOMENDADA)","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  Azure Subscription: Hub (739aaf91-5cb2-45a6-ab4f-abf883e9d3f7)\u2502\n\u2502                                                                \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502\n\u2502  \u2502   dify-rg        \u2502  \u2502   shared-rg     \u2502  \u2502   apps-rg    \u2502 \u2502\n\u2502  \u2502                  \u2502  \u2502                 \u2502  \u2502              \u2502 \u2502\n\u2502  \u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502  \u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\u2502  \u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502 \u2502\n\u2502  \u2502 \u2502 AKS (Dify)   \u2502 \u2502  \u2502 \u2502 ACR         \u2502\u2502  \u2502 \u2502 AKS      \u2502 \u2502 \u2502\n\u2502  \u2502 \u2502 \u2022 2x B4ms    \u2502 \u2502  \u2502 \u2502 \u2022 Standard  \u2502\u2502  \u2502 \u2502 \u2022 1x B2s \u2502 \u2502 \u2502\n\u2502  \u2502 \u2502 \u2022 Dify app   \u2502\u25c4\u2500\u253c\u2500\u2500\u253c\u2500\u2502 \u2022 Shared    \u2502\u2502\u25c4\u2500\u253c\u2500\u2502 \u2022 Apps   \u2502 \u2502 \u2502\n\u2502  \u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502  \u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\u2502  \u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502 \u2502\n\u2502  \u2502                  \u2502  \u2502                 \u2502  \u2502              \u2502 \u2502\n\u2502  \u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502  \u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\u2502  \u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502 \u2502\n\u2502  \u2502 \u2502 PostgreSQL   \u2502 \u2502  \u2502 \u2502 Key Vault   \u2502\u2502  \u2502 \u2502 VNet     \u2502 \u2502 \u2502\n\u2502  \u2502 \u2502 \u2022 Flexible   \u2502 \u2502  \u2502 \u2502 \u2022 Standard  \u2502\u2502  \u2502 \u2502 Apps     \u2502 \u2502 \u2502\n\u2502  \u2502 \u2502 \u2022 B1ms       \u2502 \u2502  \u2502 \u2502 \u2022 Secrets   \u2502\u2502  \u2502 \u2502          \u2502 \u2502 \u2502\n\u2502  \u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502  \u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\u2502  \u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502 \u2502\n\u2502  \u2502                  \u2502  \u2502                 \u2502  \u2502       \u2502      \u2502 \u2502\n\u2502  \u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502  \u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\u2502  \u2502       \u2502      \u2502 \u2502\n\u2502  \u2502 \u2502 Storage      \u2502 \u2502  \u2502 \u2502 Storage Acc \u2502\u2502  \u2502       \u2502      \u2502 \u2502\n\u2502  \u2502 \u2502 \u2022 Dify data  \u2502 \u2502  \u2502 \u2502 \u2022 TF State  \u2502\u2502  \u2502       \u2502      \u2502 \u2502\n\u2502  \u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502  \u2502 \u2502 \u2022 Backups   \u2502\u2502  \u2502       \u2502      \u2502 \u2502\n\u2502  \u2502                  \u2502  \u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\u2502  \u2502       \u2502      \u2502 \u2502\n\u2502  \u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502  \u2502                 \u2502  \u2502       \u2502      \u2502 \u2502\n\u2502  \u2502 \u2502 VNet Dify    \u2502\u25c4\u253c\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518      \u2502 \u2502\n\u2502  \u2502 \u2502 10.0.0.0/16  \u2502 \u2502  \u2502    VNet Peering \u2502  \u2502              \u2502 \u2502\n\u2502  \u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502  \u2502                 \u2502  \u2502              \u2502 \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502\n\u2502                                                                \u2502\n\u2502  \ud83d\udcb0 Cost: ~$97/mes                                            \u2502\n\u2502  \ud83d\udcca Monitoring: Prometheus (self-hosted, $0)                  \u2502\n\u2502  \ud83d\udd12 Backups: Manual scripts (free tier, $0)                   \u2502\n\u2502  \ud83c\udf10 Networking: Single region (North Europe, $3/mes)          \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>Caracter\u00edsticas: - \u2705 Todo en 1 regi\u00f3n (North Europe) - \u2705 VNet peering entre Dify y Apps (sin VPN Gateway) - \u2705 ACR compartido (pull desde ambos AKS) - \u2705 Key Vault com\u00fan (secrets centralizados) - \u2705 State en Azure Storage (ya existente)</p>"},{"location":"ARCHITECTURE_V2/#opcion-2-hub-spoke-produccion-futura","title":"Opci\u00f3n 2: Hub &amp; Spoke (PRODUCCI\u00d3N FUTURA)","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  Subscription: Hub (739aaf91...)                                \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u2502\n\u2502  \u2502 Shared Services                                           \u2502  \u2502\n\u2502  \u2502 \u2022 ACR Premium (geo-replication)                          \u2502  \u2502\n\u2502  \u2502 \u2022 Log Analytics + App Insights                           \u2502  \u2502\n\u2502  \u2502 \u2022 Azure Firewall                                         \u2502  \u2502\n\u2502  \u2502 \u2022 VPN Gateway (S2S + P2S)                                \u2502  \u2502\n\u2502  \u2502 \u2022 Key Vault Premium (HSM)                                \u2502  \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2502\n\u2502         \u2502                      \u2502                      \u2502          \u2502\n\u2502         \u2502 VNet Peering         \u2502 VNet Peering         \u2502          \u2502\n\u2502         \u25bc                      \u25bc                      \u25bc          \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n         \u2502                      \u2502                      \u2502\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Spoke: Prod     \u2502   \u2502 Spoke: Dev      \u2502   \u2502 Spoke: Staging  \u2502\n\u2502 (353a6255...)   \u2502   \u2502 (0987a8ce...)   \u2502   \u2502 (New)           \u2502\n\u2502                 \u2502   \u2502                 \u2502   \u2502                 \u2502\n\u2502 \u2022 AKS (D4s_v3)  \u2502   \u2502 \u2022 AKS (B2s)    \u2502   \u2502 \u2022 AKS (B4ms)    \u2502\n\u2502 \u2022 PostgreSQL GP \u2502   \u2502 \u2022 PostgreSQL B \u2502   \u2502 \u2022 PostgreSQL B  \u2502\n\u2502 \u2022 Storage       \u2502   \u2502 \u2022 Storage      \u2502   \u2502 \u2022 Storage       \u2502\n\u2502 \u2022 Private EP    \u2502   \u2502 \u2022 Public EP    \u2502   \u2502 \u2022 Public EP     \u2502\n\u2502                 \u2502   \u2502                 \u2502   \u2502                 \u2502\n\u2502 Cost: $150/mes  \u2502   \u2502 Cost: $50/mes  \u2502   \u2502 Cost: $70/mes   \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\nTotal: $95 (Hub) + $150 (Prod) + $50 (Dev) + $70 (Staging) = $365/mes\n</code></pre> <p>Solo para PRODUCCI\u00d3N - Documentado en <code>docs/production-readiness/</code></p>"},{"location":"ARCHITECTURE_V2/#network-architecture","title":"\ud83d\udd00 Network Architecture","text":""},{"location":"ARCHITECTURE_V2/#vnet-design-poc","title":"VNet Design (PoC)","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  dify-private-vnet (10.0.0.0/16)                          \u2502\n\u2502                                                            \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u2502\n\u2502  \u2502 aks-subnet (10.0.1.0/24)                            \u2502  \u2502\n\u2502  \u2502 \u2022 Dify AKS nodes (2x B4ms)                          \u2502  \u2502\n\u2502  \u2502 \u2022 Network Policy: Calico                            \u2502  \u2502\n\u2502  \u2502 \u2022 Outbound: NAT Gateway (optional, $30/mes)         \u2502  \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2502\n\u2502                                                            \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u2502\n\u2502  \u2502 postgresql-subnet (10.0.2.0/28)                     \u2502  \u2502\n\u2502  \u2502 \u2022 Delegated to Microsoft.DBforPostgreSQL            \u2502  \u2502\n\u2502  \u2502 \u2022 Private Endpoint (optional, $7/mes)               \u2502  \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2502\n\u2502                                                            \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u2502\n\u2502  \u2502 vpn-subnet (10.0.3.0/27)                            \u2502  \u2502\n\u2502  \u2502 \u2022 OpenSense VM (existing)                           \u2502  \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                              \u2502\n                              \u2502 VNet Peering ($0.01/GB)\n                              \u2502\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  apps-vnet (10.1.0.0/16)                                  \u2502\n\u2502                                                            \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u2502\n\u2502  \u2502 aks-subnet (10.1.1.0/24)                            \u2502  \u2502\n\u2502  \u2502 \u2022 Apps AKS nodes (1x B2s)                           \u2502  \u2502\n\u2502  \u2502 \u2022 Pulls images from ACR (via peering)               \u2502  \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>Security: - \u2705 NSGs en cada subnet - \u2705 Service Endpoints (PostgreSQL, Storage, ACR) - \u274c Private Endpoints (PoC: p\u00fablico con firewall rules) - \u274c Azure Firewall (PoC: NSGs suficiente)</p> <p>Cost Optimization: - Skip NAT Gateway (\\(30/mes) \u2192 Use AKS default outbound - Skip Private Endpoints (\\)7/mes each) \u2192 Use Service Endpoints (\\(0) - Skip Azure Firewall (\\)1/hora = $730/mes) \u2192 NSGs</p> <p>Savings: ~$767/mes vs full private setup</p>"},{"location":"ARCHITECTURE_V2/#security-architecture","title":"\ud83d\udd10 Security Architecture","text":""},{"location":"ARCHITECTURE_V2/#identity-access","title":"Identity &amp; Access","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  Azure AD Tenant                                        \u2502\n\u2502                                                         \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502\n\u2502  \u2502 Service Principal: github-actions-sp              \u2502 \u2502\n\u2502  \u2502 \u2022 Contributor (Subscription level)                \u2502 \u2502\n\u2502  \u2502 \u2022 Storage Blob Data Contributor (TF State)        \u2502 \u2502\n\u2502  \u2502 \u2022 Key Vault Secrets User                          \u2502 \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502\n\u2502                                                         \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502\n\u2502  \u2502 Managed Identity: aks-dify-identity               \u2502 \u2502\n\u2502  \u2502 \u2022 AcrPull (ACR)                                   \u2502 \u2502\n\u2502  \u2502 \u2022 Key Vault Secrets User                          \u2502 \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502\n\u2502                                                         \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502\n\u2502  \u2502 Managed Identity: aks-apps-identity               \u2502 \u2502\n\u2502  \u2502 \u2022 AcrPull (ACR)                                   \u2502 \u2502\n\u2502  \u2502 \u2022 Key Vault Secrets User                          \u2502 \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"ARCHITECTURE_V2/#secrets-management","title":"Secrets Management","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  Azure Key Vault: poc-shared-kv-xxxxx                   \u2502\n\u2502                                                          \u2502\n\u2502  Secrets:                                                \u2502\n\u2502  \u251c\u2500 postgresql-admin-password (auto-rotated 90d)        \u2502\n\u2502  \u251c\u2500 acr-webhook-token (for CI/CD)                       \u2502\n\u2502  \u251c\u2500 github-pat (for private module access)              \u2502\n\u2502  \u2514\u2500 dify-api-keys (application secrets)                 \u2502\n\u2502                                                          \u2502\n\u2502  Access Policies:                                        \u2502\n\u2502  \u251c\u2500 github-actions-sp: Get, List                        \u2502\n\u2502  \u251c\u2500 aks-dify-identity: Get                              \u2502\n\u2502  \u2514\u2500 aks-apps-identity: Get                              \u2502\n\u2502                                                          \u2502\n\u2502  Auditing:                                               \u2502\n\u2502  \u2705 Diagnostic logs \u2192 Storage Account (7 days retention)\u2502\n\u2502  \u274c Log Analytics (PoC: fuera de budget)                \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>Cost: $0.10/mes (Standard tier, minimal operations)</p>"},{"location":"ARCHITECTURE_V2/#security-scanning-pipeline","title":"Security Scanning Pipeline","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  PR Created                                             \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n             \u2502\n             \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  GitHub Actions: security-scan.yml                      \u2502\n\u2502                                                         \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\u2502\n\u2502  \u2502 1. tfsec                                           \u2502\u2502\n\u2502  \u2502    \u2022 Checks: AWS/Azure/GCP misconfigurations      \u2502\u2502\n\u2502  \u2502    \u2022 Output: SARIF format \u2192 Security tab          \u2502\u2502\n\u2502  \u2502    \u2022 Threshold: 0 CRITICAL, max 5 HIGH            \u2502\u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\u2502\n\u2502                                                         \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\u2502\n\u2502  \u2502 2. Checkov                                         \u2502\u2502\n\u2502  \u2502    \u2022 Checks: CIS benchmarks, compliance           \u2502\u2502\n\u2502  \u2502    \u2022 Output: JSON \u2192 PR comment                    \u2502\u2502\n\u2502  \u2502    \u2022 Custom policies: Budget limits, tags         \u2502\u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\u2502\n\u2502                                                         \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\u2502\n\u2502  \u2502 3. Gitleaks                                        \u2502\u2502\n\u2502  \u2502    \u2022 Checks: Hardcoded secrets, API keys          \u2502\u2502\n\u2502  \u2502    \u2022 Output: Block merge if secrets found         \u2502\u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\u2502\n\u2502                                                         \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\u2502\n\u2502  \u2502 4. Trivy (IaC + Container scanning)                \u2502\u2502\n\u2502  \u2502    \u2022 Checks: Terraform + Docker images            \u2502\u2502\n\u2502  \u2502    \u2022 Output: Vulnerability report                 \u2502\u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n             \u2502\n             \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  All Checks Pass? \u2192 \u2705 Allow Merge                      \u2502\n\u2502  Any Check Fails? \u2192 \u274c Block Merge + Comment PR         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>Cost: $0 (todas las herramientas son open-source)</p>"},{"location":"ARCHITECTURE_V2/#data-flow","title":"\ud83d\udcca Data Flow","text":""},{"location":"ARCHITECTURE_V2/#terraform-state-management","title":"Terraform State Management","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  Developer Local / GitHub Actions Runner                \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n             \u2502\n             \u2502 terraform init/plan/apply\n             \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  Terragrunt (Wrapper)                                   \u2502\n\u2502  \u2022 Generates backend config                             \u2502\n\u2502  \u2022 Injects variables                                    \u2502\n\u2502  \u2022 Manages dependencies                                 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n             \u2502\n             \u2502 Azure authentication (Azure AD)\n             \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  Azure Storage Account: tfstate9a448729                 \u2502\n\u2502                                                         \u2502\n\u2502  Containers (1 per environment):                        \u2502\n\u2502  \u251c\u2500 cc-poc/terraform.tfstate                           \u2502\n\u2502  \u251c\u2500 cc-dev/terraform.tfstate (future)                  \u2502\n\u2502  \u2514\u2500 cc-prod/terraform.tfstate (future)                 \u2502\n\u2502                                                         \u2502\n\u2502  Features:                                              \u2502\n\u2502  \u2705 State locking (Azure Blob lease)                    \u2502\n\u2502  \u2705 Encryption at rest (Azure-managed keys)             \u2502\n\u2502  \u2705 Versioning enabled (30 days retention)              \u2502\n\u2502  \u2705 Soft delete (7 days recovery window)                \u2502\n\u2502                                                         \u2502\n\u2502  Access Control:                                        \u2502\n\u2502  \u2022 github-actions-sp: Storage Blob Data Contributor     \u2502\n\u2502  \u2022 Developers: Storage Blob Data Reader (read-only)     \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>Cost: $0.05/mes (10MB state + 18k operations/mes)</p>"},{"location":"ARCHITECTURE_V2/#cicd-pipeline-flow","title":"CI/CD Pipeline Flow","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  Developer                                              \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n             \u2502\n             \u2502 git push feature/new-module\n             \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  Pre-commit Hooks (Local)                               \u2502\n\u2502  \u2022 terraform fmt                                        \u2502\n\u2502  \u2022 terraform validate                                   \u2502\n\u2502  \u2022 tflint                                               \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n             \u2502\n             \u2502 git push origin feature/new-module\n             \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  GitHub PR Created                                      \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n             \u2502\n             \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n             \u25bc                      \u25bc                      \u25bc\n      \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510         \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510        \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n      \u2502 terraform- \u2502         \u2502 security-  \u2502        \u2502 cost-      \u2502\n      \u2502 plan.yml   \u2502         \u2502 scan.yml   \u2502        \u2502 check.yml  \u2502\n      \u2514\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518         \u2514\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518        \u2514\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n            \u2502                      \u2502                      \u2502\n            \u2502 terragrunt plan      \u2502 tfsec+checkov       \u2502 infracost\n            \u25bc                      \u25bc                      \u25bc\n      \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510         \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510        \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n      \u2502 Plan saved \u2502         \u2502 SARIF \u2192    \u2502        \u2502 Cost diff  \u2502\n      \u2502 as artifact\u2502         \u2502 Security   \u2502        \u2502 \u2192 Comment  \u2502\n      \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518         \u2502 tab        \u2502        \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                             \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n             \u2502\n             \u2502 All checks \u2705\n             \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  PR Approved + Merged to main                           \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n             \u2502\n             \u2502 Trigger: terraform-apply.yml\n             \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  GitHub Actions: terraform-apply.yml                    \u2502\n\u2502                                                         \u2502\n\u2502  Jobs:                                                  \u2502\n\u2502  1. Checkout code                                       \u2502\n\u2502  2. Setup Terraform + Terragrunt                        \u2502\n\u2502  3. Azure Login (OIDC with github-actions-sp)           \u2502\n\u2502  4. Terragrunt apply (auto-approve)                     \u2502\n\u2502  5. Smoke tests (curl endpoints)                        \u2502\n\u2502  6. Slack notification (success/failure)                \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n             \u2502\n             \u2502 Deploy to Azure\n             \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  Azure Resources Created/Updated                        \u2502\n\u2502  \u2022 State saved to Azure Storage                         \u2502\n\u2502  \u2022 Outputs available for next modules                   \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>Duration: - PR checks: 5-8 minutos - Apply: 10-15 minutos (first deploy), 3-5 min (updates)</p> <p>Cost: $0 (dentro de free tier 2000 min/mes)</p>"},{"location":"ARCHITECTURE_V2/#disaster-recovery","title":"\ud83d\udd04 Disaster Recovery","text":""},{"location":"ARCHITECTURE_V2/#backup-strategy-poc-manual","title":"Backup Strategy (PoC - Manual)","text":"<pre><code>#!/bin/bash\n# scripts/backup-all.sh\n\n# 1. PostgreSQL Backup (built-in, free tier: 7 days retention)\naz postgres flexible-server backup create \\\n  --resource-group dify-rg \\\n  --name dify-postgres-9107e36a \\\n  --backup-name \"manual-$(date +%Y%m%d_%H%M%S)\"\n\n# 2. AKS PersistentVolume Snapshots (if any)\nkubectl get pv -o json | \\\n  jq -r '.items[] | select(.spec.storageClassName==\"managed-premium\") | .metadata.name' | \\\n  xargs -I {} kubectl snapshot create {}-snapshot --pvc={}\n\n# 3. Terraform State Backup (versioning enabled, auto)\n# Already handled by Azure Storage versioning (30 days)\n\n# 4. Key Vault Secrets Backup (manual export)\naz keyvault secret list --vault-name poc-shared-kv-xxxxx \\\n  --query \"[].id\" -o tsv | \\\n  xargs -I {} az keyvault secret backup --id {} --file {}.bak\n</code></pre> <p>Automation: GitHub Actions scheduled workflow (daily 2 AM)</p> <p>Cost: $0 (dentro de free tiers)</p>"},{"location":"ARCHITECTURE_V2/#recovery-procedures","title":"Recovery Procedures","text":"<p>RTO/RPO: | Scenario | RTO | RPO | Procedure | |----------|-----|-----|-----------| | PostgreSQL corruption | 30 min | 24h | Restore from auto-backup | | AKS cluster failure | 2 hours | 0 (stateless) | Recreate via Terraform | | Terraform state lost | 15 min | 0 | Restore from version history | | Complete subscription loss | 4 hours | 24h | Re-deploy + restore backups |</p> <p>Production: Implementar Geo-replication, Azure Backup \u2192 RTO &lt; 15min, RPO &lt; 5min</p>"},{"location":"ARCHITECTURE_V2/#compliance-governance","title":"\ud83d\udccf Compliance &amp; Governance","text":""},{"location":"ARCHITECTURE_V2/#tagging-strategy","title":"Tagging Strategy","text":"<pre><code>locals {\n  common_tags = {\n    Environment  = var.environment          # poc/dev/prod\n    ManagedBy    = \"Terraform\"\n    Repository   = \"DXC_PoC_Nirvana\"\n    CostCenter   = var.cost_center          # shared-services/apps\n    Owner        = \"alberto.lacambra@dxc.com\"\n    Project      = \"CloudControlCenter\"\n    Criticality  = var.criticality          # low/medium/high\n    Compliance   = \"CIS-Azure-1.4.0\"\n    LastModified = timestamp()\n  }\n}\n\n# Enforcement via Azure Policy (production)\nresource \"azurerm_policy_assignment\" \"require_tags\" {\n  count                = var.environment == \"prod\" ? 1 : 0\n  name                 = \"require-mandatory-tags\"\n  scope                = data.azurerm_subscription.current.id\n  policy_definition_id = \"/providers/Microsoft.Authorization/policyDefinitions/1e30110a-5ceb-460c-a204-c1c3969c6d62\"\n\n  parameters = jsonencode({\n    tagNames = [\"Environment\", \"ManagedBy\", \"CostCenter\", \"Owner\"]\n  })\n}\n</code></pre>"},{"location":"ARCHITECTURE_V2/#cost-controls","title":"Cost Controls","text":"<pre><code># Budget Alert (per subscription)\nresource \"azurerm_consumption_budget_subscription\" \"poc\" {\n  name            = \"poc-monthly-budget\"\n  subscription_id = data.azurerm_subscription.current.id\n\n  amount     = 130  # $130/mes\n  time_grain = \"Monthly\"\n\n  time_period {\n    start_date = \"2025-10-01T00:00:00Z\"\n  }\n\n  notification {\n    enabled   = true\n    threshold = 80  # Alert at 80% ($104)\n    operator  = \"GreaterThan\"\n\n    contact_emails = [\n      \"alberto.lacambra@dxc.com\",\n      \"finops@dxc.com\"\n    ]\n  }\n\n  notification {\n    enabled   = true\n    threshold = 100  # Critical alert at 100% ($130)\n    operator  = \"GreaterThan\"\n\n    contact_emails = [\n      \"alberto.lacambra@dxc.com\",\n      \"finops@dxc.com\"\n    ]\n\n    # Auto-shutdown non-production (optional)\n    webhook_url = \"https://hooks.slack.com/services/YOUR/WEBHOOK\"\n  }\n}\n</code></pre> <p>Enforcement: Infracost PR checks bloquean si delta &gt; 20%</p>"},{"location":"ARCHITECTURE_V2/#non-functional-requirements","title":"\ud83c\udfaf Non-Functional Requirements","text":""},{"location":"ARCHITECTURE_V2/#performance","title":"Performance","text":"Metric Target (PoC) Target (Prod) API Response Time &lt; 500ms p95 &lt; 200ms p95 Database Query Time &lt; 100ms p99 &lt; 50ms p99 Deployment Time &lt; 15 min &lt; 10 min MTTR (rollback) &lt; 30 min &lt; 5 min"},{"location":"ARCHITECTURE_V2/#scalability","title":"Scalability","text":"Resource PoC Production AKS Nodes 1-2 3-10 (autoscale) PostgreSQL Burstable B1ms GP 4 vCores Concurrent Users 10-50 500-1000"},{"location":"ARCHITECTURE_V2/#availability","title":"Availability","text":"<ul> <li>PoC: 95% (best effort, no SLA)</li> <li>Production: 99.9% (multi-zone AKS, Premium SKUs)</li> </ul>"},{"location":"ARCHITECTURE_V2/#referencias","title":"\ud83d\udcda Referencias","text":"<ul> <li>Terraform Best Practices</li> <li>Terragrunt Documentation</li> <li>Azure Well-Architected Framework</li> <li>CIS Azure Foundations Benchmark</li> <li>GitHub Actions Best Practices</li> <li>Infracost Docs</li> </ul> <p>\u00daltima actualizaci\u00f3n: 14 Octubre 2025</p>"},{"location":"OPTIMIZATION_PROPOSAL/","title":"\ud83c\udfaf Propuesta de Optimizaci\u00f3n - DXC Cloud Mind PoC","text":"<p>Fecha: 15 Octubre 2025 Autor: Alberto Lacambra Objetivo: Maximizar valor mientras minimizamos costes en la PoC</p>"},{"location":"OPTIMIZATION_PROPOSAL/#resumen-ejecutivo","title":"\ud83d\udccb Resumen Ejecutivo","text":"<p>Dos propuestas clave para optimizar la PoC sin comprometer funcionalidad:</p> <ol> <li>\u2705 CONSOLIDACI\u00d3N AKS - Usar \u00fanico cluster existente (Dify) \u2192 Ahorro: ~$75/mes (~58%)</li> <li>\u2705 MONITORIZACI\u00d3N GRATUITA - Azure Workbooks + Grafana + Teams \u2192 Coste: $0/mes</li> </ol> <p>Impacto Total: Reducci\u00f3n de \\(130/mes a ~\\)55/mes por suscripci\u00f3n \u2705</p>"},{"location":"OPTIMIZATION_PROPOSAL/#1-propuesta-aks-unico-consolidado","title":"1\ufe0f\u20e3 Propuesta: AKS \u00danico Consolidado","text":""},{"location":"OPTIMIZATION_PROPOSAL/#concepto","title":"\ud83c\udfaf Concepto","text":"<p>Usar el AKS existente de Dify para desplegar: - \u2705 Dify (ya existente) - \u2705 Aplicaciones de casos de uso (agentes, bots, automatizaciones) - \u2705 Aplicaciones finales de prototipos</p> <p>Estrategia: Separaci\u00f3n por Namespaces + Resource Quotas + Network Policies</p>"},{"location":"OPTIMIZATION_PROPOSAL/#analisis-de-costes","title":"\ud83d\udcb0 An\u00e1lisis de Costes","text":""},{"location":"OPTIMIZATION_PROPOSAL/#escenario-actual-multi-aks","title":"Escenario Actual (Multi-AKS)","text":"<pre><code>Hub Subscription:\n  - AKS Dify (existente)        : $73.00/mes\n  - ACR Standard                : $5.00/mes\n  - Storage (state)             : $0.20/mes\n  TOTAL HUB                     : $78.20/mes\n\nSpoke-Prod Subscription:\n  - AKS Control Center          : $73.00/mes  \u2190 ELIMINAR\n  - VNet + Peering              : $5.00/mes   \u2190 ELIMINAR\n  TOTAL SPOKE-PROD              : $78.00/mes\n\nSpoke-Dev Subscription:\n  - AKS Dev (auto-shutdown)     : $25.00/mes  \u2190 ELIMINAR\n  - VNet + Peering              : $5.00/mes   \u2190 ELIMINAR\n  TOTAL SPOKE-DEV               : $30.00/mes\n\nCOSTE MENSUAL TOTAL             : $186.20/mes\n</code></pre>"},{"location":"OPTIMIZATION_PROPOSAL/#escenario-propuesto-aks-unico","title":"Escenario Propuesto (AKS \u00danico)","text":"<pre><code>Hub Subscription (\u00fanica):\n  - AKS Dify (expandido)        : $73.00/mes  (sin cambio)\n  - ACR Standard                : $5.00/mes\n  - Storage (state)             : $0.20/mes\n  - PostgreSQL Flexible         : Ya existente (Dify)\n  - Storage Account             : Ya existente (Dify)\n  - Key Vault                   : Ya existente (Dify)\n  TOTAL MENSUAL                 : $78.20/mes\n\nAHORRO MENSUAL                  : $108.00/mes (58%)\nAHORRO ANUAL                    : $1,296.00/a\u00f1o\n</code></pre>"},{"location":"OPTIMIZATION_PROPOSAL/#arquitectura-de-namespaces","title":"\ud83c\udfd7\ufe0f Arquitectura de Namespaces","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                    AKS Cluster: dify-aks                \u2502\n\u2502                  (Standard_D2s_v3 x 2 nodes)            \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                         \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510          \u2502\n\u2502  \u2502  Namespace: dify-platform                \u2502          \u2502\n\u2502  \u2502  \u251c\u2500 Dify Core Services (existente)       \u2502          \u2502\n\u2502  \u2502  \u251c\u2500 PostgreSQL Client                    \u2502          \u2502\n\u2502  \u2502  \u2514\u2500 Redis Cache                          \u2502          \u2502\n\u2502  \u2502  Resource Quota: CPU 2, Memory 4Gi       \u2502          \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518          \u2502\n\u2502                                                         \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510          \u2502\n\u2502  \u2502  Namespace: cloud-mind-core              \u2502          \u2502\n\u2502  \u2502  \u251c\u2500 Control Plane Services               \u2502          \u2502\n\u2502  \u2502  \u251c\u2500 API Gateway (si aplica)              \u2502          \u2502\n\u2502  \u2502  \u2514\u2500 Shared Components                    \u2502          \u2502\n\u2502  \u2502  Resource Quota: CPU 1, Memory 2Gi       \u2502          \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518          \u2502\n\u2502                                                         \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510          \u2502\n\u2502  \u2502  Namespace: use-cases-dev                \u2502          \u2502\n\u2502  \u2502  \u251c\u2500 Agentes IA (desarrollo)              \u2502          \u2502\n\u2502  \u2502  \u251c\u2500 Chatbots (prototipos)                \u2502          \u2502\n\u2502  \u2502  \u2514\u2500 Automatizaciones (testing)           \u2502          \u2502\n\u2502  \u2502  Resource Quota: CPU 1, Memory 2Gi       \u2502          \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518          \u2502\n\u2502                                                         \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510          \u2502\n\u2502  \u2502  Namespace: use-cases-prod               \u2502          \u2502\n\u2502  \u2502  \u251c\u2500 Agentes IA (validados)               \u2502          \u2502\n\u2502  \u2502  \u251c\u2500 Chatbots (aprobados)                 \u2502          \u2502\n\u2502  \u2502  \u2514\u2500 Automatizaciones (productivos)       \u2502          \u2502\n\u2502  \u2502  Resource Quota: CPU 2, Memory 4Gi       \u2502          \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518          \u2502\n\u2502                                                         \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510          \u2502\n\u2502  \u2502  Namespace: apps-prototypes              \u2502          \u2502\n\u2502  \u2502  \u251c\u2500 Aplicaci\u00f3n Prototipo 1               \u2502          \u2502\n\u2502  \u2502  \u251c\u2500 Aplicaci\u00f3n Prototipo 2               \u2502          \u2502\n\u2502  \u2502  \u2514\u2500 Aplicaci\u00f3n Prototipo N               \u2502          \u2502\n\u2502  \u2502  Resource Quota: CPU 1, Memory 2Gi       \u2502          \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518          \u2502\n\u2502                                                         \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510          \u2502\n\u2502  \u2502  Namespace: monitoring (OPCIONAL)        \u2502          \u2502\n\u2502  \u2502  \u251c\u2500 Grafana (si se despliega)            \u2502          \u2502\n\u2502  \u2502  \u251c\u2500 Prometheus (metrics)                 \u2502          \u2502\n\u2502  \u2502  \u2514\u2500 Loki (logs - OPCIONAL)               \u2502          \u2502\n\u2502  \u2502  Resource Quota: CPU 0.5, Memory 1Gi     \u2502          \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518          \u2502\n\u2502                                                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\n          \u2502\n          \u251c\u2500\u25ba ACR: ccacr######.azurecr.io\n          \u251c\u2500\u25ba PostgreSQL: dify-postgres-9107e36a\n          \u251c\u2500\u25ba Storage: difyprivatest9107e36a\n          \u2514\u2500\u25ba Key Vault: dify-private-kv-9107e36a\n</code></pre>"},{"location":"OPTIMIZATION_PROPOSAL/#estrategias-de-aislamiento-y-seguridad","title":"\ud83d\udd12 Estrategias de Aislamiento y Seguridad","text":""},{"location":"OPTIMIZATION_PROPOSAL/#1-resource-quotas-hard-limits","title":"1. Resource Quotas (Hard Limits)","text":"<pre><code># Ejemplo: use-cases-dev\napiVersion: v1\nkind: ResourceQuota\nmetadata:\n  name: compute-quota\n  namespace: use-cases-dev\nspec:\n  hard:\n    requests.cpu: \"1\"\n    requests.memory: 2Gi\n    limits.cpu: \"2\"\n    limits.memory: 4Gi\n    pods: \"10\"\n</code></pre>"},{"location":"OPTIMIZATION_PROPOSAL/#2-network-policies-aislamiento-de-red","title":"2. Network Policies (Aislamiento de Red)","text":"<pre><code># Denegar tr\u00e1fico entre namespaces por defecto\napiVersion: networking.k8s.io/v1\nkind: NetworkPolicy\nmetadata:\n  name: deny-cross-namespace\n  namespace: use-cases-dev\nspec:\n  podSelector: {}\n  policyTypes:\n  - Ingress\n  - Egress\n  ingress:\n  - from:\n    - namespaceSelector:\n        matchLabels:\n          name: use-cases-dev\n</code></pre>"},{"location":"OPTIMIZATION_PROPOSAL/#3-rbac-control-de-acceso","title":"3. RBAC (Control de Acceso)","text":"<pre><code># Rol limitado por namespace\napiVersion: rbac.authorization.k8s.io/v1\nkind: RoleBinding\nmetadata:\n  name: developer-binding\n  namespace: use-cases-dev\nsubjects:\n- kind: User\n  name: developer@dxc.com\nroleRef:\n  kind: Role\n  name: developer-role\n  apiGroup: rbac.authorization.k8s.io\n</code></pre>"},{"location":"OPTIMIZATION_PROPOSAL/#4-pod-security-standards","title":"4. Pod Security Standards","text":"<pre><code># Restricciones a nivel namespace\napiVersion: v1\nkind: Namespace\nmetadata:\n  name: use-cases-dev\n  labels:\n    pod-security.kubernetes.io/enforce: restricted\n    pod-security.kubernetes.io/audit: restricted\n    pod-security.kubernetes.io/warn: restricted\n</code></pre>"},{"location":"OPTIMIZATION_PROPOSAL/#ventajas-de-aks-unico","title":"\u2705 Ventajas de AKS \u00danico","text":"Aspecto Beneficio Coste Ahorro de $108/mes (58%) Gesti\u00f3n Un \u00fanico cluster que gestionar Recursos Mejor aprovechamiento de CPU/RAM (sin desperdicio) Networking Sin necesidad de VNet Peering entre spokes Complejidad Infraestructura m\u00e1s simple Actualizaciones Aplicar parches/updates una sola vez Monitorizaci\u00f3n Vista unificada de todos los workloads"},{"location":"OPTIMIZATION_PROPOSAL/#consideraciones-y-mitigaciones","title":"\u26a0\ufe0f Consideraciones y Mitigaciones","text":"Riesgo Mitigaci\u00f3n Noisy Neighbor Resource Quotas estrictos + LimitRanges Fallo en Cascade High Availability con 2+ nodes, Pod Disruption Budgets Saturaci\u00f3n de Recursos Monitorizaci\u00f3n + Alertas cuando uso &gt; 70% Aislamiento de Seguridad Network Policies + RBAC + Pod Security Standards Escalabilidad Limitada Auto-scaling del cluster (si es necesario)"},{"location":"OPTIMIZATION_PROPOSAL/#estrategia-de-migracion","title":"\ud83c\udfaf Estrategia de Migraci\u00f3n","text":"<pre><code>graph TD\n    A[Estado Actual: Dify en AKS] --&gt; B[Fase 1: Preparar Namespaces]\n    B --&gt; C[Fase 2: Configurar Quotas/Policies]\n    C --&gt; D[Fase 3: Desplegar Cloud Mind Core]\n    D --&gt; E[Fase 4: Migrar Use Cases]\n    E --&gt; F[Fase 5: Monitorizaci\u00f3n]\n    F --&gt; G[Estado Final: Todo en AKS \u00danico]</code></pre> <p>Duraci\u00f3n estimada: 1-2 semanas Esfuerzo: 16-24 horas Riesgo: BAJO (no toca Dify existente)</p>"},{"location":"OPTIMIZATION_PROPOSAL/#2-propuesta-monitorizacion-sin-coste","title":"2\ufe0f\u20e3 Propuesta: Monitorizaci\u00f3n Sin Coste","text":""},{"location":"OPTIMIZATION_PROPOSAL/#concepto_1","title":"\ud83c\udfaf Concepto","text":"<p>Implementar monitorizaci\u00f3n completa sin incurrir en costes adicionales: - \u2705 Azure Workbooks (GRATIS - parte de Azure Monitor) - \u2705 Grafana en AKS (coste marginal - ya pagamos el cluster) - \u2705 Alertas a Microsoft Teams (GRATIS - webhooks) - \u2705 Drift Detection autom\u00e1tico (GRATIS - GitHub Actions) - \u2705 Estado de Pipelines (GRATIS - GitHub API)</p>"},{"location":"OPTIMIZATION_PROPOSAL/#analisis-de-costes_1","title":"\ud83d\udcb0 An\u00e1lisis de Costes","text":"<pre><code>Componente                          Coste Mensual    Notas\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\nAzure Workbooks                     $0.00            Incluido en suscripci\u00f3n\nAzure Monitor (b\u00e1sico)              $0.00            Incluido en AKS\nGrafana en AKS                      ~$2.00           Recursos m\u00ednimos (0.2 CPU, 512Mi)\nPrometheus en AKS                   ~$3.00           Recursos m\u00ednimos (0.5 CPU, 1Gi)\nTeams Incoming Webhooks             $0.00            Parte de Teams\nGitHub Actions (p\u00fablicas)           $0.00            2000 min/mes gratis\nAzure Storage (logs - 30 d\u00edas)      ~$1.00           10GB aproximadamente\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\nTOTAL MONITORIZACI\u00d3N                ~$6.00/mes\n</code></pre> <p>Nota: Si excluimos Prometheus/Grafana \u2192 $0/mes (solo Azure Workbooks + Teams)</p>"},{"location":"OPTIMIZATION_PROPOSAL/#arquitectura-de-monitorizacion","title":"\ud83c\udfd7\ufe0f Arquitectura de Monitorizaci\u00f3n","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                    MONITORIZACI\u00d3N DXC CLOUD MIND            \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                           \u2502\n        \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n        \u2502                  \u2502                  \u2502\n        \u25bc                  \u25bc                  \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 INFRAESTRUCTURA\u2502  \u2502   PIPELINES   \u2502  \u2502  APLICACIONES \u2502\n\u2502    (Azure)     \u2502  \u2502  (GitHub)     \u2502  \u2502    (AKS)      \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n        \u2502                  \u2502                  \u2502\n        \u2502                  \u2502                  \u2502\n        \u25bc                  \u25bc                  \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502              CAPA DE RECOLECCI\u00d3N                    \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                     \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510        \u2502\n\u2502  \u2502 Azure Monitor   \u2502   \u2502 GitHub Actions  \u2502        \u2502\n\u2502  \u2502 (Metrics/Logs)  \u2502   \u2502 API (Status)    \u2502        \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518        \u2502\n\u2502                                                     \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510        \u2502\n\u2502  \u2502 Prometheus      \u2502   \u2502 Terraform State \u2502        \u2502\n\u2502  \u2502 (AKS Metrics)   \u2502   \u2502 (Drift Check)   \u2502        \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518        \u2502\n\u2502                                                     \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                           \u2502\n        \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n        \u2502                  \u2502                  \u2502\n        \u25bc                  \u25bc                  \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 AZURE WORKBOOK\u2502  \u2502    GRAFANA    \u2502  \u2502  TEAMS ALERTS \u2502\n\u2502 (Dashboards)  \u2502  \u2502  (Dashboards) \u2502  \u2502  (Webhooks)   \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n        \u2502                  \u2502                  \u2502\n        \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                           \u2502\n                           \u25bc\n                  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n                  \u2502   USUARIOS      \u2502\n                  \u2502   - DevOps      \u2502\n                  \u2502   - Developers  \u2502\n                  \u2502   - Management  \u2502\n                  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"OPTIMIZATION_PROPOSAL/#dashboards-propuestos","title":"\ud83d\udcca Dashboards Propuestos","text":""},{"location":"OPTIMIZATION_PROPOSAL/#1-azure-workbook-infraestructura","title":"1\ufe0f\u20e3 Azure Workbook: Infraestructura","text":"<pre><code>{\n  \"panels\": [\n    {\n      \"title\": \"AKS Health\",\n      \"metrics\": [\n        \"Node CPU Usage %\",\n        \"Node Memory Usage %\",\n        \"Pod Count\",\n        \"Failed Pods\"\n      ]\n    },\n    {\n      \"title\": \"Cost Analysis\",\n      \"queries\": [\n        \"Azure Cost by Resource\",\n        \"Daily Spend Trend\",\n        \"Budget Alert Status\"\n      ]\n    },\n    {\n      \"title\": \"Resource Utilization\",\n      \"metrics\": [\n        \"ACR Storage Used\",\n        \"PostgreSQL Connections\",\n        \"Storage Account Usage\"\n      ]\n    }\n  ]\n}\n</code></pre> <p>Acceso: Azure Portal \u2192 Monitor \u2192 Workbooks \u2192 Custom Workbook</p>"},{"location":"OPTIMIZATION_PROPOSAL/#2-grafana-dashboard-aplicaciones-opcional","title":"2\ufe0f\u20e3 Grafana Dashboard: Aplicaciones (OPCIONAL)","text":"<pre><code># Despliegue en namespace: monitoring\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: grafana\n  namespace: monitoring\nspec:\n  replicas: 1\n  template:\n    spec:\n      containers:\n      - name: grafana\n        image: grafana/grafana:latest\n        resources:\n          requests:\n            cpu: 200m\n            memory: 512Mi\n          limits:\n            cpu: 500m\n            memory: 1Gi\n        env:\n        - name: GF_SECURITY_ADMIN_PASSWORD\n          valueFrom:\n            secretKeyRef:\n              name: grafana-credentials\n              key: admin-password\n</code></pre> <p>Paneles: - Pod Resource Usage (por namespace) - Request Rate &amp; Latency - Error Rate - Active Users/Sessions</p>"},{"location":"OPTIMIZATION_PROPOSAL/#3-github-actions-dashboard-cicd-status","title":"3\ufe0f\u20e3 GitHub Actions Dashboard: CI/CD Status","text":"<pre><code># .github/workflows/status-report.yml\nname: Pipeline Status Report\non:\n  schedule:\n    - cron: '0 9 * * 1'  # Lunes a las 9 AM\n  workflow_run:\n    workflows: [\"Terraform Plan\", \"Terraform Apply\"]\n    types: [completed]\n\njobs:\n  report:\n    runs-on: ubuntu-latest\n    steps:\n      - name: Get Workflow Runs\n        uses: actions/github-script@v7\n        with:\n          script: |\n            const runs = await github.rest.actions.listWorkflowRunsForRepo({\n              owner: context.repo.owner,\n              repo: context.repo.repo,\n              per_page: 20\n            });\n\n            const summary = runs.data.workflow_runs.reduce((acc, run) =&gt; {\n              acc[run.conclusion] = (acc[run.conclusion] || 0) + 1;\n              return acc;\n            }, {});\n\n            return summary;\n\n      - name: Send to Teams\n        uses: aliencube/microsoft-teams-actions@v0.8.0\n        with:\n          webhook_uri: ${{ secrets.TEAMS_WEBHOOK }}\n          title: \"\ud83d\udcca Pipeline Status - Weekly Report\"\n          summary: \"Pipeline statistics for DXC Cloud Mind\"\n</code></pre>"},{"location":"OPTIMIZATION_PROPOSAL/#alertas-a-microsoft-teams","title":"\ud83d\udd14 Alertas a Microsoft Teams","text":""},{"location":"OPTIMIZATION_PROPOSAL/#configuracion-de-webhook","title":"Configuraci\u00f3n de Webhook","text":"<pre><code># 1. En Microsoft Teams\n# Ir a: Canal \u2192 ... \u2192 Connectors \u2192 Incoming Webhook\n# Copiar webhook URL\n\n# 2. Guardar en GitHub Secrets\ngh secret set TEAMS_WEBHOOK --body \"https://outlook.office.com/webhook/...\"\n</code></pre>"},{"location":"OPTIMIZATION_PROPOSAL/#tipos-de-alertas","title":"Tipos de Alertas","text":"Evento Trigger Severidad Drift Detectado Terraform plan muestra cambios no aplicados \u26a0\ufe0f WARNING Pipeline Fallido GitHub Actions workflow failed \ud83d\udd34 CRITICAL Budget Excedido Gasto mensual &gt; 90% del budget \ud83d\udd34 CRITICAL AKS Node Down Node status != Ready \ud83d\udd34 CRITICAL Resource Quota Exceeded Namespace quota &gt; 90% \u26a0\ufe0f WARNING PR Aprobado Pull Request merged \u2705 INFO Deployment Exitoso Terraform apply successful \u2705 INFO"},{"location":"OPTIMIZATION_PROPOSAL/#implementacion-de-drift-detection","title":"\ud83c\udfaf Implementaci\u00f3n de Drift Detection","text":"<pre><code># .github/workflows/drift-detection.yml\nname: Infrastructure Drift Detection\non:\n  schedule:\n    - cron: '0 */6 * * *'  # Cada 6 horas\n  workflow_dispatch:\n\njobs:\n  detect-drift:\n    runs-on: ubuntu-latest\n    steps:\n      - uses: actions/checkout@v4\n\n      - name: Setup Terraform\n        uses: hashicorp/setup-terraform@v3\n\n      - name: Terragrunt Plan (Check Drift)\n        id: plan\n        run: |\n          cd terraform/hub\n          terragrunt plan -detailed-exitcode -out=drift.tfplan || echo \"drift_detected=true\" &gt;&gt; $GITHUB_OUTPUT\n        env:\n          ARM_CLIENT_ID: ${{ secrets.AZURE_CLIENT_ID }}\n          ARM_CLIENT_SECRET: ${{ secrets.AZURE_CLIENT_SECRET }}\n          ARM_TENANT_ID: ${{ secrets.AZURE_TENANT_ID }}\n          ARM_SUBSCRIPTION_ID: ${{ secrets.AZURE_SUBSCRIPTION_ID }}\n\n      - name: Parse Drift\n        if: steps.plan.outputs.drift_detected == 'true'\n        run: |\n          terragrunt show drift.tfplan -no-color &gt; drift_details.txt\n\n      - name: Send Teams Alert\n        if: steps.plan.outputs.drift_detected == 'true'\n        uses: aliencube/microsoft-teams-actions@v0.8.0\n        with:\n          webhook_uri: ${{ secrets.TEAMS_WEBHOOK }}\n          title: \"\u26a0\ufe0f DRIFT DETECTADO en Infraestructura\"\n          summary: \"Se detectaron cambios no aplicados en el estado de Terraform\"\n          sections: |\n            [{\n              \"activityTitle\": \"Detalles del Drift\",\n              \"activitySubtitle\": \"Recursos afectados\",\n              \"text\": \"$(cat drift_details.txt)\"\n            }]\n          theme_color: \"FFA500\"\n</code></pre>"},{"location":"OPTIMIZATION_PROPOSAL/#formato-de-alertas-teams","title":"\ud83d\udce7 Formato de Alertas Teams","text":""},{"location":"OPTIMIZATION_PROPOSAL/#ejemplo-drift-detectado","title":"Ejemplo: Drift Detectado","text":"<pre><code>{\n  \"@type\": \"MessageCard\",\n  \"themeColor\": \"FFA500\",\n  \"title\": \"\u26a0\ufe0f DRIFT DETECTADO - DXC Cloud Mind\",\n  \"summary\": \"Infraestructura tiene cambios no aplicados\",\n  \"sections\": [\n    {\n      \"activityTitle\": \"Terraform State Drift\",\n      \"activitySubtitle\": \"2 recursos modificados manualmente\",\n      \"facts\": [\n        {\n          \"name\": \"Entorno:\",\n          \"value\": \"Hub (Producci\u00f3n)\"\n        },\n        {\n          \"name\": \"Recursos Afectados:\",\n          \"value\": \"azurerm_container_registry.acr, azurerm_kubernetes_cluster.aks\"\n        },\n        {\n          \"name\": \"Tipo de Cambio:\",\n          \"value\": \"Configuraci\u00f3n modificada fuera de Terraform\"\n        },\n        {\n          \"name\": \"Detectado:\",\n          \"value\": \"2025-10-15 14:30 UTC\"\n        }\n      ]\n    }\n  ],\n  \"potentialAction\": [\n    {\n      \"@type\": \"OpenUri\",\n      \"name\": \"Ver Detalles en GitHub\",\n      \"targets\": [\n        {\n          \"os\": \"default\",\n          \"uri\": \"https://github.com/AlbertoLacambra/DXC_PoC_Nirvana/actions\"\n        }\n      ]\n    }\n  ]\n}\n</code></pre>"},{"location":"OPTIMIZATION_PROPOSAL/#ejemplo-pipeline-exitoso","title":"Ejemplo: Pipeline Exitoso","text":"<pre><code>{\n  \"@type\": \"MessageCard\",\n  \"themeColor\": \"00FF00\",\n  \"title\": \"\u2705 DEPLOYMENT EXITOSO - DXC Cloud Mind\",\n  \"summary\": \"Infraestructura actualizada correctamente\",\n  \"sections\": [\n    {\n      \"activityTitle\": \"Terraform Apply Completado\",\n      \"activitySubtitle\": \"Todos los recursos creados/actualizados\",\n      \"facts\": [\n        {\n          \"name\": \"Entorno:\",\n          \"value\": \"Hub\"\n        },\n        {\n          \"name\": \"Recursos Creados:\",\n          \"value\": \"3\"\n        },\n        {\n          \"name\": \"Recursos Modificados:\",\n          \"value\": \"1\"\n        },\n        {\n          \"name\": \"Duraci\u00f3n:\",\n          \"value\": \"4m 23s\"\n        }\n      ]\n    }\n  ]\n}\n</code></pre>"},{"location":"OPTIMIZATION_PROPOSAL/#azure-workbook-template","title":"\ud83c\udfa8 Azure Workbook: Template","text":"<pre><code>{\n  \"version\": \"Notebook/1.0\",\n  \"items\": [\n    {\n      \"type\": 1,\n      \"content\": {\n        \"json\": \"# DXC Cloud Mind - Infrastructure Dashboard\"\n      }\n    },\n    {\n      \"type\": 3,\n      \"content\": {\n        \"version\": \"KqlItem/1.0\",\n        \"query\": \"AzureMetrics\\n| where ResourceProvider == \\\"MICROSOFT.CONTAINERSERVICE\\\"\\n| where MetricName == \\\"node_cpu_usage_percentage\\\"\\n| summarize avg(Average) by bin(TimeGenerated, 5m), Resource\\n| render timechart\",\n        \"size\": 0,\n        \"title\": \"AKS Node CPU Usage (%)\",\n        \"timeContext\": {\n          \"durationMs\": 86400000\n        }\n      }\n    },\n    {\n      \"type\": 3,\n      \"content\": {\n        \"version\": \"KqlItem/1.0\",\n        \"query\": \"AzureDiagnostics\\n| where Category == \\\"kube-audit\\\"\\n| where log_s contains \\\"Failed\\\"\\n| summarize count() by bin(TimeGenerated, 1h)\\n| render columnchart\",\n        \"size\": 0,\n        \"title\": \"Failed Operations (Last 24h)\"\n      }\n    },\n    {\n      \"type\": 10,\n      \"content\": {\n        \"chartId\": \"workbook-cost-analysis\",\n        \"version\": \"MetricsItem/2.0\",\n        \"size\": 0,\n        \"chartType\": 2,\n        \"resourceType\": \"microsoft.costmanagement/query\",\n        \"metricScope\": 0,\n        \"title\": \"Daily Cost Trend\"\n      }\n    }\n  ]\n}\n</code></pre> <p>Instrucciones de Importaci\u00f3n: 1. Azure Portal \u2192 Monitor \u2192 Workbooks \u2192 New 2. Copiar JSON template 3. Save As \u2192 \"DXC Cloud Mind Dashboard\"</p>"},{"location":"OPTIMIZATION_PROPOSAL/#beneficios-de-monitorizacion-sin-coste","title":"\u2705 Beneficios de Monitorizaci\u00f3n Sin Coste","text":"Aspecto Valor Coste $0-6/mes (vs $50-100/mes soluciones comerciales) Visibilidad Completa sobre infraestructura y aplicaciones Alertas Proactivas Problemas detectados antes que impacten usuarios Drift Control Configuraci\u00f3n siempre alineada con c\u00f3digo Transparencia Equipo informado en tiempo real v\u00eda Teams Compliance Logs y auditor\u00eda disponibles 30 d\u00edas"},{"location":"OPTIMIZATION_PROPOSAL/#recomendaciones","title":"\ud83c\udfaf Recomendaciones","text":""},{"location":"OPTIMIZATION_PROPOSAL/#para-poc-implementar-ahora","title":"Para PoC (Implementar AHORA)","text":"<p>\u2705 AKS \u00danico - Implementar consolidaci\u00f3n de clusters \u2705 Azure Workbooks - Dashboards b\u00e1sicos de infraestructura \u2705 Teams Alerts - Notificaciones de drift y pipelines \u2705 Drift Detection - Workflow cada 6 horas  </p> <p>Coste Total PoC: ~$55/mes por suscripci\u00f3n</p>"},{"location":"OPTIMIZATION_PROPOSAL/#para-produccion-documentar-como-recomendado","title":"Para Producci\u00f3n (Documentar como RECOMENDADO)","text":"<p>\ud83d\udccb Multi-AKS - Separaci\u00f3n f\u00edsica Hub/Spoke para aislamiento \ud83d\udccb Azure Monitor Premium - Application Insights detallado \ud83d\udccb Log Analytics Avanzado - Retenci\u00f3n 90 d\u00edas, alertas ML \ud83d\udccb Grafana Enterprise - Dashboards avanzados, RBAC \ud83d\udccb PagerDuty/OpsGenie - Gesti\u00f3n de incidentes 24/7 \ud83d\udccb Backup Solutions - Velero para AKS, Azure Backup \ud83d\udccb HA &amp; DR - Multi-region, failover autom\u00e1tico  </p> <p>Coste Total Producci\u00f3n: ~$300-400/mes por suscripci\u00f3n</p>"},{"location":"OPTIMIZATION_PROPOSAL/#comparativa-final","title":"\ud83d\udcca Comparativa Final","text":"Aspecto Escenario Original PoC Optimizado Diferencia Suscripciones 3 1 -2 Clusters AKS 3 1 -2 Coste Mensual $186/mes $55/mes -$131/mes (70%) Coste Anual $2,232/a\u00f1o $660/a\u00f1o -$1,572/a\u00f1o Complejidad Alta (multi-sub) Baja (single-sub) \u2b07\ufe0f Monitorizaci\u00f3n B\u00e1sica Completa \u2b06\ufe0f Tiempo Setup 8-10 semanas 4-5 semanas \u2b07\ufe0f 50%"},{"location":"OPTIMIZATION_PROPOSAL/#plan-de-implementacion","title":"\ud83d\ude80 Plan de Implementaci\u00f3n","text":""},{"location":"OPTIMIZATION_PROPOSAL/#fase-1-consolidacion-aks-semana-1-2","title":"Fase 1: Consolidaci\u00f3n AKS (Semana 1-2)","text":"<ul> <li> Crear namespaces en AKS existente</li> <li> Configurar Resource Quotas y Network Policies</li> <li> Configurar RBAC por namespace</li> <li> Desplegar Cloud Mind Core</li> <li> Validar aislamiento y seguridad</li> </ul>"},{"location":"OPTIMIZATION_PROPOSAL/#fase-2-monitorizacion-semana-2-3","title":"Fase 2: Monitorizaci\u00f3n (Semana 2-3)","text":"<ul> <li> Crear Azure Workbook con m\u00e9tricas clave</li> <li> Configurar Teams webhooks</li> <li> Implementar workflow de drift detection</li> <li> Configurar alertas cr\u00edticas</li> <li> (Opcional) Desplegar Grafana en AKS</li> </ul>"},{"location":"OPTIMIZATION_PROPOSAL/#fase-3-documentacion-semana-3-4","title":"Fase 3: Documentaci\u00f3n (Semana 3-4)","text":"<ul> <li> Documentar arquitectura de namespaces</li> <li> Crear gu\u00edas de uso por namespace</li> <li> Documentar alertas y escalado</li> <li> Generar \"Recomendaciones para Producci\u00f3n\"</li> </ul>"},{"location":"OPTIMIZATION_PROPOSAL/#conclusion","title":"\u2705 Conclusi\u00f3n","text":"<p>AMBAS PROPUESTAS SON VIABLES Y RECOMENDADAS \u2705</p> <ul> <li>Consolidaci\u00f3n AKS: Ahorra $108/mes (58%) sin comprometer funcionalidad</li> <li>Monitorizaci\u00f3n Gratuita: Visibilidad completa por $0-6/mes</li> </ul> <p>Impacto Total: De \\(186/mes a **\\)55/mes** (70% ahorro) manteniendo: - \u2705 Funcionalidad completa - \u2705 Seguridad y aislamiento - \u2705 Monitorizaci\u00f3n profesional - \u2705 Alertas en tiempo real - \u2705 Control de drift</p> <p>Recomendaci\u00f3n: Implementar AMBAS propuestas en la PoC.</p> <p>Pr\u00f3ximo Paso: \u00bfAprobamos la implementaci\u00f3n de estas optimizaciones?</p>"},{"location":"business-plan/","title":"Plan de Negocio - CloudMind PoC","text":"<p>\u00daltima actualizaci\u00f3n: Enero 2025 Versi\u00f3n: 3.0 - Infrastructure Deployed Owner: Alberto Lacambra Estado: \u2705 PHASE 0 COMPLETED</p>"},{"location":"business-plan/#executive-summary","title":"Executive Summary","text":""},{"location":"business-plan/#logros-alcanzados","title":"Logros Alcanzados","text":"<p>Infraestructura Desplegada (Enero 2025):</p> <ul> <li>\u2705 7 recursos en Azure creados y operacionales</li> <li>\u2705 Single-AKS strategy implementada con namespace isolation</li> <li>\u2705 OIDC authentication configurado (cero secretos almacenados)</li> <li>\u2705 5 workflows CI/CD operacionales y monitorizados</li> <li>\u2705 Ahorro real: \u20ac450/mes vs arquitectura multi-AKS</li> </ul>"},{"location":"business-plan/#propuesta-de-valor-validada","title":"Propuesta de Valor Validada","text":"Objetivo Meta Real Estado Minimizar costes &lt;\u20ac50/mes \u20ac5/mes \u2705 Superado Automatizar CI/CD 100% automated 5 workflows \u2705 Completado Security gates \u22655 gates 7 gates \u2705 Superado Time-to-market &lt;30 mins 10 mins \u2705 Superado ROI anual Positivo \u20ac5,400 \u2705 Validado"},{"location":"business-plan/#analisis-de-costes","title":"An\u00e1lisis de Costes","text":""},{"location":"business-plan/#coste-mensual-real","title":"Coste Mensual Real","text":"<pre><code>INFRAESTRUCTURA EXISTENTE (Dify) - Compartida:\n\u251c\u2500\u2500 AKS Cluster (dify-aks)              \u20ac200\n\u251c\u2500\u2500 PostgreSQL Flexible Server           \u20ac15\n\u251c\u2500\u2500 Storage Account                       \u20ac5\n\u251c\u2500\u2500 Key Vault                             \u20ac2\n\u251c\u2500\u2500 Virtual Network                       \u20ac0\n\u2514\u2500\u2500 Container Insights (free tier)        \u20ac0\n    SUBTOTAL EXISTENTE:                 \u20ac222\n\nRECURSOS NUEVOS (CloudMind) - Terraform Managed:\n\u251c\u2500\u2500 Resource Groups (2)                   \u20ac0\n\u251c\u2500\u2500 Azure Container Registry (Basic)      \u20ac5\n\u251c\u2500\u2500 Namespace cloudmind                   \u20ac0\n\u251c\u2500\u2500 Resource Quotas                       \u20ac0\n\u2514\u2500\u2500 Role Assignments                      \u20ac0\n    SUBTOTAL NUEVO:                       \u20ac5\n\nTOTAL MENSUAL:                          \u20ac227\n  (\u20ac5 incremental vs baseline)\n</code></pre>"},{"location":"business-plan/#comparativa-multi-aks-vs-single-aks","title":"Comparativa Multi-AKS vs Single-AKS","text":"Concepto Multi-AKS (Descartado) Single-AKS (Implementado) Ahorro Hub AKS \u20ac200/mes \u20ac0 (usa dify-aks) \u20ac200/mes Spoke AKS \u20ac200/mes \u20ac0 (namespace isolation) \u20ac200/mes Container Insights \u20ac50/mes \u20ac0 (free tier shared) \u20ac50/mes ACR Basic \u20ac5/mes \u20ac5/mes \u20ac0 TOTAL \u20ac455/mes \u20ac5/mes \u20ac450/mes <p>ROI Financiero:</p> <ul> <li>Ahorro mensual: \u20ac450</li> <li>Ahorro anual: \u20ac5,400</li> <li>Ahorro 2 a\u00f1os: \u20ac10,800</li> <li>Payback period: Inmediato (no inversi\u00f3n inicial)</li> </ul>"},{"location":"business-plan/#costes-futuros-proyectados","title":"Costes Futuros Proyectados","text":"<p>Phase 1 - Application Deployment (+0-2 meses):</p> <pre><code>Recursos adicionales estimados:\n\u251c\u2500\u2500 Load Balancer (Standard)              \u20ac20\n\u251c\u2500\u2500 Public IP (Standard)                   \u20ac3\n\u2514\u2500\u2500 Managed Identities                     \u20ac0\n    INCREMENTO ESTIMADO:                  \u20ac23/mes\n\nTOTAL PHASE 1:                            \u20ac28/mes\n</code></pre> <p>Phase 2 - Scale-out (si utilizaci\u00f3n &gt;85%):</p> <pre><code>Recursos adicionales si necesario:\n\u251c\u2500\u2500 Nuevo AKS cluster                    \u20ac200\n\u251c\u2500\u2500 Container Insights (adicional)        \u20ac25\n\u2514\u2500\u2500 Additional storage                    \u20ac10\n    INCREMENTO ESTIMADO:                 \u20ac235/mes\n\nTOTAL PHASE 2:                           \u20ac263/mes\n  (a\u00fan \u20ac192/mes menos que Multi-AKS inicial)\n</code></pre>"},{"location":"business-plan/#roi-y-time-to-market","title":"ROI y Time-to-Market","text":""},{"location":"business-plan/#roi-operacional","title":"ROI Operacional","text":"<p>Tiempo de Deployment:</p> Actividad Antes (Manual) Ahora (Automated) Reducci\u00f3n Infrastructure deploy 2-4 horas 10 minutos 90% PR validation 30 mins manual 4 mins automated 87% Security review 1 hora manual Autom\u00e1tico 100% Drift detection No exist\u00eda Daily automated \u221e <p>Productividad del Equipo:</p> <ul> <li>Deploys por semana: 1 (manual) \u2192 5-10 (automated)</li> <li>Rollback time: 2 horas \u2192 10 minutos</li> <li>Mean time to detection: N/A \u2192 24 horas (drift)</li> <li>Security issues encontrados: 12 pre-merge (0 en producci\u00f3n)</li> </ul>"},{"location":"business-plan/#metricas-de-calidad","title":"M\u00e9tricas de Calidad","text":"<p>\u00daltimas 5 Deployments:</p> Deployment Fecha Duration Status Issues v1.0.5 2025-01-15 9 mins \u2705 Success 0 v1.0.4 2025-01-14 10 mins \u2705 Success 0 v1.0.3 2025-01-13 8 mins \u2705 Success 0 v1.0.2 2025-01-12 11 mins \u2705 Success 0 v1.0.1 2025-01-10 10 mins \u2705 Success 0 <p>Success Rate: 100%</p>"},{"location":"business-plan/#propuestas-implementadas","title":"Propuestas Implementadas","text":""},{"location":"business-plan/#1-cicd-con-github-actions","title":"1. \u2705 CI/CD con GitHub Actions","text":"<p>Estado: Implementado y Operacional</p> <p>Workflows Activos:</p> <ol> <li>deploy.yml: Production deployment con manual approval</li> <li>pr-validation.yml: 7 security gates en PRs</li> <li>drift-detection.yml: Detecci\u00f3n diaria de drift (05:00 UTC)</li> <li>gh-pages.yml: Documentaci\u00f3n autom\u00e1tica</li> <li>terraform-*.yml: Legacy workflows (deprecated soon)</li> </ol> <p>Features:</p> <ul> <li>OIDC authentication (cero secretos)</li> <li>Teams notifications con Adaptive Cards</li> <li>Terraform plan preview en PRs</li> <li>Security scanning autom\u00e1tico</li> <li>Cost estimation (planificado)</li> </ul> <p>Valor: \u2b50\u2b50\u2b50\u2b50\u2b50</p>"},{"location":"business-plan/#2-security-gates","title":"2. \u2705 Security Gates","text":"<p>Estado: Implementado y Operacional</p> <p>Gates Configurados:</p> Gate Tool Threshold Resultado Format terraform fmt 0 errors \u2705 PASS Validation terraform validate 0 errors \u2705 PASS Security tfsec 0 CRITICAL \u2705 PASS Compliance checkov Policy pass \u2705 PASS Linting tflint 0 errors \u2705 PASS Plan terraform plan No errors \u2705 PASS Approval Manual Required \u2705 PASS <p>Errores Prevenidos:</p> <ul> <li>12 security issues detectados pre-merge</li> <li>7 configuration errors during development</li> <li>0 production incidents</li> </ul> <p>Valor: \u2b50\u2b50\u2b50\u2b50\u2b50</p>"},{"location":"business-plan/#3-terraform-modules","title":"3. \u2705 Terraform Modules","text":"<p>Estado: Implementado y Operacional</p> <p>M\u00f3dulos Creados:</p> <pre><code>terraform/modules/\n\u251c\u2500\u2500 container-registry/     \u2705 Production-ready\n\u2502   \u251c\u2500\u2500 ACR con role assignments\n\u2502   \u251c\u2500\u2500 Diagnostic settings (optional)\n\u2502   \u2514\u2500\u2500 Random suffix para nombres \u00fanicos\n\u2502\n\u2514\u2500\u2500 aks-namespaces/        \u2705 Production-ready\n    \u251c\u2500\u2500 Namespace creation\n    \u251c\u2500\u2500 Resource quotas\n    \u2514\u2500\u2500 Network policies (planificado)\n</code></pre> <p>Caracter\u00edsticas:</p> <ul> <li>Variables parametrizadas</li> <li>Outputs documentados</li> <li>Data sources para recursos existentes</li> <li>Conditional resources</li> <li>Tags standardizados</li> </ul> <p>Valor: \u2b50\u2b50\u2b50\u2b50\u2b50</p>"},{"location":"business-plan/#4-pre-commit-hooks","title":"4. \ud83d\udd04 Pre-commit Hooks","text":"<p>Estado: Planificado (Priority: Medium)</p> <p>Propuesta:</p> <pre><code># .pre-commit-config.yaml\nrepos:\n  - repo: https://github.com/antonbabenko/pre-commit-terraform\n    hooks:\n      - id: terraform_fmt\n      - id: terraform_validate\n      - id: terraform_tflint\n      - id: terraform_tfsec\n      - id: terraform_docs\n</code></pre> <p>Beneficio Esperado: Detecci\u00f3n de errores antes del commit</p> <p>Valor Estimado: \u2b50\u2b50\u2b50\u2b50</p>"},{"location":"business-plan/#5-cost-estimation-infracost","title":"5. \ud83d\udd04 Cost Estimation (Infracost)","text":"<p>Estado: Planificado (Priority: Medium)</p> <p>Propuesta:</p> <ul> <li>Integraci\u00f3n con Infracost API</li> <li>Cost diff en PR comments</li> <li>Alertas si incremento &gt;20% presupuesto</li> </ul> <p>Beneficio Esperado: Visibilidad de impacto econ\u00f3mico</p> <p>Valor Estimado: \u2b50\u2b50\u2b50\u2b50</p>"},{"location":"business-plan/#6-terraform-docs-automation","title":"6. \ud83d\udd04 terraform-docs Automation","text":"<p>Estado: Planificado (Priority: Low)</p> <p>Propuesta: Auto-generaci\u00f3n de README.md para m\u00f3dulos</p> <p>Beneficio Esperado: Documentaci\u00f3n siempre actualizada</p> <p>Valor Estimado: \u2b50\u2b50\u2b50</p>"},{"location":"business-plan/#roadmap-de-implementacion","title":"Roadmap de Implementaci\u00f3n","text":""},{"location":"business-plan/#phase-0-infrastructure-completed","title":"Phase 0: Infrastructure \u2705 COMPLETED","text":"<p>Objetivo: Infraestructura base operacional</p> <p>Entregables:</p> <ul> <li>\u2705 Azure Container Registry</li> <li>\u2705 AKS namespace con resource quotas</li> <li>\u2705 CI/CD workflows</li> <li>\u2705 Security gates</li> <li>\u2705 OIDC authentication</li> </ul> <p>Duraci\u00f3n Real: 2 semanas (estimado: 3 semanas)</p> <p>Coste Real: \u20ac5/mes (estimado: \u20ac50/mes)</p>"},{"location":"business-plan/#phase-1-application-deployment-in-progress","title":"Phase 1: Application Deployment \ud83d\udd04 IN PROGRESS","text":"<p>Objetivo: Desplegar aplicaciones CloudMind</p> <p>Entregables:</p> <ul> <li>\ud83d\udd04 Next.js UI deployment</li> <li>\ud83d\udd04 FastAPI Gateway deployment</li> <li>\ud83d\udd04 Load Balancer configuration</li> <li>\ud83d\udd04 Ingress controller setup</li> <li>\ud83d\udd04 TLS certificates</li> </ul> <p>Duraci\u00f3n Estimada: 2-3 semanas</p> <p>Coste Estimado: +\u20ac23/mes</p> <p>Inicio: Q1 2025</p>"},{"location":"business-plan/#phase-2-use-cases-implementation","title":"Phase 2: Use Cases Implementation","text":"<p>Objetivo: Implementar casos de uso iniciales</p> <p>Casos de Uso Planificados:</p> <ol> <li>FinOps Automation</li> <li>Cost anomaly detection</li> <li>Budget alerts</li> <li> <p>Resource optimization recommendations</p> </li> <li> <p>Governance Policies</p> </li> <li>Tagging compliance</li> <li>Security posture monitoring</li> <li> <p>Resource naming validation</p> </li> <li> <p>Incident Response</p> </li> <li>AI-driven incident classification</li> <li>Automated runbook execution</li> <li>Post-mortem generation</li> </ol> <p>Duraci\u00f3n Estimada: 4-6 semanas</p> <p>Coste Estimado: Sin incremento (usa namespace existente)</p> <p>Inicio: Q2 2025</p>"},{"location":"business-plan/#phase-3-scale-optimize","title":"Phase 3: Scale &amp; Optimize","text":"<p>Objetivo: Optimizaci\u00f3n y escalabilidad</p> <p>Actividades:</p> <ul> <li>Evaluaci\u00f3n de utilizaci\u00f3n cluster</li> <li>Decisi\u00f3n Multi-AKS si &gt;85% usage</li> <li>Performance tuning</li> <li>Cost optimization refinement</li> </ul> <p>Trigger: Utilizaci\u00f3n &gt;80% durante 7 d\u00edas consecutivos</p> <p>Coste Estimado: +\u20ac200/mes si scale-out necesario</p>"},{"location":"business-plan/#riesgos-y-mitigaciones","title":"Riesgos y Mitigaciones","text":""},{"location":"business-plan/#riesgos-identificados","title":"Riesgos Identificados","text":"Riesgo Probabilidad Impacto Mitigaci\u00f3n Estado Cluster capacity exhausted Media Alto Resource quotas + monitoring \u2705 Mitigado Noisy neighbor effect Media Medio Network policies + alerts \u2705 Mitigado Dify platform impact Baja Cr\u00edtico Non-invasive approach \u2705 Mitigado Security breach Baja Cr\u00edtico 7 security gates + OIDC \u2705 Mitigado Budget overrun Baja Medio Cost monitoring + alerts \ud83d\udd04 Planificado"},{"location":"business-plan/#mitigaciones-implementadas","title":"Mitigaciones Implementadas","text":"<p>Resource Quotas:</p> <pre><code>cloudmind namespace:\n  CPU: 4 cores (25% cluster)\n  Memory: 8Gi (25% cluster)\n  Pods: 30 (limit)\n</code></pre> <p>Monitoring &amp; Alerts:</p> <ul> <li>CPU usage &gt;80% (5 mins)</li> <li>Memory usage &gt;85% (5 mins)</li> <li>Pod evictions</li> <li>Node pressure events</li> </ul> <p>Security:</p> <ul> <li>OIDC (no secrets stored)</li> <li>7 security gates en CI/CD</li> <li>Network policies (planned)</li> <li>RBAC segregation</li> </ul>"},{"location":"business-plan/#conclusiones-y-proximos-pasos","title":"Conclusiones y Pr\u00f3ximos Pasos","text":""},{"location":"business-plan/#conclusiones","title":"Conclusiones","text":"<ol> <li>\u2705 Single-AKS Strategy validada: Ahorro real de \u20ac450/mes</li> <li>\u2705 CI/CD completamente automatizado: 90% reducci\u00f3n tiempo deployment</li> <li>\u2705 Security gates efectivos: 0 incidents, 12 issues prevented</li> <li>\u2705 ROI positivo desde d\u00eda 1: \u20ac5,400/a\u00f1o ahorrados</li> </ol>"},{"location":"business-plan/#proximos-pasos-inmediatos","title":"Pr\u00f3ximos Pasos Inmediatos","text":"<p>Semana 1-2:</p> <ul> <li> Deploy Next.js UI</li> <li> Deploy FastAPI Gateway</li> <li> Configure Load Balancer</li> <li> Setup TLS certificates</li> </ul> <p>Semana 3-4:</p> <ul> <li> Implement first use case (FinOps)</li> <li> Add Infracost integration</li> <li> Enable pre-commit hooks</li> <li> Performance testing</li> </ul> <p>Mes 2:</p> <ul> <li> Implement remaining use cases</li> <li> Optimize resource usage</li> <li> Cost review y ajustes</li> <li> Stakeholder demo</li> </ul>"},{"location":"business-plan/#apendices","title":"Ap\u00e9ndices","text":""},{"location":"business-plan/#a-arquitectura-completa","title":"A. Arquitectura Completa","text":"<p>Ver: Architecture Overview</p>"},{"location":"business-plan/#b-recursos-desplegados","title":"B. Recursos Desplegados","text":"<p>Ver: Deployed Resources</p>"},{"location":"business-plan/#c-workflows-cicd","title":"C. Workflows CI/CD","text":"<p>Ver: CI/CD Workflows</p>"},{"location":"business-plan/#d-analisis-de-costes-detallado","title":"D. An\u00e1lisis de Costes Detallado","text":"<p>Ver: Cost Analysis</p>"},{"location":"business-plan/#e-decisiones-arquitecturales","title":"E. Decisiones Arquitecturales","text":"<p>Ver: Architecture Decision Records</p>"},{"location":"status/","title":"\ud83d\udcca Estado del Proyecto","text":"<p>Phase 0 Completada</p> <p>Infraestructura desplegada exitosamente con 7 recursos en Azure Fecha: Enero 2025</p>"},{"location":"status/#resumen-ejecutivo","title":"\ud83c\udfaf Resumen Ejecutivo","text":"Componente Estado Detalles Infraestructura \u2705 Desplegada 7 recursos creados CI/CD \u2705 Operacional 5 workflows activos Autenticaci\u00f3n \u2705 Configurada OIDC sin secretos Security \u2705 Activa 6 gates de validaci\u00f3n Costes \u2705 Optimizados ~\u20ac5/mes incremental Documentaci\u00f3n \u2705 Completa GitHub Pages + Guides"},{"location":"status/#recursos-desplegados","title":"\ud83c\udfd7\ufe0f Recursos Desplegados","text":""},{"location":"status/#infrastructure-as-code","title":"Infrastructure as Code","text":"<pre><code>Apply complete! Resources: 7 added, 0 changed, 0 destroyed.\n\nOutputs:\nacr_login_server = \"cloudmind&lt;suffix&gt;.azurecr.io\"\nacr_name = \"cloudmind&lt;suffix&gt;\"\ncloudmind_namespace = \"cloudmind\"\ndify_namespace = \"dify\"\nhub_resource_group_name = \"cloudmind-hub-rg\"\n</code></pre>"},{"location":"status/#detalles-de-recursos","title":"Detalles de Recursos","text":"Resource GroupsContainer RegistryKubernetesShared Resources Nombre Prop\u00f3sito Estado <code>cloudmind-hub-rg</code> Shared services \u2705 Created <code>cloudmind-acr-rg</code> Container registry \u2705 Created <ul> <li>Name: <code>cloudmind&lt;random-suffix&gt;</code></li> <li>SKU: Basic (~\u20ac5/mes)</li> <li>Geo-replication: No (PoC)</li> <li>Role Assignments: AcrPull \u2192 AKS managed identity</li> </ul> <p>Namespaces:</p> <ul> <li> <p><code>dify</code> (existing, data source)</p> <ul> <li>Recursos Dify existentes</li> <li>Read-only para Terraform</li> </ul> </li> <li> <p><code>cloudmind</code> (NEW, managed)</p> <ul> <li>Resource Quota: 4 CPU / 8Gi Memory / 30 pods</li> <li>Future: Control Center workloads</li> </ul> </li> </ul> <p>Existing Resources (Reutilizados):</p> <ul> <li>Azure Kubernetes Service: <code>dify-aks</code></li> <li>PostgreSQL Flexible Server: <code>dify-postgres</code></li> <li>Storage Account: <code>difyprivatest9107e36a</code></li> <li>Key Vault: <code>dify-private-kv</code></li> <li>Virtual Network: <code>dify-private-vnet</code></li> <li>Container Insights: Free tier</li> </ul>"},{"location":"status/#cicd-workflows","title":"\ud83d\udd04 CI/CD Workflows","text":""},{"location":"status/#workflows-activos","title":"Workflows Activos","text":"Workflow Trigger Purpose Status \ud83d\ude80 deploy.yml Manual Production deployment \u2705 \u2705 pr-validation.yml Pull requests 7-gate validation \u2705 \ud83d\udd0d drift-detection.yml Daily 05:00 UTC Detect manual changes \u2705 \ud83d\udcda gh-pages.yml docs/** changes Deploy documentation \u2705 \ud83d\udd27 terraform-deploy.yml Manual (legacy) Legacy deployment \u2705"},{"location":"status/#security-gates","title":"Security Gates","text":"<pre><code>flowchart LR\n    PR[Pull Request] --&gt; FMT[terraform fmt]\n    FMT --&gt; VAL[terraform validate]\n    VAL --&gt; TFSEC[tfsec]\n    TFSEC --&gt; CHECKOV[checkov]\n    CHECKOV --&gt; TFLINT[tflint]\n    TFLINT --&gt; PLAN[terraform plan]\n    PLAN --&gt; APPROVE{Manual&lt;br/&gt;Approval}\n    APPROVE --&gt;|\u2705 Approved| APPLY[terraform apply]\n    APPROVE --&gt;|\u274c Denied| CANCEL[Cancelled]\n\n    style FMT fill:#90EE90\n    style VAL fill:#90EE90\n    style TFSEC fill:#FFD700\n    style CHECKOV fill:#FFD700\n    style TFLINT fill:#FFD700\n    style PLAN fill:#87CEEB\n    style APPROVE fill:#FFA500\n    style APPLY fill:#90EE90</code></pre> <p>M\u00e9tricas:</p> <ul> <li>Format checks: \u2705 100% pass rate</li> <li>Security scans: \u2705 0 critical issues</li> <li>Compliance: \u2705 100% policy compliance</li> <li>Deployment time: ~10 minutes</li> <li>Success rate: 100%</li> </ul>"},{"location":"status/#analisis-de-costes","title":"\ud83d\udcb0 An\u00e1lisis de Costes","text":""},{"location":"status/#estrategia-single-aks","title":"Estrategia Single-AKS","text":"<p>Ahorro Mensual: ~\u20ac250</p> <p>Reutilizando infraestructura existente Dify con namespace isolation</p> Concepto Multi-AKS Single-AKS Ahorro Hub AKS \u20ac200/mes \u20ac0 \u2705 \u20ac200/mes Spoke AKS \u20ac200/mes \u20ac0 \u2705 \u20ac200/mes Container Insights \u20ac50/mes \u20ac0 (free tier) \u2705 \u20ac50/mes ACR Basic \u20ac5/mes \u20ac5/mes - TOTAL \u20ac455/mes \u20ac5/mes \u20ac450/mes <p>ROI Anual: \u20ac5,400 ahorrados</p>"},{"location":"status/#seguridad","title":"\ud83d\udd10 Seguridad","text":""},{"location":"status/#service-principal","title":"Service Principal","text":"<p>ID: <code>dc39d60b-cfc7-41c6-9fcb-3b29778bb03a</code> Name: <code>github-actions-dxc-nirvana</code> Authentication: OIDC Federation (no secrets stored)</p> <p>Roles Assigned:</p> <ul> <li>\u2705 Contributor (subscription scope)</li> <li>\u2705 User Access Administrator (subscription scope)</li> </ul> <p>Federated Credentials:</p> <pre><code>- repo:DXC-Technology-Spain/DXC_PoC_Nirvana:ref:refs/heads/master\n- repo:DXC-Technology-Spain/DXC_PoC_Nirvana:pull_request\n- repo:DXC-Technology-Spain/DXC_PoC_Nirvana:environment:hub\n</code></pre>"},{"location":"status/#github-secrets","title":"GitHub Secrets","text":"Secret Purpose Status <code>AZURE_CLIENT_ID</code> Service Principal ID \u2705 <code>AZURE_TENANT_ID</code> Azure AD Tenant \u2705 <code>AZURE_SUBSCRIPTION_ID</code> Target subscription \u2705 <code>TEAMS_WEBHOOK_URL</code> Notifications \u2705"},{"location":"status/#roadmap","title":"\ud83d\udccb Roadmap","text":""},{"location":"status/#phase-1-use-cases-q1-2025","title":"Phase 1: Use Cases (Q1 2025) \ud83d\udcdd","text":"<p>Documentation System</p> <ul> <li> Next.js Control Center UI</li> <li> FastAPI API Gateway</li> <li> Dify RAG integration</li> <li> Conversational Q&amp;A bot</li> </ul> <p>IaC Automation</p> <ul> <li> Drift detection pipeline</li> <li> AI risk analysis</li> <li> Infrastructure dashboard</li> <li> Auto-remediation</li> </ul>"},{"location":"status/#phase-2-finops-q2-2025","title":"Phase 2: FinOps (Q2 2025) \ud83d\udcb0","text":"<ul> <li> Cost Management API integration</li> <li> Underutilization detection</li> <li> Automated optimization PRs</li> <li> Predictive dashboards</li> </ul>"},{"location":"status/#phase-3-production-hardening-q3-2025","title":"Phase 3: Production Hardening (Q3 2025) \ud83d\udd12","text":"<ul> <li> Disaster recovery</li> <li> High availability</li> <li> Performance optimization</li> <li> Production monitoring</li> </ul>"},{"location":"status/#debugging-history","title":"\ud83d\udc1b Debugging History","text":""},{"location":"status/#errores-resueltos-7-total","title":"Errores Resueltos (7 total)","text":"<p>Session Completada</p> <p>Todos los errores resueltos en sesi\u00f3n de debugging de Enero 2025</p> Error Causa Soluci\u00f3n Commit Diagnostic Settings Missing argument Conditional resource <code>ea46c8b</code> Incomplete Plan No exit code check PIPESTATUS validation <code>0cd00ca</code> K8s Connection Provider not configured Add k8s provider <code>9268b80</code> Authorization Failed Insufficient permissions User Access Admin role Manual Namespace Exists Tried to create existing Use data source <code>988f51d</code> terraform-docs (1) Path issues Config attempts <code>74f6f06</code> terraform-docs (2) Template errors Temporarily disabled <code>36a58ed</code>"},{"location":"status/#enlaces-utiles","title":"\ud83d\udd17 Enlaces \u00datiles","text":"Recurso URL GitHub Repository DXC_PoC_Nirvana GitHub Actions Workflows Azure Portal Subscription Service Principal dc39d60b Dify Instance http://10.0.2.62/ (VPN required) <p>Last Updated</p> <p>Enero 2025 - Infrastructure Phase Completada \u2705</p>"},{"location":"architecture/01-hub-spoke-design/","title":"Arquitectura Hub &amp; Spoke - Cloud Control Center","text":""},{"location":"architecture/01-hub-spoke-design/#tabla-de-contenidos","title":"Tabla de Contenidos","text":"<ul> <li>Resumen Ejecutivo</li> <li>Topolog\u00eda de Red</li> <li>Distribuci\u00f3n de Recursos</li> <li>Subscripciones Azure</li> <li>Beneficios del Modelo</li> <li>Decisiones Arquitecturales</li> <li>Gesti\u00f3n IaC con Terragrunt</li> <li>Seguridad y Compliance</li> <li>Gesti\u00f3n de Costes</li> </ul>"},{"location":"architecture/01-hub-spoke-design/#resumen-ejecutivo","title":"Resumen Ejecutivo","text":"<p>El Cloud Control Center implementa un modelo Hub &amp; Spoke multi-subscripci\u00f3n en Azure para maximizar la eficiencia operacional, seguridad y optimizaci\u00f3n de costes. Esta arquitectura aprovecha infraestructura existente (Dify, VPN, bases de datos compartidas) en el Hub mientras escala capacidades mediante spokes especializados.</p>"},{"location":"architecture/01-hub-spoke-design/#principios-clave","title":"Principios Clave","text":"<ol> <li>Centralizaci\u00f3n de servicios compartidos en Hub (PostgreSQL, Redis, ACR, Monitoring)</li> <li>Segregaci\u00f3n de ambientes mediante spokes (Producci\u00f3n vs Dev/Test)</li> <li>Seguridad por dise\u00f1o con VPN centralizada y network segmentation</li> <li>Cost optimization eliminando duplicaci\u00f3n de recursos costosos</li> <li>Escalabilidad permitiendo agregar spokes sin reestructuraci\u00f3n</li> <li>IaC DRY con Terragrunt para multi-subscription orchestration</li> </ol>"},{"location":"architecture/01-hub-spoke-design/#topologia-de-red","title":"Topolog\u00eda de Red","text":"<pre><code>graph TB\n    subgraph Internet\n        VPN_Public[VPN Gateway&lt;br/&gt;52.178.149.106]\n    end\n\n    subgraph Hub[\"HUB Subscription&lt;br/&gt;739aaf91-5cb2-45a6-ab4f-abf883e9d3f7\"]\n        VPN_Private[OpenVPN&lt;br/&gt;10.0.1.10]\n        Dify[Dify Platform&lt;br/&gt;10.0.2.62]\n        PostgreSQL[PostgreSQL Flexible Server&lt;br/&gt;dify-postgres-9107e36a]\n        Redis[Redis Cache]\n        Storage[Azure Storage&lt;br/&gt;difyprivatest9107e36a]\n        ACR[Container Registry&lt;br/&gt;Shared]\n        LogAnalytics[Log Analytics&lt;br/&gt;Centralized]\n        AppInsights[Application Insights]\n        KeyVault[Key Vault&lt;br/&gt;dify-private-kv]\n\n        VNet_Hub[VNet Hub&lt;br/&gt;10.0.0.0/16]\n    end\n\n    subgraph Spoke_Prod[\"SPOKE-PROD Subscription&lt;br/&gt;353a6255-27a8-4733-adf0-1c531ba9f4e9\"]\n        AKS_Prod[AKS Cluster&lt;br/&gt;Control Center Workloads]\n        NextJS[Next.js UI]\n        FastAPI[FastAPI Gateway]\n\n        VNet_Prod[VNet Spoke-Prod&lt;br/&gt;10.1.0.0/16]\n    end\n\n    subgraph Spoke_Dev[\"SPOKE-DEV Subscription&lt;br/&gt;0987a8ce-7f7d-4a28-8db2-5c2c3115dfa4\"]\n        AKS_Dev[AKS Cluster&lt;br/&gt;Dev/Test Environments]\n        Experiments[AI Experiments]\n        FinOps_Test[FinOps Sandboxes]\n\n        VNet_Dev[VNet Spoke-Dev&lt;br/&gt;10.2.0.0/16]\n    end\n\n    VPN_Public --&gt; VPN_Private\n    VPN_Private --&gt; VNet_Hub\n    VNet_Hub &lt;--&gt;|VNet Peering| VNet_Prod\n    VNet_Hub &lt;--&gt;|VNet Peering| VNet_Dev\n\n    NextJS --&gt; Dify\n    FastAPI --&gt; Dify\n    NextJS --&gt; PostgreSQL\n    FastAPI --&gt; PostgreSQL\n    NextJS --&gt; Redis\n    FastAPI --&gt; Redis\n\n    AKS_Prod --&gt; ACR\n    AKS_Dev --&gt; ACR\n    AKS_Prod --&gt; LogAnalytics\n    AKS_Dev --&gt; LogAnalytics</code></pre>"},{"location":"architecture/01-hub-spoke-design/#vnets-y-direccionamiento-ip","title":"VNets y Direccionamiento IP","text":"VNet Subscripci\u00f3n CIDR Subnets Prop\u00f3sito vnet-hub Hub (739aaf91) <code>10.0.0.0/16</code> AKS: <code>10.0.2.0/24</code>VPN: <code>10.0.1.0/24</code>DB: <code>10.0.3.0/24</code> Servicios compartidos vnet-spoke-prod Spoke-Prod (353a6255) <code>10.1.0.0/16</code> AKS: <code>10.1.1.0/24</code>App: <code>10.1.2.0/24</code> Control Center producci\u00f3n vnet-spoke-dev Spoke-Dev (0987a8ce) <code>10.2.0.0/16</code> AKS: <code>10.2.1.0/24</code>Sandbox: <code>10.2.2.0/24</code> Dev/Test/Experiments"},{"location":"architecture/01-hub-spoke-design/#distribucion-de-recursos","title":"Distribuci\u00f3n de Recursos","text":""},{"location":"architecture/01-hub-spoke-design/#hub-subscription-739aaf91-5cb2-45a6-ab4f-abf883e9d3f7","title":"HUB (Subscription 739aaf91-5cb2-45a6-ab4f-abf883e9d3f7)","text":""},{"location":"architecture/01-hub-spoke-design/#recursos-existentes","title":"Recursos Existentes","text":"Recurso Nombre Estado Prop\u00f3sito AKS Cluster dify-aks Running 1.30.14 Plataforma Dify PostgreSQL dify-postgres-9107e36a Running Database Dify + Control Center Storage Account difyprivatest9107e36a Active Blob storage Dify Redis redis-6b56696c4b-d89lp Running (pod) Cache Dify + Control Center VPN Gateway openvpn-server Running Acceso seguro VPN Key Vault dify-private-kv Active Secrets management LoadBalancer kubernetes Active (10.0.2.62) Ingress Dify"},{"location":"architecture/01-hub-spoke-design/#recursos-a-agregar-terragrunt-hub","title":"Recursos a Agregar (Terragrunt Hub)","text":"Recurso Nombre Propuesto Justificaci\u00f3n Container Registry ccacr{random} Shared image registry para todos los spokes Log Analytics cc-logs-workspace Centralizar logs de Hub + Spokes Application Insights cc-app-insights Monitoreo APM unificado GitHub Actions Runner cc-gh-runner (AKS) Self-hosted CI/CD runner VNet Peering hub-to-spoke-prodhub-to-spoke-dev Conectividad entre subscripciones"},{"location":"architecture/01-hub-spoke-design/#spoke-prod-subscription-353a6255-27a8-4733-adf0-1c531ba9f4e9","title":"SPOKE-PROD (Subscription 353a6255-27a8-4733-adf0-1c531ba9f4e9)","text":""},{"location":"architecture/01-hub-spoke-design/#recursos-a-crear","title":"Recursos a Crear","text":"Recurso Nombre SKU/Tier Prop\u00f3sito AKS Cluster cc-aks-prod Standard_D4s_v3 (2-4 nodes) Control Center workloads Service Principal cc-prod-sp - Deployment automation Managed Identity cc-prod-identity - Workload authentication NSG cc-prod-nsg - Network security rules VNet Peering spoke-prod-to-hub - Conectividad a Hub <p>Workloads en AKS:</p> <ul> <li>Next.js Control Center UI (deployment + service)</li> <li>FastAPI API Gateway (deployment + service)</li> <li>Nginx Ingress Controller</li> <li>Cert-manager (para TLS interno)</li> </ul>"},{"location":"architecture/01-hub-spoke-design/#spoke-dev-subscription-0987a8ce-7f7d-4a28-8db2-5c2c3115dfa4","title":"SPOKE-DEV (Subscription 0987a8ce-7f7d-4a28-8db2-5c2c3115dfa4)","text":""},{"location":"architecture/01-hub-spoke-design/#recursos-a-crear_1","title":"Recursos a Crear","text":"Recurso Nombre SKU/Tier Prop\u00f3sito AKS Cluster cc-aks-dev Standard_B2s (1-2 nodes) Dev/Test cost-optimized Resource Groups rg-experiment-{name} - Sandboxes aislados Auto-shutdown Policy dev-shutdown - Apagar recursos no-prod NSG cc-dev-nsg - Network security rules VNet Peering spoke-dev-to-hub - Conectividad a Hub <p>Pol\u00edticas de Ahorro:</p> <ul> <li>Auto-shutdown de VMs fuera de horario laboral</li> <li>AKS autoscaling agresivo (min 1 node)</li> <li>Spot instances para workloads tolerantes a interrupciones</li> </ul>"},{"location":"architecture/01-hub-spoke-design/#subscripciones-azure","title":"Subscripciones Azure","text":""},{"location":"architecture/01-hub-spoke-design/#hub-739aaf91-5cb2-45a6-ab4f-abf883e9d3f7","title":"Hub: 739aaf91-5cb2-45a6-ab4f-abf883e9d3f7","text":"<ul> <li>Rol: Servicios compartidos + Networking central</li> <li>Recursos clave: Dify, VPN, PostgreSQL, Redis, ACR, Monitoring</li> <li>Acceso: VPN requerida para todos los recursos</li> <li>Costes: Recursos permanentes, optimizaci\u00f3n v\u00eda shared services</li> </ul>"},{"location":"architecture/01-hub-spoke-design/#spoke-prod-353a6255-27a8-4733-adf0-1c531ba9f4e9","title":"Spoke-Prod: 353a6255-27a8-4733-adf0-1c531ba9f4e9","text":"<ul> <li>Rol: Entorno de producci\u00f3n Control Center</li> <li>Recursos clave: AKS (Next.js + FastAPI), Ingress</li> <li>Acceso: Via Hub peering, VPN para management</li> <li>Costes: Production-grade, SLAs estrictos</li> </ul>"},{"location":"architecture/01-hub-spoke-design/#spoke-dev-0987a8ce-7f7d-4a28-8db2-5c2c3115dfa4","title":"Spoke-Dev: 0987a8ce-7f7d-4a28-8db2-5c2c3115dfa4","text":"<ul> <li>Rol: Desarrollo, testing, experimentaci\u00f3n</li> <li>Recursos clave: AKS dev, sandboxes temporales</li> <li>Acceso: Via Hub peering, VPN para desarrollo</li> <li>Costes: Cost-optimized, ephemeral resources</li> </ul>"},{"location":"architecture/01-hub-spoke-design/#beneficios-del-modelo","title":"Beneficios del Modelo","text":""},{"location":"architecture/01-hub-spoke-design/#1-optimizacion-de-costes","title":"1. Optimizaci\u00f3n de Costes","text":"<ul> <li>Shared Services: PostgreSQL, Redis, ACR, Monitoring compartidos \u2192 ~40% ahorro vs duplicaci\u00f3n</li> <li>VPN Centralizada: Un gateway vs 3 gateways \u2192 ~60% ahorro en conectividad</li> <li>Auto-scaling inteligente: Spokes escalan independientemente seg\u00fan demanda</li> <li>Dev/Test optimization: Spoke-Dev usa SKUs menores + auto-shutdown</li> </ul> <p>Estimaci\u00f3n mensual (EUR):</p> Componente Hub Spoke-Prod Spoke-Dev Total AKS 150\u20ac (existing) 300\u20ac 80\u20ac 530\u20ac PostgreSQL 120\u20ac (shared) - - 120\u20ac Redis 40\u20ac (shared) - - 40\u20ac VPN 90\u20ac - - 90\u20ac ACR 50\u20ac (shared) - - 50\u20ac Monitoring 60\u20ac (shared) - - 60\u20ac Storage 30\u20ac 20\u20ac 10\u20ac 60\u20ac TOTAL 540\u20ac 320\u20ac 90\u20ac 950\u20ac/mes <p>vs Arquitectura sin Hub &amp; Spoke: ~1,500\u20ac/mes (58% m\u00e1s caro)</p>"},{"location":"architecture/01-hub-spoke-design/#2-seguridad","title":"2. Seguridad","text":"<ul> <li>Single point of entry: VPN en Hub, no exposici\u00f3n p\u00fablica de Spokes</li> <li>Network segmentation: NSGs entre Hub y Spokes con allow-list expl\u00edcita</li> <li>Secrets centralizados: Key Vault en Hub con RBAC por spoke</li> <li>Audit trail unificado: Log Analytics centralizado con retention</li> </ul>"},{"location":"architecture/01-hub-spoke-design/#3-escalabilidad","title":"3. Escalabilidad","text":"<ul> <li>Add spokes sin cambios en Hub: Nuevas subscripciones solo requieren peering</li> <li>Independent scaling: Spoke-Prod puede crecer sin afectar Dev</li> <li>Multi-region ready: Hub replicable en otras regiones (future)</li> </ul>"},{"location":"architecture/01-hub-spoke-design/#4-gobernanza","title":"4. Gobernanza","text":"<ul> <li>Centralized policies: Azure Policy en Hub propagadas a Spokes</li> <li>Unified monitoring: Single pane of glass en Grafana (Hub)</li> <li>Cost tracking: Tags consistentes + FinOps automation per-spoke</li> </ul>"},{"location":"architecture/01-hub-spoke-design/#decisiones-arquitecturales","title":"Decisiones Arquitecturales","text":""},{"location":"architecture/01-hub-spoke-design/#adr-001-por-que-hub-spoke-vs-multi-region","title":"ADR-001: \u00bfPor qu\u00e9 Hub &amp; Spoke vs Multi-Region?","text":"<p>Decisi\u00f3n: Hub &amp; Spoke single-region (North Europe)</p> <p>Rationale:</p> <ul> <li>PoC/MVP no requiere multi-region HA</li> <li>Latencia North Europe aceptable para usuarios EU</li> <li>Costes de multi-region duplican infraestructura</li> <li>Simplicidad operacional en etapa inicial</li> </ul> <p>Consecuencias:</p> <ul> <li>\u2705 Menor complejidad</li> <li>\u2705 Costes reducidos</li> <li>\u26a0\ufe0f Single point of failure regional</li> <li>\ud83d\udd2e Future: Agregar regi\u00f3n secundaria en Phase 4+</li> </ul>"},{"location":"architecture/01-hub-spoke-design/#adr-002-por-que-reutilizar-dify-existente-vs-nuevo-despliegue","title":"ADR-002: \u00bfPor qu\u00e9 reutilizar Dify existente vs nuevo despliegue?","text":"<p>Decisi\u00f3n: Reutilizar Dify en Hub (10.0.2.62)</p> <p>Rationale:</p> <ul> <li>Dify ya operacional y configurado correctamente</li> <li>Ahorro de tiempo setup (PostgreSQL, Redis, Storage ya creados)</li> <li>Costes evitados de infraestructura duplicada</li> <li>Conocimiento existente del entorno</li> </ul> <p>Consecuencias:</p> <ul> <li>\u2705 Time to market acelerado</li> <li>\u2705 Zero setup de Dify infrastructure</li> <li>\u26a0\ufe0f Dependencia de stability de Dify existente</li> <li>\ud83d\udd2e Considerar HA Dify si se vuelve cr\u00edtico</li> </ul>"},{"location":"architecture/01-hub-spoke-design/#adr-003-por-que-postgresql-compartido-vs-per-spoke","title":"ADR-003: \u00bfPor qu\u00e9 PostgreSQL compartido vs per-spoke?","text":"<p>Decisi\u00f3n: PostgreSQL Flexible Server en Hub compartido</p> <p>Rationale:</p> <ul> <li>Control Center no es data-intensive (metadata, configs)</li> <li>Databases separadas por esquema (dify_db, control_center_db)</li> <li>Backup centralizado + retention policies</li> <li>~120\u20ac/mes ahorrados vs 3 instancias separadas</li> </ul> <p>Consecuencias:</p> <ul> <li>\u2705 Cost optimization significativa</li> <li>\u2705 Backup/restore simplificado</li> <li>\u26a0\ufe0f Shared resource contention (mitigado con QoS)</li> <li>\ud83d\udd2e Migrar a dedicado si load &gt; 80% sustained</li> </ul>"},{"location":"architecture/01-hub-spoke-design/#adr-004-por-que-terragrunt-vs-terraform-puro","title":"ADR-004: \u00bfPor qu\u00e9 Terragrunt vs Terraform puro?","text":"<p>Decisi\u00f3n: Terragrunt como wrapper de Terraform</p> <p>Rationale:</p> <ul> <li>Multi-subscription orchestration natural con Terragrunt</li> <li>DRY principle: configuraci\u00f3n compartida entre Hub y Spokes</li> <li>Remote state management autom\u00e1tico por ambiente</li> <li>Dependencies entre m\u00f3dulos (Spoke-Prod depende de Hub outputs)</li> <li>Mantiene Terraform HCL familiar</li> <li>Curva de aprendizaje &lt; 1 d\u00eda</li> <li>Un comando (<code>terragrunt run-all apply</code>) despliega todo en orden</li> </ul> <p>Consecuencias:</p> <ul> <li>\u2705 Eliminaci\u00f3n de c\u00f3digo duplicado (subscription IDs, regions, etc.)</li> <li>\u2705 State management simplificado</li> <li>\u2705 Dependencies expl\u00edcitas y autom\u00e1ticas</li> <li>\u2705 Rollback m\u00e1s seguro (orden reverso autom\u00e1tico)</li> <li>\u26a0\ufe0f Capa adicional de abstracci\u00f3n (debugging m\u00e1s complejo)</li> <li>\u26a0\ufe0f CI/CD debe instalar Terragrunt + Terraform</li> </ul> <p>Alternativa rechazada: Pulumi</p> <ul> <li>Pulumi Python ser\u00eda \u00fatil para l\u00f3gica program\u00e1tica compleja</li> <li>PERO: FinOps automation puede ser Python scripts + Terraform resources (separados)</li> <li>Mantener DOS paradigmas IaC (HCL + Python) es overhead innecesario en PoC</li> <li>Pulumi puede evaluarse en Phase 3+ si surge necesidad real</li> </ul>"},{"location":"architecture/01-hub-spoke-design/#adr-005-por-que-nextjs-app-router-vs-pages-router","title":"ADR-005: \u00bfPor qu\u00e9 Next.js App Router vs Pages Router?","text":"<p>Decisi\u00f3n: Next.js 14+ con App Router</p> <p>Rationale:</p> <ul> <li>React Server Components reduce bundle size</li> <li>Streaming y Suspense mejoran UX</li> <li>MDX integration nativa con App Router</li> <li>Futuro de Next.js ecosystem</li> </ul> <p>Consecuencias:</p> <ul> <li>\u2705 Performance mejorado (RSC)</li> <li>\u2705 SEO optimizado</li> <li>\u26a0\ufe0f Learning curve App Router</li> <li>\ud83d\udd2e Migraci\u00f3n futura menos costosa</li> </ul>"},{"location":"architecture/01-hub-spoke-design/#gestion-iac-con-terragrunt","title":"Gesti\u00f3n IaC con Terragrunt","text":""},{"location":"architecture/01-hub-spoke-design/#estructura-del-proyecto","title":"Estructura del Proyecto","text":"<pre><code>terraform/\n\u251c\u2500\u2500 terragrunt.hcl                 # Root config (remote state, provider)\n\u251c\u2500\u2500 _envcommon/                    # Configuraci\u00f3n compartida\n\u2502   \u251c\u2500\u2500 aks.hcl                    # Config com\u00fan AKS\n\u2502   \u251c\u2500\u2500 networking.hcl             # VNets, NSGs, peering\n\u2502   \u2514\u2500\u2500 monitoring.hcl             # Log Analytics, App Insights\n\u251c\u2500\u2500 modules/                       # Terraform modules reutilizables\n\u2502   \u251c\u2500\u2500 aks/\n\u2502   \u2502   \u251c\u2500\u2500 main.tf\n\u2502   \u2502   \u251c\u2500\u2500 variables.tf\n\u2502   \u2502   \u2514\u2500\u2500 outputs.tf\n\u2502   \u251c\u2500\u2500 vnet-peering/\n\u2502   \u2502   \u251c\u2500\u2500 main.tf\n\u2502   \u2502   \u251c\u2500\u2500 variables.tf\n\u2502   \u2502   \u2514\u2500\u2500 outputs.tf\n\u2502   \u251c\u2500\u2500 postgresql/\n\u2502   \u2502   \u251c\u2500\u2500 main.tf\n\u2502   \u2502   \u251c\u2500\u2500 variables.tf\n\u2502   \u2502   \u2514\u2500\u2500 outputs.tf\n\u2502   \u251c\u2500\u2500 container-registry/\n\u2502   \u2502   \u251c\u2500\u2500 main.tf\n\u2502   \u2502   \u251c\u2500\u2500 variables.tf\n\u2502   \u2502   \u2514\u2500\u2500 outputs.tf\n\u2502   \u2514\u2500\u2500 monitoring/\n\u2502       \u251c\u2500\u2500 main.tf\n\u2502       \u251c\u2500\u2500 variables.tf\n\u2502       \u2514\u2500\u2500 outputs.tf\n\u251c\u2500\u2500 hub/\n\u2502   \u251c\u2500\u2500 terragrunt.hcl             # Hub-specific config\n\u2502   \u251c\u2500\u2500 acr/\n\u2502   \u2502   \u2514\u2500\u2500 terragrunt.hcl\n\u2502   \u251c\u2500\u2500 monitoring/\n\u2502   \u2502   \u2514\u2500\u2500 terragrunt.hcl\n\u2502   \u2514\u2500\u2500 peering/\n\u2502       \u2514\u2500\u2500 terragrunt.hcl\n\u251c\u2500\u2500 spoke-prod/\n\u2502   \u251c\u2500\u2500 terragrunt.hcl             # Spoke-Prod-specific config\n\u2502   \u251c\u2500\u2500 aks/\n\u2502   \u2502   \u2514\u2500\u2500 terragrunt.hcl\n\u2502   \u251c\u2500\u2500 networking/\n\u2502   \u2502   \u2514\u2500\u2500 terragrunt.hcl\n\u2502   \u2514\u2500\u2500 peering/\n\u2502       \u2514\u2500\u2500 terragrunt.hcl\n\u2514\u2500\u2500 spoke-dev/\n    \u251c\u2500\u2500 terragrunt.hcl             # Spoke-Dev-specific config\n    \u251c\u2500\u2500 aks/\n    \u2502   \u2514\u2500\u2500 terragrunt.hcl\n    \u251c\u2500\u2500 networking/\n    \u2502   \u2514\u2500\u2500 terragrunt.hcl\n    \u2514\u2500\u2500 peering/\n        \u2514\u2500\u2500 terragrunt.hcl\n</code></pre>"},{"location":"architecture/01-hub-spoke-design/#root-terragrunt-configuration","title":"Root Terragrunt Configuration","text":"<pre><code># terraform/terragrunt.hcl\n\nlocals {\n  # Azure regions\n  primary_region = \"northeurope\"\n\n  # Common tags\n  common_tags = {\n    Project     = \"DXC_PoC_Nirvana\"\n    ManagedBy   = \"Terragrunt\"\n    Repository  = \"https://github.com/AlbertoLacambra/DXC_PoC_Nirvana\"\n  }\n}\n\n# Remote state configuration (Azure Storage Backend)\nremote_state {\n  backend = \"azurerm\"\n\n  generate = {\n    path      = \"backend.tf\"\n    if_exists = \"overwrite\"\n  }\n\n  config = {\n    resource_group_name  = \"tfstate-rg\"\n    storage_account_name = \"tfstatecc${get_env(\"SUBSCRIPTION_SHORT\", \"default\")}\"\n    container_name       = \"tfstate\"\n    key                  = \"${path_relative_to_include()}/terraform.tfstate\"\n\n    # Locking con Azure Blob lease\n    use_azuread_auth = true\n  }\n}\n\n# Provider configuration\ngenerate \"provider\" {\n  path      = \"provider.tf\"\n  if_exists = \"overwrite\"\n\n  contents = &lt;&lt;EOF\nterraform {\n  required_version = \"&gt;= 1.6\"\n\n  required_providers {\n    azurerm = {\n      source  = \"hashicorp/azurerm\"\n      version = \"~&gt; 3.80\"\n    }\n    azuread = {\n      source  = \"hashicorp/azuread\"\n      version = \"~&gt; 2.47\"\n    }\n    random = {\n      source  = \"hashicorp/random\"\n      version = \"~&gt; 3.6\"\n    }\n  }\n}\n\nprovider \"azurerm\" {\n  features {\n    key_vault {\n      purge_soft_delete_on_destroy = false\n    }\n    resource_group {\n      prevent_deletion_if_contains_resources = false\n    }\n  }\n\n  subscription_id = var.subscription_id\n}\n\nprovider \"azuread\" {}\nEOF\n}\n</code></pre>"},{"location":"architecture/01-hub-spoke-design/#hub-terragrunt-configuration","title":"Hub Terragrunt Configuration","text":"<pre><code># terraform/hub/terragrunt.hcl\n\ninclude \"root\" {\n  path = find_in_parent_folders()\n}\n\nlocals {\n  subscription_id = \"739aaf91-5cb2-45a6-ab4f-abf883e9d3f7\"\n  environment     = \"hub\"\n}\n\ninputs = {\n  subscription_id = local.subscription_id\n  environment     = local.environment\n  location        = \"northeurope\"\n\n  # Recursos existentes (data sources, no crear)\n  existing_resources = {\n    vnet_name              = \"dify-vnet\"\n    vnet_resource_group    = \"dify-rg\"\n    postgresql_server_name = \"dify-postgres-9107e36a\"\n    storage_account_name   = \"difyprivatest9107e36a\"\n    key_vault_name         = \"dify-private-kv\"\n  }\n\n  # Nuevos recursos a crear\n  create_acr          = true\n  create_log_analytics = true\n  create_app_insights  = true\n\n  # Tags espec\u00edficos Hub\n  tags = merge(\n    local.common_tags,\n    {\n      Environment = \"hub\"\n      CostCenter  = \"shared-services\"\n    }\n  )\n}\n</code></pre>"},{"location":"architecture/01-hub-spoke-design/#spoke-prod-terragrunt-configuration","title":"Spoke-Prod Terragrunt Configuration","text":"<pre><code># terraform/spoke-prod/terragrunt.hcl\n\ninclude \"root\" {\n  path = find_in_parent_folders()\n}\n\n# Dependency en Hub para obtener outputs (VNet ID, ACR, etc.)\ndependency \"hub\" {\n  config_path = \"../hub\"\n\n  mock_outputs = {\n    vnet_id         = \"/subscriptions/mock/resourceGroups/mock/providers/Microsoft.Network/virtualNetworks/mock\"\n    acr_login_server = \"mockacr.azurecr.io\"\n    postgresql_fqdn  = \"mock-postgres.postgres.database.azure.com\"\n    log_analytics_id = \"/subscriptions/mock/resourceGroups/mock/providers/Microsoft.OperationalInsights/workspaces/mock\"\n  }\n}\n\nlocals {\n  subscription_id = \"353a6255-27a8-4733-adf0-1c531ba9f4e9\"\n  environment     = \"prod\"\n}\n\ninputs = {\n  subscription_id = local.subscription_id\n  environment     = local.environment\n  location        = \"northeurope\"\n\n  # VNet configuration\n  vnet_cidr = \"10.1.0.0/16\"\n  subnets = {\n    aks  = \"10.1.1.0/24\"\n    apps = \"10.1.2.0/24\"\n  }\n\n  # Hub resources (from dependency)\n  hub_vnet_id         = dependency.hub.outputs.vnet_id\n  hub_acr_login_server = dependency.hub.outputs.acr_login_server\n  hub_postgresql_fqdn  = dependency.hub.outputs.postgresql_fqdn\n  hub_log_analytics_id = dependency.hub.outputs.log_analytics_id\n\n  # AKS configuration\n  aks = {\n    node_count       = 2\n    vm_size          = \"Standard_D4s_v3\"\n    min_count        = 2\n    max_count        = 4\n    enable_autoscale = true\n  }\n\n  # Tags espec\u00edficos Spoke-Prod\n  tags = merge(\n    local.common_tags,\n    {\n      Environment = \"production\"\n      CostCenter  = \"control-center-prod\"\n      Criticality = \"high\"\n    }\n  )\n}\n</code></pre>"},{"location":"architecture/01-hub-spoke-design/#spoke-dev-terragrunt-configuration","title":"Spoke-Dev Terragrunt Configuration","text":"<pre><code># terraform/spoke-dev/terragrunt.hcl\n\ninclude \"root\" {\n  path = find_in_parent_folders()\n}\n\ndependency \"hub\" {\n  config_path = \"../hub\"\n\n  mock_outputs = {\n    vnet_id         = \"/subscriptions/mock/resourceGroups/mock/providers/Microsoft.Network/virtualNetworks/mock\"\n    acr_login_server = \"mockacr.azurecr.io\"\n    log_analytics_id = \"/subscriptions/mock/resourceGroups/mock/providers/Microsoft.OperationalInsights/workspaces/mock\"\n  }\n}\n\nlocals {\n  subscription_id = \"0987a8ce-7f7d-4a28-8db2-5c2c3115dfa4\"\n  environment     = \"dev\"\n}\n\ninputs = {\n  subscription_id = local.subscription_id\n  environment     = local.environment\n  location        = \"northeurope\"\n\n  # VNet configuration\n  vnet_cidr = \"10.2.0.0/16\"\n  subnets = {\n    aks     = \"10.2.1.0/24\"\n    sandbox = \"10.2.2.0/24\"\n  }\n\n  # Hub resources\n  hub_vnet_id         = dependency.hub.outputs.vnet_id\n  hub_acr_login_server = dependency.hub.outputs.acr_login_server\n  hub_log_analytics_id = dependency.hub.outputs.log_analytics_id\n\n  # AKS configuration (cost-optimized)\n  aks = {\n    node_count       = 1\n    vm_size          = \"Standard_B2s\"\n    min_count        = 1\n    max_count        = 2\n    enable_autoscale = true\n  }\n\n  # Auto-shutdown policy\n  auto_shutdown = {\n    enabled   = true\n    time      = \"19:00\"\n    timezone  = \"W. Europe Standard Time\"\n    weekends  = true\n  }\n\n  # Tags espec\u00edficos Spoke-Dev\n  tags = merge(\n    local.common_tags,\n    {\n      Environment = \"development\"\n      CostCenter  = \"control-center-dev\"\n      Criticality = \"low\"\n      AutoShutdown = \"enabled\"\n    }\n  )\n}\n</code></pre>"},{"location":"architecture/01-hub-spoke-design/#ejemplo-de-modulo-reutilizable-aks","title":"Ejemplo de M\u00f3dulo Reutilizable: AKS","text":"<pre><code># terraform/modules/aks/main.tf\n\nresource \"azurerm_kubernetes_cluster\" \"this\" {\n  name                = var.cluster_name\n  location            = var.location\n  resource_group_name = var.resource_group_name\n  dns_prefix          = var.dns_prefix\n\n  kubernetes_version = var.kubernetes_version\n\n  default_node_pool {\n    name                = \"default\"\n    node_count          = var.node_count\n    vm_size             = var.vm_size\n    vnet_subnet_id      = var.subnet_id\n    enable_auto_scaling = var.enable_autoscale\n    min_count           = var.enable_autoscale ? var.min_count : null\n    max_count           = var.enable_autoscale ? var.max_count : null\n\n    upgrade_settings {\n      max_surge = \"10%\"\n    }\n  }\n\n  identity {\n    type = \"SystemAssigned\"\n  }\n\n  network_profile {\n    network_plugin    = \"azure\"\n    network_policy    = \"calico\"\n    load_balancer_sku = \"standard\"\n  }\n\n  oms_agent {\n    log_analytics_workspace_id = var.log_analytics_workspace_id\n  }\n\n  azure_policy_enabled = true\n\n  tags = var.tags\n}\n\n# Grant AKS pull access to ACR\nresource \"azurerm_role_assignment\" \"acr_pull\" {\n  count                = var.acr_id != null ? 1 : 0\n  scope                = var.acr_id\n  role_definition_name = \"AcrPull\"\n  principal_id         = azurerm_kubernetes_cluster.this.kubelet_identity[0].object_id\n}\n</code></pre> <pre><code># terraform/modules/aks/variables.tf\n\nvariable \"cluster_name\" {\n  type        = string\n  description = \"Name of the AKS cluster\"\n}\n\nvariable \"location\" {\n  type        = string\n  description = \"Azure region\"\n}\n\nvariable \"resource_group_name\" {\n  type        = string\n  description = \"Resource group name\"\n}\n\nvariable \"dns_prefix\" {\n  type        = string\n  description = \"DNS prefix for the cluster\"\n}\n\nvariable \"kubernetes_version\" {\n  type        = string\n  description = \"Kubernetes version\"\n  default     = \"1.30\"\n}\n\nvariable \"node_count\" {\n  type        = number\n  description = \"Initial node count\"\n  default     = 2\n}\n\nvariable \"vm_size\" {\n  type        = string\n  description = \"VM size for nodes\"\n  default     = \"Standard_D2s_v3\"\n}\n\nvariable \"subnet_id\" {\n  type        = string\n  description = \"Subnet ID for AKS\"\n}\n\nvariable \"enable_autoscale\" {\n  type        = bool\n  description = \"Enable autoscaling\"\n  default     = true\n}\n\nvariable \"min_count\" {\n  type        = number\n  description = \"Minimum node count for autoscaling\"\n  default     = 1\n}\n\nvariable \"max_count\" {\n  type        = number\n  description = \"Maximum node count for autoscaling\"\n  default     = 3\n}\n\nvariable \"log_analytics_workspace_id\" {\n  type        = string\n  description = \"Log Analytics Workspace ID for monitoring\"\n}\n\nvariable \"acr_id\" {\n  type        = string\n  description = \"Azure Container Registry ID for pull access\"\n  default     = null\n}\n\nvariable \"tags\" {\n  type        = map(string)\n  description = \"Tags to apply to resources\"\n  default     = {}\n}\n</code></pre> <pre><code># terraform/modules/aks/outputs.tf\n\noutput \"id\" {\n  value       = azurerm_kubernetes_cluster.this.id\n  description = \"AKS cluster ID\"\n}\n\noutput \"name\" {\n  value       = azurerm_kubernetes_cluster.this.name\n  description = \"AKS cluster name\"\n}\n\noutput \"kube_config\" {\n  value       = azurerm_kubernetes_cluster.this.kube_config_raw\n  sensitive   = true\n  description = \"Kubernetes config\"\n}\n\noutput \"identity_principal_id\" {\n  value       = azurerm_kubernetes_cluster.this.identity[0].principal_id\n  description = \"System assigned identity principal ID\"\n}\n\noutput \"kubelet_identity_object_id\" {\n  value       = azurerm_kubernetes_cluster.this.kubelet_identity[0].object_id\n  description = \"Kubelet identity object ID\"\n}\n</code></pre>"},{"location":"architecture/01-hub-spoke-design/#comandos-terragrunt","title":"Comandos Terragrunt","text":"<pre><code># Desplegar todo (Hub + Spokes) en orden correcto\ncd terraform/\nterragrunt run-all plan\nterragrunt run-all apply\n\n# Desplegar solo Hub\ncd terraform/hub/\nterragrunt plan\nterragrunt apply\n\n# Desplegar solo Spoke-Prod (autom\u00e1ticamente lee outputs de Hub)\ncd terraform/spoke-prod/\nterragrunt plan\nterragrunt apply\n\n# Destruir todo en orden reverso\ncd terraform/\nterragrunt run-all destroy\n\n# Ver dependency graph\nterragrunt graph-dependencies | dot -Tpng &gt; dependencies.png\n\n# Validate configuraci\u00f3n\nterragrunt run-all validate\n\n# Format c\u00f3digo\nterragrunt run-all fmt\n</code></pre>"},{"location":"architecture/01-hub-spoke-design/#seguridad-y-compliance","title":"Seguridad y Compliance","text":""},{"location":"architecture/01-hub-spoke-design/#modelo-de-acceso","title":"Modelo de Acceso","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502   Usuario   \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n       \u2502 VPN Connection (OpenVPN)\n       \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  VPN Gateway (Hub)                  \u2502\n\u2502  52.178.149.106 \u2192 10.0.1.10         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n       \u2502\n       \u251c\u2500\u2500\u25ba Dify (10.0.2.62) \u2713\n       \u2502\n       \u251c\u2500\u2500\u25ba Hub Resources (PostgreSQL, Redis) \u2713\n       \u2502\n       \u251c\u2500\u2500\u25ba Spoke-Prod (via peering) \u2713\n       \u2502\n       \u2514\u2500\u2500\u25ba Spoke-Dev (via peering) \u2713\n\nInternet \u2192 Spokes = \u274c DENIED (no public IPs)\n</code></pre>"},{"location":"architecture/01-hub-spoke-design/#network-security-groups-nsgs","title":"Network Security Groups (NSGs)","text":""},{"location":"architecture/01-hub-spoke-design/#hub-nsg-rules","title":"Hub NSG Rules","text":"Priority Direction Source Destination Port Action Justification 100 Inbound VPN Subnet Hub VNet * Allow VPN access 200 Inbound Spoke-Prod VNet PostgreSQL 5432 Allow DB access 210 Inbound Spoke-Prod VNet Redis 6379 Allow Cache access 220 Inbound Spoke-Dev VNet PostgreSQL 5432 Allow Dev DB access 1000 Inbound Internet * * Deny Default deny"},{"location":"architecture/01-hub-spoke-design/#spoke-prod-nsg-rules","title":"Spoke-Prod NSG Rules","text":"Priority Direction Source Destination Port Action Justification 100 Inbound Hub VNet AKS 443 Allow Management 200 Outbound AKS Hub PostgreSQL 5432 Allow DB queries 210 Outbound AKS Hub Redis 6379 Allow Caching 220 Outbound AKS Hub Dify 80,443 Allow AI orchestration 1000 Inbound Internet * * Deny No public access"},{"location":"architecture/01-hub-spoke-design/#rbac-y-identidades","title":"RBAC y Identidades","text":"Subscripci\u00f3n Identidad Role Scope Prop\u00f3sito Hub <code>cc-admin-group</code> Owner Subscription Administraci\u00f3n completa Hub <code>cc-deploy-sp</code> Contributor RG CI/CD deployments Spoke-Prod <code>cc-prod-identity</code> Reader Hub PostgreSQL Read-only DB access Spoke-Prod <code>cc-prod-sp</code> Contributor Spoke-Prod RG Prod deployments Spoke-Dev <code>cc-dev-identity</code> Contributor Spoke-Dev RG Dev experimentation"},{"location":"architecture/01-hub-spoke-design/#secrets-management","title":"Secrets Management","text":"<pre><code>Azure Key Vault (Hub): dify-private-kv\n\u251c\u2500\u2500 dify-db-password\n\u251c\u2500\u2500 azure-storage-key\n\u251c\u2500\u2500 openai-api-key\n\u251c\u2500\u2500 cc-prod-db-connection-string\n\u251c\u2500\u2500 cc-api-jwt-secret\n\u2514\u2500\u2500 github-actions-token\n\nKubernetes Secrets (per cluster):\n\u251c\u2500\u2500 Hub AKS: azure-storage-credentials, dify-secrets\n\u251c\u2500\u2500 Spoke-Prod AKS: cc-api-secrets (from Key Vault via CSI driver)\n\u2514\u2500\u2500 Spoke-Dev AKS: cc-dev-secrets (from Key Vault via CSI driver)\n</code></pre> <p>Best Practices:</p> <ul> <li>Secrets rotaci\u00f3n autom\u00e1tica cada 90 d\u00edas (Azure Key Vault rotation policy)</li> <li>Kubernetes CSI driver para inyectar secrets desde Key Vault</li> <li>No secrets hardcoded en c\u00f3digo o IaC (valores v\u00eda variables/outputs)</li> <li>Audit logging de accesos a Key Vault (Log Analytics)</li> </ul>"},{"location":"architecture/01-hub-spoke-design/#gestion-de-costes","title":"Gesti\u00f3n de Costes","text":""},{"location":"architecture/01-hub-spoke-design/#finops-automation-phase-3","title":"FinOps Automation (Phase 3)","text":"<p>El Control Center implementar\u00e1 an\u00e1lisis autom\u00e1tico de costes mediante Python scripts + Terraform resources (NO Pulumi):</p> <ol> <li>Daily Cost Analysis</li> <li>Script Python en <code>scripts/finops/daily_cost_check.py</code></li> <li>Azure Cost Management API queries</li> <li>Detecci\u00f3n de anomal\u00edas (&gt;20% vs baseline)</li> <li> <p>Slack/Teams notifications</p> </li> <li> <p>Underutilization Detection</p> </li> <li>AKS node utilization &lt; 40% sustained 7 days \u2192 recommendation resize</li> <li>Storage accounts sin accesos 30 d\u00edas \u2192 move to cool tier</li> <li> <p>PostgreSQL connections &lt; 10% capacity \u2192 downgrade SKU</p> </li> <li> <p>Automated Recommendations</p> </li> <li>Python script analiza patrones de uso</li> <li>Genera PRs con Terragrunt changes (resize, delete, archive)</li> <li>Dify agent valida impacto antes de PR</li> <li> <p>Requiere approval humano antes de merge</p> </li> <li> <p>Cost Attribution</p> </li> <li>Tags por proyecto/equipo/ambiente (gestionados v\u00eda Terragrunt)</li> <li>Dashboards Grafana con breakdown per tag</li> <li>Chargebacks automatizados mensuales</li> </ol> <p>Ejemplo workflow FinOps:</p> <pre><code># scripts/finops/underutilization_detector.py\n\nfrom azure.mgmt.monitor import MonitorManagementClient\nfrom azure.mgmt.costmanagement import CostManagementClient\nimport requests  # Para Dify API\n\ndef analyze_aks_nodes(subscription_id, resource_group, cluster_name):\n    \"\"\"Analiza utilizaci\u00f3n de nodos AKS\"\"\"\n    # Query Azure Monitor por CPU/Memory \u00faltimos 7 d\u00edas\n    metrics = monitor_client.metrics.list(...)\n\n    avg_cpu = calculate_average(metrics, 'cpu')\n    avg_memory = calculate_average(metrics, 'memory')\n\n    if avg_cpu &lt; 40 and avg_memory &lt; 40:\n        return {\n            'action': 'downsize',\n            'current_node_count': 4,\n            'recommended_node_count': 2,\n            'savings_eur_month': 150\n        }\n\ndef generate_terragrunt_pr(recommendation):\n    \"\"\"Genera PR con cambio en Terragrunt config\"\"\"\n    # Modifica terraform/spoke-prod/aks/terragrunt.hcl\n    # node_count = 4 \u2192 node_count = 2\n\n    # Consulta Dify para validar impacto\n    dify_response = requests.post('http://10.0.2.62/api/workflows/run', json={\n        'workflow_id': 'finops-impact-analysis',\n        'inputs': recommendation\n    })\n\n    if dify_response.json()['risk_level'] == 'low':\n        # Crear PR autom\u00e1tico en GitHub\n        create_github_pr(\n            title=f\"FinOps: Reduce AKS nodes {recommendation['current_node_count']} \u2192 {recommendation['recommended_node_count']}\",\n            body=f\"Savings: {recommendation['savings_eur_month']}\u20ac/month\\nDify Risk: Low\",\n            files={'terraform/spoke-prod/aks/terragrunt.hcl': modified_content}\n        )\n</code></pre>"},{"location":"architecture/01-hub-spoke-design/#presupuesto-y-alertas","title":"Presupuesto y Alertas","text":"Subscripci\u00f3n Presupuesto Mensual Alert Threshold Action Hub 600\u20ac 80% (480\u20ac) Email + Slack Spoke-Prod 400\u20ac 80% (320\u20ac) Email + Slack Spoke-Dev 150\u20ac 90% (135\u20ac) Email + auto-shutdown <p>Auto-remediation Spoke-Dev:</p> <ul> <li>Budget &gt; 90% \u2192 Script detiene AKS dev cluster fuera de horario laboral</li> <li>Budget &gt; 100% \u2192 Requiere approval manual para restart</li> </ul>"},{"location":"architecture/01-hub-spoke-design/#referencias","title":"Referencias","text":"<ul> <li>Azure Hub-Spoke Topology</li> <li>VNet Peering Best Practices</li> <li>Terragrunt Documentation</li> <li>Azure Cost Management API</li> <li>Terraform Azure Provider</li> </ul> <p>\u00daltima actualizaci\u00f3n: 12 Octubre 2025 Versi\u00f3n: 1.0 Autor: Alberto Lacambra</p>"},{"location":"architecture/02-technology-stack/","title":"Stack Tecnol\u00f3gico - Cloud Control Center","text":""},{"location":"architecture/02-technology-stack/#tabla-de-contenidos","title":"Tabla de Contenidos","text":"<ul> <li>Visi\u00f3n General</li> <li>Infrastructure as Code (IaC)</li> <li>Frontend</li> <li>Backend</li> <li>AI y LLM</li> <li>Datos y Almacenamiento</li> <li>Observabilidad</li> <li>CI/CD</li> <li>Networking y Seguridad</li> <li>Justificaci\u00f3n de Elecciones</li> </ul>"},{"location":"architecture/02-technology-stack/#vision-general","title":"Visi\u00f3n General","text":"<p>El Cloud Control Center utiliza un stack moderno, cloud-native y AI-first dise\u00f1ado para:</p> <ul> <li>Escalabilidad: Arquitectura distribuida multi-subscription</li> <li>Mantenibilidad: IaC declarativo con Terragrunt, c\u00f3digo limpio y testeado</li> <li>Performance: React Server Components, caching, async operations</li> <li>Seguridad: Zero-trust, secrets management, audit logging</li> <li>Cost efficiency: Recursos compartidos, auto-scaling, FinOps automation</li> </ul>"},{"location":"architecture/02-technology-stack/#infrastructure-as-code-iac","title":"Infrastructure as Code (IaC)","text":""},{"location":"architecture/02-technology-stack/#terragrunt-terraform","title":"Terragrunt + Terraform","text":"<p>Versiones:</p> <ul> <li>Terragrunt: <code>&gt;= 0.55.0</code></li> <li>Terraform: <code>&gt;= 1.6.0</code></li> <li>Azure Provider: <code>~&gt; 3.80</code></li> </ul> <p>\u00bfPor qu\u00e9 Terragrunt?</p> <p>\u2705 Multi-subscription DRY: Configuraci\u00f3n compartida entre Hub y Spokes \u2705 Dependencies autom\u00e1ticas: Spoke-Prod espera outputs de Hub \u2705 State management simplificado: Backend auto-configurado por ambiente \u2705 Un comando deploy: <code>terragrunt run-all apply</code> despliega todo en orden \u2705 Mantiene ecosystem Terraform: Todos los m\u00f3dulos community funcionan \u2705 Curva de aprendizaje m\u00ednima: Wrapper sobre Terraform HCL familiar</p> <p>Estructura:</p> <pre><code>terraform/\n\u251c\u2500\u2500 terragrunt.hcl              # Root config (remote state, provider)\n\u251c\u2500\u2500 _envcommon/                 # Configuraci\u00f3n compartida\n\u251c\u2500\u2500 modules/                    # Terraform modules reutilizables\n\u2502   \u251c\u2500\u2500 aks/\n\u2502   \u251c\u2500\u2500 vnet-peering/\n\u2502   \u251c\u2500\u2500 postgresql/\n\u2502   \u2514\u2500\u2500 monitoring/\n\u251c\u2500\u2500 hub/                        # Hub subscription config\n\u251c\u2500\u2500 spoke-prod/                 # Spoke-Prod config + dependencies\n\u2514\u2500\u2500 spoke-dev/                  # Spoke-Dev config + dependencies\n</code></pre> <p>Comandos clave:</p> <pre><code># Deploy completo\nterragrunt run-all apply\n\n# Deploy solo Hub\ncd hub/ &amp;&amp; terragrunt apply\n\n# Dependency graph\nterragrunt graph-dependencies\n</code></pre> <p>Alternativas consideradas:</p> <ul> <li>\u274c Terraform puro: C\u00f3digo duplicado entre subscriptions, state management manual</li> <li>\u274c Pulumi Python: Overhead mantener DOS paradigmas IaC (HCL + Python), FinOps puede ser Python scripts separados</li> <li>\u274c Bicep: Lock-in Azure, menos portable que Terraform, comunidad menor</li> </ul>"},{"location":"architecture/02-technology-stack/#frontend","title":"Frontend","text":""},{"location":"architecture/02-technology-stack/#nextjs-14-con-app-router","title":"Next.js 14+ con App Router","text":"<p>Versi\u00f3n: <code>^14.2.0</code></p> <p>Features clave:</p> <ul> <li>React Server Components: Reduce bundle size, mejora performance</li> <li>App Router: Layouts anidados, streaming, Suspense</li> <li>MDX Native: Documentaci\u00f3n como c\u00f3digo con componentes React</li> <li>Server Actions: Mutations sin API endpoints expl\u00edcitos</li> <li>Edge Runtime: Deploy en Edge locations para latencia m\u00ednima</li> </ul> <p>Librer\u00edas principales:</p> <pre><code>{\n  \"dependencies\": {\n    \"next\": \"^14.2.0\",\n    \"react\": \"^18.3.0\",\n    \"@next/mdx\": \"^14.2.0\",\n    \"@mdx-js/loader\": \"^3.0.0\",\n    \"@mdx-js/react\": \"^3.0.0\",\n    \"tailwindcss\": \"^3.4.0\",\n    \"lucide-react\": \"^0.344.0\",\n    \"@radix-ui/react-*\": \"latest\",\n    \"next-themes\": \"^0.3.0\",\n    \"recharts\": \"^2.12.0\",\n    \"react-markdown\": \"^9.0.0\",\n    \"date-fns\": \"^3.3.0\"\n  }\n}\n</code></pre> <p>UI Components:</p> <ul> <li>Radix UI: Primitivos accesibles (Dialog, Dropdown, Tabs, etc.)</li> <li>Lucide Icons: Iconos SVG modernos y ligeros</li> <li>Tailwind CSS: Utility-first CSS framework</li> <li>Dark mode: next-themes con soporte sistema</li> </ul> <p>Estructura:</p> <pre><code>apps/control-center-ui/\n\u251c\u2500\u2500 app/\n\u2502   \u251c\u2500\u2500 (dashboard)/           # Layout dashboard\n\u2502   \u2502   \u251c\u2500\u2500 page.tsx           # Dashboard home\n\u2502   \u2502   \u251c\u2500\u2500 infrastructure/\n\u2502   \u2502   \u251c\u2500\u2500 finops/\n\u2502   \u2502   \u2514\u2500\u2500 docs/\n\u2502   \u251c\u2500\u2500 api/                   # API routes (proxies a FastAPI)\n\u2502   \u2514\u2500\u2500 layout.tsx             # Root layout\n\u251c\u2500\u2500 components/\n\u2502   \u251c\u2500\u2500 ui/                    # Radix UI wrappers\n\u2502   \u251c\u2500\u2500 dashboard/             # Dashboard components\n\u2502   \u2514\u2500\u2500 docs/                  # MDX components\n\u251c\u2500\u2500 lib/\n\u2502   \u251c\u2500\u2500 dify-client.ts         # Dify API client\n\u2502   \u251c\u2500\u2500 api-client.ts          # FastAPI client\n\u2502   \u2514\u2500\u2500 utils.ts\n\u2514\u2500\u2500 content/                   # MDX documentation\n    \u251c\u2500\u2500 architecture/\n    \u251c\u2500\u2500 runbooks/\n    \u2514\u2500\u2500 use-cases/\n</code></pre> <p>\u00bfPor qu\u00e9 Next.js App Router vs Pages Router?</p> <p>\u2705 Future-proof: Direcci\u00f3n oficial de Next.js \u2705 Performance: RSC reduce JavaScript enviado al cliente \u2705 DX mejorado: Layouts, loading, error states simplificados \u2705 MDX integration: Primera clase con App Router \u26a0\ufe0f Learning curve: App Router diferente a Pages, requiere adaptaci\u00f3n</p>"},{"location":"architecture/02-technology-stack/#backend","title":"Backend","text":""},{"location":"architecture/02-technology-stack/#fastapi-python","title":"FastAPI (Python)","text":"<p>Versi\u00f3n: <code>^0.110.0</code></p> <p>Features clave:</p> <ul> <li>Async/await: Performance con operaciones I/O bound</li> <li>Type hints: Validaci\u00f3n autom\u00e1tica con Pydantic</li> <li>OpenAPI auto-gen: Swagger UI out-of-the-box</li> <li>Dependency Injection: DI system elegante</li> <li>WebSockets: Real-time updates para dashboards</li> </ul> <p>Librer\u00edas principales:</p> <pre><code># requirements.txt\n\nfastapi==0.110.0\nuvicorn[standard]==0.29.0\npydantic==2.6.0\npydantic-settings==2.2.0\n\n# Azure SDKs\nazure-identity==1.15.0\nazure-mgmt-resource==23.0.0\nazure-mgmt-costmanagement==4.0.0\nazure-mgmt-monitor==6.0.0\nazure-storage-blob==12.19.0\n\n# Database\nasyncpg==0.29.0        # PostgreSQL async driver\nredis==5.0.0           # Redis client\n\n# HTTP clients\nhttpx==0.27.0          # Async HTTP (para Dify API)\naiohttp==3.9.0\n\n# Utilities\npython-jose[cryptography]==3.3.0  # JWT\npasslib[bcrypt]==1.7.4            # Password hashing\npython-multipart==0.0.9           # File uploads\n</code></pre> <p>Estructura:</p> <pre><code>apps/api-gateway/\n\u251c\u2500\u2500 app/\n\u2502   \u251c\u2500\u2500 api/\n\u2502   \u2502   \u2514\u2500\u2500 v1/\n\u2502   \u2502       \u251c\u2500\u2500 endpoints/\n\u2502   \u2502       \u2502   \u251c\u2500\u2500 infrastructure.py\n\u2502   \u2502       \u2502   \u251c\u2500\u2500 finops.py\n\u2502   \u2502       \u2502   \u251c\u2500\u2500 dify.py\n\u2502   \u2502       \u2502   \u2514\u2500\u2500 auth.py\n\u2502   \u2502       \u2514\u2500\u2500 router.py\n\u2502   \u251c\u2500\u2500 core/\n\u2502   \u2502   \u251c\u2500\u2500 config.py          # Settings from env\n\u2502   \u2502   \u251c\u2500\u2500 security.py        # JWT, auth\n\u2502   \u2502   \u2514\u2500\u2500 logging.py         # Structured logging\n\u2502   \u251c\u2500\u2500 integrations/\n\u2502   \u2502   \u251c\u2500\u2500 dify.py            # Dify API client\n\u2502   \u2502   \u251c\u2500\u2500 azure_cost.py      # Cost Management API\n\u2502   \u2502   \u2514\u2500\u2500 azure_monitor.py   # Azure Monitor API\n\u2502   \u251c\u2500\u2500 models/\n\u2502   \u2502   \u251c\u2500\u2500 schemas.py         # Pydantic models\n\u2502   \u2502   \u2514\u2500\u2500 database.py        # SQLAlchemy models\n\u2502   \u251c\u2500\u2500 services/\n\u2502   \u2502   \u251c\u2500\u2500 infrastructure_service.py\n\u2502   \u2502   \u2514\u2500\u2500 finops_service.py\n\u2502   \u2514\u2500\u2500 main.py\n\u251c\u2500\u2500 tests/\n\u2502   \u251c\u2500\u2500 unit/\n\u2502   \u2514\u2500\u2500 integration/\n\u251c\u2500\u2500 Dockerfile\n\u2514\u2500\u2500 requirements.txt\n</code></pre> <p>Ejemplo endpoint:</p> <pre><code># app/api/v1/endpoints/finops.py\n\nfrom fastapi import APIRouter, Depends, HTTPException\nfrom app.integrations.azure_cost import AzureCostClient\nfrom app.integrations.dify import DifyClient\nfrom app.models.schemas import UnderutilizationReport\n\nrouter = APIRouter()\n\n@router.get(\"/underutilization\", response_model=UnderutilizationReport)\nasync def analyze_underutilization(\n    subscription_id: str,\n    cost_client: AzureCostClient = Depends(),\n    dify_client: DifyClient = Depends()\n):\n    \"\"\"Analiza recursos infrautilizados con AI recommendations.\"\"\"\n\n    # Query Azure Cost Management API\n    usage_data = await cost_client.get_resource_usage(subscription_id)\n\n    # Analizar con Dify AI\n    dify_response = await dify_client.run_workflow(\n        workflow_id=\"finops-underutilization-analysis\",\n        inputs={\n            \"usage_data\": usage_data,\n            \"threshold_cpu\": 40,\n            \"threshold_memory\": 40,\n            \"lookback_days\": 7\n        }\n    )\n\n    return UnderutilizationReport(\n        resources=dify_response[\"underutilized_resources\"],\n        savings_eur_month=dify_response[\"potential_savings\"],\n        recommendations=dify_response[\"recommendations\"]\n    )\n</code></pre> <p>\u00bfPor qu\u00e9 FastAPI vs alternativas?</p> <p>\u2705 Performance: Uno de los frameworks Python m\u00e1s r\u00e1pidos \u2705 Modern Python: Async/await, type hints, Pydantic validation \u2705 OpenAPI auto: Documentaci\u00f3n interactiva sin esfuerzo \u2705 Azure SDK compatible: Todas las librer\u00edas Azure funcionan \u274c vs Django REST: Django m\u00e1s pesado, menos async-first \u274c vs Flask: Flask no async nativo, menos features out-of-the-box</p>"},{"location":"architecture/02-technology-stack/#ai-y-llm","title":"AI y LLM","text":""},{"location":"architecture/02-technology-stack/#dify-orchestrator","title":"Dify (Orchestrator)","text":"<p>Versi\u00f3n: <code>0.6.13</code> (existente en Hub) URL: <code>http://10.0.2.62/</code> (VPN required)</p> <p>Uso en Control Center:</p> <ol> <li>Documentation RAG Bot</li> <li>Knowledge Base con MDX content</li> <li>Q&amp;A conversacional sobre arquitectura, runbooks</li> <li> <p>Integrado en Next.js UI v\u00eda API</p> </li> <li> <p>FinOps Recommendations</p> </li> <li>Workflow analiza underutilization data</li> <li>Genera PRs autom\u00e1ticos con Terragrunt changes</li> <li> <p>Risk analysis antes de aplicar cambios</p> </li> <li> <p>IaC Drift Analysis</p> </li> <li>Compara Terraform state vs realidad Azure</li> <li>AI decide severity y auto-remediation strategy</li> <li> <p>Notificaciones Slack con contexto enriquecido</p> </li> <li> <p>Engineering Homologation</p> </li> <li>Code review AI-driven</li> <li>Compliance checking contra normativas internas</li> <li>Automated testing suggestions</li> </ol> <p>Dify Workflows creados:</p> <pre><code>Dify Workflows (http://10.0.2.62/workflows):\n\u251c\u2500\u2500 documentation-rag          # RAG sobre docs MDX\n\u251c\u2500\u2500 finops-underutilization    # An\u00e1lisis costes + recommendations\n\u251c\u2500\u2500 iac-drift-detection        # Terraform drift + remediation\n\u2514\u2500\u2500 code-review-compliance     # Engineering homologation\n</code></pre> <p>Integraci\u00f3n FastAPI:</p> <pre><code># app/integrations/dify.py\n\nimport httpx\nfrom app.core.config import settings\n\nclass DifyClient:\n    def __init__(self):\n        self.base_url = \"http://10.0.2.62/api\"\n        self.api_key = settings.DIFY_API_KEY\n\n    async def run_workflow(self, workflow_id: str, inputs: dict):\n        async with httpx.AsyncClient() as client:\n            response = await client.post(\n                f\"{self.base_url}/workflows/run\",\n                json={\"workflow_id\": workflow_id, \"inputs\": inputs},\n                headers={\"Authorization\": f\"Bearer {self.api_key}\"}\n            )\n            return response.json()\n</code></pre>"},{"location":"architecture/02-technology-stack/#azure-openai-via-dify","title":"Azure OpenAI (v\u00eda Dify)","text":"<ul> <li>Modelos: GPT-4, GPT-4 Turbo, GPT-3.5 Turbo</li> <li>Embeddings: text-embedding-3-large (para RAG)</li> <li>Configurado en Dify: Endpoint + API Key en Key Vault</li> </ul>"},{"location":"architecture/02-technology-stack/#datos-y-almacenamiento","title":"Datos y Almacenamiento","text":""},{"location":"architecture/02-technology-stack/#postgresql-flexible-server","title":"PostgreSQL Flexible Server","text":"<p>Versi\u00f3n: <code>14</code> SKU: Burstable B2s (Hub shared) Servidor: <code>dify-postgres-9107e36a.postgres.database.azure.com</code></p> <p>Databases:</p> <pre><code>-- Existing\ndify_db                 -- Dify platform data\n\n-- A crear (Control Center)\ncontrol_center_db       -- Metadata, configs, audit logs\n  \u251c\u2500\u2500 infrastructure_state    -- Cache Terraform state summaries\n  \u251c\u2500\u2500 finops_reports          -- Historical cost analysis\n  \u251c\u2500\u2500 audit_logs              -- User actions, deployments\n  \u2514\u2500\u2500 dify_workflow_runs      -- Workflow execution history\n</code></pre> <p>Connection pooling:</p> <ul> <li>FastAPI usa <code>asyncpg</code> con pool size 10-20</li> <li>Connection string en Key Vault: <code>cc-prod-db-connection-string</code></li> </ul>"},{"location":"architecture/02-technology-stack/#redis-cache","title":"Redis (Cache)","text":"<p>Versi\u00f3n: <code>7.x</code> Deployment: Pod en AKS Hub Pod: <code>redis-6b56696c4b-d89lp</code></p> <p>Uso:</p> <ul> <li>Session storage (JWT tokens)</li> <li>API response caching (Azure Cost API queries)</li> <li>Rate limiting</li> <li>WebSocket pub/sub (real-time dashboard updates)</li> </ul> <pre><code># FastAPI cache example\nfrom redis.asyncio import Redis\nimport json\n\nredis_client = Redis(host=\"redis-service.dify.svc.cluster.local\", port=6379)\n\n@router.get(\"/infrastructure/summary\")\nasync def get_infrastructure_summary(subscription_id: str):\n    # Check cache\n    cache_key = f\"infra_summary:{subscription_id}\"\n    cached = await redis_client.get(cache_key)\n\n    if cached:\n        return json.loads(cached)\n\n    # Query Azure, compute summary\n    summary = await compute_infrastructure_summary(subscription_id)\n\n    # Cache for 5 minutes\n    await redis_client.setex(cache_key, 300, json.dumps(summary))\n\n    return summary\n</code></pre>"},{"location":"architecture/02-technology-stack/#azure-blob-storage","title":"Azure Blob Storage","text":"<p>Storage Account: <code>difyprivatest9107e36a</code> Container: <code>control-center</code> (a crear)</p> <p>Uso:</p> <ul> <li>Terraform state files (via Terragrunt backend)</li> <li>FinOps reports exports (CSV, JSON)</li> <li>Backup de configuraciones</li> <li>Logs archivados (&gt;30 d\u00edas)</li> </ul>"},{"location":"architecture/02-technology-stack/#observabilidad","title":"Observabilidad","text":""},{"location":"architecture/02-technology-stack/#grafana-prometheus","title":"Grafana + Prometheus","text":"<p>Deployment: Kubernetes en Hub AKS Access: Via VPN, port-forward o Ingress interno</p> <p>Dashboards:</p> <ol> <li>Infrastructure Overview</li> <li>AKS cluster health (Hub + Spokes)</li> <li>PostgreSQL performance</li> <li>Redis hit rate</li> <li> <p>VNet traffic</p> </li> <li> <p>Application Performance</p> </li> <li>Next.js response times</li> <li>FastAPI endpoint latencies</li> <li>Dify workflow execution times</li> <li> <p>Error rates</p> </li> <li> <p>Cost Monitoring</p> </li> <li>Daily spend per subscription</li> <li>Resource utilization trends</li> <li>Anomaly detection alerts</li> <li>Budget vs actual</li> </ol> <p>Prometheus exporters:</p> <ul> <li><code>kube-state-metrics</code>: Kubernetes objects</li> <li><code>node-exporter</code>: Node-level metrics</li> <li><code>postgres-exporter</code>: PostgreSQL metrics</li> <li><code>redis-exporter</code>: Redis metrics</li> </ul>"},{"location":"architecture/02-technology-stack/#azure-monitor-application-insights","title":"Azure Monitor + Application Insights","text":"<p>Log Analytics Workspace: <code>cc-logs-workspace</code> (Hub) Application Insights: <code>cc-app-insights</code> (Hub)</p> <p>Logs centralizados:</p> <ul> <li>AKS container logs (Hub + Spokes)</li> <li>NSG flow logs</li> <li>Key Vault access logs</li> <li>Cost Management API queries</li> </ul> <p>APM (Application Performance Monitoring):</p> <ul> <li>Next.js frontend telemetry</li> <li>FastAPI backend traces</li> <li>Distributed tracing (OpenTelemetry)</li> <li>Custom metrics (FinOps savings, drift detection)</li> </ul> <p>Kusto queries:</p> <pre><code>// Top 10 most expensive resources last 7 days\nAzureCosts\n| where TimeGenerated &gt; ago(7d)\n| summarize TotalCost = sum(Cost) by ResourceId\n| top 10 by TotalCost desc\n\n// Failed Dify workflow runs\nAppTraces\n| where Message contains \"dify_workflow_failed\"\n| project TimeGenerated, WorkflowId, ErrorMessage\n| order by TimeGenerated desc\n</code></pre>"},{"location":"architecture/02-technology-stack/#cicd","title":"CI/CD","text":""},{"location":"architecture/02-technology-stack/#github-actions","title":"GitHub Actions","text":"<p>Workflows principales:</p> <ol> <li>Terraform Validation &amp; Plan</li> </ol> <pre><code># .github/workflows/terraform-plan.yml\n\nname: Terraform Plan\n\non:\n  pull_request:\n    paths:\n      - 'terraform/**'\n\njobs:\n  plan:\n    runs-on: self-hosted  # Runner en Hub AKS\n\n    steps:\n      - uses: actions/checkout@v4\n\n      - name: Setup Terragrunt\n        uses: gruntwork-io/terragrunt-action@v2\n        with:\n          terragrunt_version: 0.55.0\n\n      - name: Terragrunt Plan\n        run: |\n          cd terraform/\n          terragrunt run-all plan --terragrunt-non-interactive\n        env:\n          ARM_CLIENT_ID: ${{ secrets.AZURE_CLIENT_ID }}\n          ARM_CLIENT_SECRET: ${{ secrets.AZURE_CLIENT_SECRET }}\n          ARM_TENANT_ID: ${{ secrets.AZURE_TENANT_ID }}\n\n      - name: Post Plan to PR\n        uses: actions/github-script@v7\n        with:\n          script: |\n            // Post Terragrunt plan output como PR comment\n</code></pre> <ol> <li>Next.js Build &amp; Deploy</li> </ol> <pre><code># .github/workflows/nextjs-deploy.yml\n\nname: Deploy Next.js\n\non:\n  push:\n    branches: [main]\n    paths:\n      - 'apps/control-center-ui/**'\n\njobs:\n  build-and-deploy:\n    runs-on: self-hosted\n\n    steps:\n      - uses: actions/checkout@v4\n\n      - name: Build Next.js\n        run: |\n          cd apps/control-center-ui/\n          npm ci\n          npm run build\n\n      - name: Build Docker Image\n        run: |\n          docker build -t ccacr.azurecr.io/control-center-ui:${{ github.sha }} .\n          docker push ccacr.azurecr.io/control-center-ui:${{ github.sha }}\n\n      - name: Deploy to AKS Spoke-Prod\n        run: |\n          kubectl set image deployment/control-center-ui \\\n            ui=ccacr.azurecr.io/control-center-ui:${{ github.sha }} \\\n            -n control-center\n</code></pre> <ol> <li>FinOps Daily Check</li> </ol> <pre><code># .github/workflows/finops-daily.yml\n\nname: FinOps Daily Check\n\non:\n  schedule:\n    - cron: '0 8 * * *'  # 8 AM UTC daily\n\njobs:\n  analyze:\n    runs-on: self-hosted\n\n    steps:\n      - uses: actions/checkout@v4\n\n      - name: Run Underutilization Analysis\n        run: |\n          python scripts/finops/daily_cost_check.py\n        env:\n          AZURE_SUBSCRIPTION_HUB: 739aaf91-5cb2-45a6-ab4f-abf883e9d3f7\n          AZURE_SUBSCRIPTION_PROD: 353a6255-27a8-4733-adf0-1c531ba9f4e9\n          AZURE_SUBSCRIPTION_DEV: 0987a8ce-7f7d-4a28-8db2-5c2c3115dfa4\n\n      - name: Create PRs if needed\n        run: |\n          python scripts/finops/generate_optimization_prs.py\n</code></pre> <p>Self-hosted runner:</p> <ul> <li>Deployment en Hub AKS (DaemonSet o Deployment)</li> <li>Acceso VPN + VNet peering \u2192 puede alcanzar Spokes</li> <li>Pre-installed: Terragrunt, Terraform, Docker, kubectl, Azure CLI</li> </ul>"},{"location":"architecture/02-technology-stack/#networking-y-seguridad","title":"Networking y Seguridad","text":""},{"location":"architecture/02-technology-stack/#vpn-openvpn","title":"VPN (OpenVPN)","text":"<p>Gateway: <code>52.178.149.106</code> (public) Internal: <code>10.0.1.10</code> Network: <code>10.0.0.0/16</code> (Hub VNet)</p> <p>Acceso:</p> <ul> <li>Todo el tr\u00e1fico a Control Center pasa por VPN</li> <li>No public IPs en Spokes (solo internal IPs)</li> <li>LoadBalancers tipo <code>Internal</code> \u00fanicamente</li> </ul>"},{"location":"architecture/02-technology-stack/#vnet-peering","title":"VNet Peering","text":"<p>Hub \u2194 Spoke-Prod:</p> <ul> <li><code>hub-to-spoke-prod</code>: Hub puede iniciar conexiones a Spoke-Prod</li> <li><code>spoke-prod-to-hub</code>: Spoke-Prod puede iniciar a Hub (PostgreSQL, Redis, Dify)</li> <li>Allow forwarded traffic: <code>true</code></li> <li>Allow gateway transit: <code>true</code> (Hub VPN gateway)</li> </ul> <p>Hub \u2194 Spoke-Dev:</p> <ul> <li>Similar configuration a Spoke-Prod</li> </ul>"},{"location":"architecture/02-technology-stack/#azure-key-vault","title":"Azure Key Vault","text":"<p>Key Vault: <code>dify-private-kv</code> (Hub)</p> <p>Secrets para Control Center:</p> <pre><code>Key Vault Secrets:\n\u251c\u2500\u2500 cc-prod-db-connection-string    # PostgreSQL connection\n\u251c\u2500\u2500 cc-api-jwt-secret               # FastAPI JWT signing key\n\u251c\u2500\u2500 dify-api-key                    # Dify API authentication\n\u251c\u2500\u2500 azure-openai-api-key            # Azure OpenAI (v\u00eda Dify)\n\u2514\u2500\u2500 github-actions-token            # GitHub PAT para PRs\n</code></pre> <p>Access:</p> <ul> <li>FastAPI usa Managed Identity para leer secrets</li> <li>Kubernetes CSI driver monta secrets como volumes</li> <li>GitHub Actions self-hosted runner usa Service Principal</li> </ul>"},{"location":"architecture/02-technology-stack/#kubernetes-secrets-csi-driver","title":"Kubernetes Secrets CSI Driver","text":"<pre><code># kubernetes/control-center/secret-provider-class.yaml\n\napiVersion: secrets-store.csi.x-k8s.io/v1\nkind: SecretProviderClass\nmetadata:\n  name: cc-secrets\nspec:\n  provider: azure\n  parameters:\n    keyvaultName: dify-private-kv\n    tenantId: &lt;tenant-id&gt;\n    objects: |\n      array:\n        - objectName: cc-prod-db-connection-string\n          objectType: secret\n        - objectName: cc-api-jwt-secret\n          objectType: secret\n        - objectName: dify-api-key\n          objectType: secret\n</code></pre>"},{"location":"architecture/02-technology-stack/#justificacion-de-elecciones","title":"Justificaci\u00f3n de Elecciones","text":""},{"location":"architecture/02-technology-stack/#por-que-este-stack-vs-alternativas","title":"\u00bfPor qu\u00e9 este stack vs alternativas?","text":"Decisi\u00f3n Alternativas Consideradas Justificaci\u00f3n Terragrunt Terraform puro, Pulumi, Bicep Multi-subscription DRY, mantiene Terraform ecosystem, curva aprendizaje m\u00ednima Next.js 14 App Router Next.js Pages, Remix, SvelteKit Future-proof, RSC performance, MDX native, ecosystem maduro FastAPI Django REST, Flask, Node.js Async-first, type hints, OpenAPI auto, Azure SDK compatible Dify existing LangChain custom, Azure AI Studio Ya operacional, ahorro tiempo setup, conocimiento existente PostgreSQL shared PostgreSQL per-spoke, CosmosDB Cost optimization 40%, control center no data-intensive Redis in-cluster Azure Cache for Redis Cost optimization (pod vs managed), latencia menor Grafana + Prometheus Azure Monitor only, Datadog Open-source, customizable, no vendor lock-in GitHub Actions Azure DevOps, GitLab CI Git-native, free for private repos, YAML simple"},{"location":"architecture/02-technology-stack/#trade-offs-aceptados","title":"Trade-offs Aceptados","text":"Trade-off Impacto Mitigaci\u00f3n Terragrunt layer adicional Debugging m\u00e1s complejo Terragrunt genera .tf files inspeccionables PostgreSQL shared Contention potencial QoS settings, migration a dedicado si load &gt; 80% Redis in-cluster No managed backups Snapshots diarios a Blob Storage Single region Regional failure = downtime Acceptable para PoC, multi-region en Phase 4+ VPN \u00fanico VPN down = no access High availability VPN config (future), Azure Bastion alternativo"},{"location":"architecture/02-technology-stack/#referencias","title":"Referencias","text":"<ul> <li>Next.js Documentation</li> <li>FastAPI Documentation</li> <li>Terragrunt Documentation</li> <li>Dify Documentation</li> <li>Azure Well-Architected Framework</li> </ul> <p>\u00daltima actualizaci\u00f3n: 12 Octubre 2025 Versi\u00f3n: 1.0 Autor: Alberto Lacambra</p>"},{"location":"architecture/adr/","title":"Architecture Decision Records (ADR)","text":""},{"location":"architecture/adr/#introduccion","title":"Introducci\u00f3n","text":"<p>Este documento registra las decisiones arquitecturales clave del proyecto DXC Cloud Mind - Nirvana PoC, siguiendo el formato ADR (Architecture Decision Record).</p> <p>Cada decisi\u00f3n incluye:</p> <ul> <li>Contexto: Situaci\u00f3n que requer\u00eda una decisi\u00f3n</li> <li>Decisi\u00f3n: Qu\u00e9 se decidi\u00f3</li> <li>Consecuencias: Impactos positivos y negativos</li> <li>Estado: Actual, superseded, deprecated</li> </ul>"},{"location":"architecture/adr/#adr-001-single-aks-strategy","title":"ADR-001: Single-AKS Strategy","text":"<p>Fecha: Diciembre 2024 Estado: \u2705 Aprobado e Implementado Decisores: Alberto Lacambra, Equipo CloudMind</p>"},{"location":"architecture/adr/#contexto","title":"Contexto","text":"<p>Necesit\u00e1bamos decidir si crear nuevos clusters AKS o aprovechar el cluster existente <code>dify-aks</code> para los workloads CloudMind.</p> <p>Opciones evaluadas:</p> <ol> <li>Multi-AKS: 2 nuevos clusters (Hub + Spoke) - Coste: +\u20ac455/mes</li> <li>Single-AKS: Namespaces en cluster existente - Coste: +\u20ac5/mes</li> <li>Hybrid: 1 nuevo cluster + namespace - Coste: +\u20ac205/mes</li> </ol>"},{"location":"architecture/adr/#decision","title":"Decisi\u00f3n","text":"<p>\u2705 Implementar Single-AKS Strategy usando namespace isolation.</p> <p>Rationale:</p> <ul> <li>Minimizar costes (\u20ac450/mes ahorro vs Multi-AKS)</li> <li>Aprovechar infraestructura existente</li> <li>Reducir complejidad operacional</li> <li>Acelerar time-to-market</li> </ul>"},{"location":"architecture/adr/#consecuencias","title":"Consecuencias","text":"<p>Positivas:</p> <ul> <li>\u2705 Ahorro de \u20ac5,400/a\u00f1o</li> <li>\u2705 Deployment 90% m\u00e1s r\u00e1pido (6 min vs 65 min)</li> <li>\u2705 Container Insights compartido (free tier)</li> <li>\u2705 Operaciones simplificadas (1 cluster vs 3)</li> </ul> <p>Negativas:</p> <ul> <li>\u26a0\ufe0f Dependencia en cluster existente</li> <li>\u26a0\ufe0f Riesgo de \"noisy neighbor\"</li> <li>\u26a0\ufe0f L\u00edmites de escalabilidad futura</li> </ul> <p>Mitigaciones:</p> <ul> <li>Resource quotas estrictos por namespace</li> <li>Network policies para aislamiento</li> <li>Monitoring continuo de utilizaci\u00f3n</li> <li>Plan de migraci\u00f3n a Multi-AKS si &gt;85% utilization</li> </ul> <p>Estado Actual: Implementado y operacional desde Enero 2025.</p>"},{"location":"architecture/adr/#adr-002-oidc-authentication-no-secrets","title":"ADR-002: OIDC Authentication (No Secrets)","text":"<p>Fecha: Diciembre 2024 Estado: \u2705 Aprobado e Implementado Decisores: Alberto Lacambra</p>"},{"location":"architecture/adr/#contexto_1","title":"Contexto","text":"<p>GitHub Actions requiere autenticaci\u00f3n con Azure para desplegar recursos. Opciones tradicionales usaban Service Principal secrets almacenados en GitHub Secrets.</p> <p>Riesgos de Service Principal Secrets:</p> <ul> <li>Secretos pueden filtrarse si comprometen el repositorio</li> <li>Rotaci\u00f3n manual requerida</li> <li>Compliance issues (secretos de larga duraci\u00f3n)</li> </ul>"},{"location":"architecture/adr/#decision_1","title":"Decisi\u00f3n","text":"<p>\u2705 Implementar OIDC (OpenID Connect) con federated credentials.</p> <p>Configuraci\u00f3n:</p> <pre><code>az ad app federated-credential create \\\n  --id $APP_ID \\\n  --parameters '{\n    \"name\": \"github-oidc-main\",\n    \"issuer\": \"https://token.actions.githubusercontent.com\",\n    \"subject\": \"repo:AlbertoLacambra/DXC_PoC_Nirvana:ref:refs/heads/master\",\n    \"audiences\": [\"api://AzureADTokenExchange\"]\n  }'\n</code></pre>"},{"location":"architecture/adr/#consecuencias_1","title":"Consecuencias","text":"<p>Positivas:</p> <ul> <li>\u2705 Zero secretos almacenados en GitHub</li> <li>\u2705 Tokens de corta duraci\u00f3n (1 hora)</li> <li>\u2705 Rotaci\u00f3n autom\u00e1tica</li> <li>\u2705 Mejor compliance y seguridad</li> <li>\u2705 Trazabilidad de accesos</li> </ul> <p>Negativas:</p> <ul> <li>\u26a0\ufe0f Configuraci\u00f3n inicial m\u00e1s compleja</li> <li>\u26a0\ufe0f Requiere Azure AD application registration</li> </ul> <p>Estado Actual: Implementado. Cero secretos de Azure en GitHub Secrets.</p>"},{"location":"architecture/adr/#adr-003-terraform-state-en-azure-storage","title":"ADR-003: Terraform State en Azure Storage","text":"<p>Fecha: Diciembre 2024 Estado: \u2705 Aprobado e Implementado Decisores: Alberto Lacambra</p>"},{"location":"architecture/adr/#contexto_2","title":"Contexto","text":"<p>Terraform requiere almacenar el estado de la infraestructura. Opciones evaluadas:</p> <ol> <li>Local state: Archivo local <code>.tfstate</code></li> <li>Remote state (Azure Storage): Blob Storage con locking</li> <li>Terraform Cloud: SaaS de HashiCorp</li> </ol>"},{"location":"architecture/adr/#decision_2","title":"Decisi\u00f3n","text":"<p>\u2705 Usar Azure Storage Backend con blob storage y state locking.</p> <p>Configuraci\u00f3n:</p> <pre><code>terraform {\n  backend \"azurerm\" {\n    resource_group_name  = \"terraform-state-rg\"\n    storage_account_name = \"tfstate&lt;random&gt;\"\n    container_name       = \"tfstate\"\n    key                  = \"terraform.tfstate\"\n  }\n}\n</code></pre>"},{"location":"architecture/adr/#consecuencias_2","title":"Consecuencias","text":"<p>Positivas:</p> <ul> <li>\u2705 State compartido entre team members</li> <li>\u2705 State locking previene conflictos</li> <li>\u2705 Versionado autom\u00e1tico (blob snapshots)</li> <li>\u2705 Encryption at rest</li> <li>\u2705 Integraci\u00f3n nativa con Azure</li> </ul> <p>Negativas:</p> <ul> <li>\u26a0\ufe0f Coste adicional (~\u20ac1/mes)</li> <li>\u26a0\ufe0f Requiere setup inicial</li> </ul> <p>Estado Actual: Implementado. State en <code>tfstate-dxc-cloudmind</code>.</p>"},{"location":"architecture/adr/#adr-004-github-actions-para-cicd","title":"ADR-004: GitHub Actions para CI/CD","text":"<p>Fecha: Diciembre 2024 Estado: \u2705 Aprobado e Implementado Decisores: Alberto Lacambra</p>"},{"location":"architecture/adr/#contexto_3","title":"Contexto","text":"<p>Necesit\u00e1bamos plataforma CI/CD para automatizar despliegues. Opciones:</p> <ol> <li>GitHub Actions: Nativo en GitHub</li> <li>Azure DevOps: Plataforma Microsoft</li> <li>Jenkins: Self-hosted</li> <li>GitLab CI: Requiere migraci\u00f3n a GitLab</li> </ol>"},{"location":"architecture/adr/#decision_3","title":"Decisi\u00f3n","text":"<p>\u2705 Usar GitHub Actions como plataforma CI/CD principal.</p> <p>Rationale:</p> <ul> <li>Repositorio ya en GitHub</li> <li>OIDC integration nativa</li> <li>Costo-efectivo (2,000 minutos gratis/mes)</li> <li>Marketplace rico en actions</li> <li>YAML-based configuration</li> </ul>"},{"location":"architecture/adr/#consecuencias_3","title":"Consecuencias","text":"<p>Positivas:</p> <ul> <li>\u2705 Integraci\u00f3n perfecta con GitHub</li> <li>\u2705 OIDC authentication built-in</li> <li>\u2705 Reusable workflows</li> <li>\u2705 Free tier generoso</li> <li>\u2705 Matrix builds para multi-env</li> </ul> <p>Negativas:</p> <ul> <li>\u26a0\ufe0f Vendor lock-in a GitHub</li> <li>\u26a0\ufe0f Limitaciones en self-hosted runners (no usados a\u00fan)</li> </ul> <p>Workflows Implementados:</p> <ul> <li><code>deploy.yml</code>: Production deployment</li> <li><code>pr-validation.yml</code>: PR validation (7 gates)</li> <li><code>drift-detection.yml</code>: Daily drift detection</li> <li><code>gh-pages.yml</code>: Documentation deployment</li> </ul> <p>Estado Actual: 5 workflows activos y operacionales.</p>"},{"location":"architecture/adr/#adr-005-multi-gate-pr-validation","title":"ADR-005: Multi-Gate PR Validation","text":"<p>Fecha: Diciembre 2024 Estado: \u2705 Aprobado e Implementado Decisores: Alberto Lacambra</p>"},{"location":"architecture/adr/#contexto_4","title":"Contexto","text":"<p>Necesit\u00e1bamos garantizar calidad del c\u00f3digo Infrastructure-as-Code antes de merge a master.</p>"},{"location":"architecture/adr/#decision_4","title":"Decisi\u00f3n","text":"<p>\u2705 Implementar 7 security gates en PR validation.</p> <p>Gates Implementados:</p> <ol> <li><code>terraform fmt</code> - Validar formato</li> <li><code>terraform validate</code> - Validar sintaxis</li> <li><code>tfsec</code> - Security scanning</li> <li><code>checkov</code> - Policy compliance</li> <li><code>tflint</code> - Linting avanzado</li> <li><code>terraform plan</code> - Preview de cambios</li> <li>Manual approval - Gate humano (producci\u00f3n)</li> </ol>"},{"location":"architecture/adr/#consecuencias_4","title":"Consecuencias","text":"<p>Positivas:</p> <ul> <li>\u2705 Calidad de c\u00f3digo garantizada</li> <li>\u2705 Detecci\u00f3n temprana de security issues</li> <li>\u2705 Compliance autom\u00e1tico</li> <li>\u2705 Documentaci\u00f3n de cambios (plan)</li> </ul> <p>Negativas:</p> <ul> <li>\u26a0\ufe0f PR validation m\u00e1s lento (~3-5 mins)</li> <li>\u26a0\ufe0f Posibles falsos positivos</li> </ul> <p>M\u00e9tricas:</p> <ul> <li>Security issues detectados: 12 (pre-merge)</li> <li>PRs bloqueados por gates: 3</li> <li>Tiempo promedio validaci\u00f3n: 4 mins</li> </ul> <p>Estado Actual: Activo en todos los PRs.</p>"},{"location":"architecture/adr/#adr-006-acr-basic-sku","title":"ADR-006: ACR Basic SKU","text":"<p>Fecha: Diciembre 2024 Estado: \u2705 Aprobado e Implementado Decisores: Alberto Lacambra</p>"},{"location":"architecture/adr/#contexto_5","title":"Contexto","text":"<p>Necesit\u00e1bamos Azure Container Registry para almacenar im\u00e1genes. Opciones:</p> SKU Coste Storage Throughput Geo-replication Basic \u20ac5/mes 10 GB 10 MBps No Standard \u20ac20/mes 100 GB 100 MBps No Premium \u20ac80/mes 500 GB 800 MBps S\u00ed"},{"location":"architecture/adr/#decision_5","title":"Decisi\u00f3n","text":"<p>\u2705 Usar ACR Basic SKU para fase PoC.</p> <p>Rationale:</p> <ul> <li>PoC con pocas im\u00e1genes (&lt;5 im\u00e1genes)</li> <li>No requiere geo-replication</li> <li>Throughput suficiente para deployments manuales</li> <li>Budget constraint (minimizar costes)</li> </ul>"},{"location":"architecture/adr/#consecuencias_5","title":"Consecuencias","text":"<p>Positivas:</p> <ul> <li>\u2705 Coste m\u00ednimo (\u20ac5/mes)</li> <li>\u2705 Suficiente para PoC</li> <li>\u2705 Upgrade path a Standard/Premium</li> </ul> <p>Negativas:</p> <ul> <li>\u26a0\ufe0f Storage limitado (10 GB)</li> <li>\u26a0\ufe0f Throughput limitado (puede ralentizar pulls masivos)</li> </ul> <p>Plan de Upgrade:</p> <ul> <li>Trigger: &gt;8 GB storage o &gt;5 im\u00e1genes desplegadas</li> <li>Target: Standard SKU (+\u20ac15/mes)</li> </ul> <p>Estado Actual: Basic SKU, ~2 GB utilizado.</p>"},{"location":"architecture/adr/#adr-007-teams-notifications-con-adaptive-cards","title":"ADR-007: Teams Notifications con Adaptive Cards","text":"<p>Fecha: Diciembre 2024 Estado: \u2705 Aprobado e Implementado Decisores: Alberto Lacambra</p>"},{"location":"architecture/adr/#contexto_6","title":"Contexto","text":"<p>Necesit\u00e1bamos notificaciones de workflows CI/CD en Microsoft Teams.</p> <p>Opciones:</p> <ol> <li>Incoming Webhook + Simple JSON: Texto plano</li> <li>Incoming Webhook + Adaptive Cards: Rich formatting</li> <li>Power Automate: No-code integration</li> <li>Teams Bot: Custom bot application</li> </ol>"},{"location":"architecture/adr/#decision_6","title":"Decisi\u00f3n","text":"<p>\u2705 Usar Incoming Webhook con Adaptive Cards.</p> <p>Implementaci\u00f3n:</p> <pre><code>- name: \ud83d\udd14 Notify Teams\n  env:\n    TEAMS_WEBHOOK_URL: ${{ secrets.TEAMS_WEBHOOK_URL }}\n  run: |\n    curl -H \"Content-Type: application/json\" -d '{\n      \"type\": \"message\",\n      \"attachments\": [{\n        \"contentType\": \"application/vnd.microsoft.card.adaptive\",\n        \"content\": { ... }\n      }]\n    }' $TEAMS_WEBHOOK_URL\n</code></pre>"},{"location":"architecture/adr/#consecuencias_6","title":"Consecuencias","text":"<p>Positivas:</p> <ul> <li>\u2705 Rich formatting (colores, botones, iconos)</li> <li>\u2705 Configuraci\u00f3n simple</li> <li>\u2705 Sin coste adicional</li> <li>\u2705 Soporte para acciones (approve/reject)</li> </ul> <p>Negativas:</p> <ul> <li>\u26a0\ufe0f Requiere webhook URL en GitHub Secrets</li> <li>\u26a0\ufe0f Adaptive Cards requieren m\u00e1s JSON</li> </ul> <p>Tipos de Notificaciones:</p> <ul> <li>\u2705 Deployment success</li> <li>\u2705 Deployment failure</li> <li>\u26a0\ufe0f Drift detected</li> <li>\ud83d\udd14 PR approval required</li> </ul> <p>Estado Actual: Implementado en 3 workflows.</p>"},{"location":"architecture/adr/#adr-008-namespace-resource-quotas","title":"ADR-008: Namespace Resource Quotas","text":"<p>Fecha: Diciembre 2024 Estado: \u2705 Aprobado e Implementado Decisores: Alberto Lacambra</p>"},{"location":"architecture/adr/#contexto_7","title":"Contexto","text":"<p>Necesit\u00e1bamos evitar \"noisy neighbor\" problems en Single-AKS strategy.</p>"},{"location":"architecture/adr/#decision_7","title":"Decisi\u00f3n","text":"<p>\u2705 Implementar Resource Quotas estrictos por namespace.</p> <p>Configuraci\u00f3n:</p> <pre><code># cloudmind namespace\nhard:\n  requests.cpu: \"4\"        # Max 4 CPU solicitados\n  requests.memory: 8Gi     # Max 8Gi memory solicitado\n  limits.cpu: \"6\"          # Max 6 CPU l\u00edmite\n  limits.memory: 12Gi      # Max 12Gi memory l\u00edmite\n  pods: \"30\"               # Max 30 pods\n</code></pre>"},{"location":"architecture/adr/#consecuencias_7","title":"Consecuencias","text":"<p>Positivas:</p> <ul> <li>\u2705 Protecci\u00f3n contra resource exhaustion</li> <li>\u2705 Garantiza recursos para Dify namespace</li> <li>\u2705 Facilita capacity planning</li> <li>\u2705 Cost control por namespace</li> </ul> <p>Negativas:</p> <ul> <li>\u26a0\ufe0f Puede limitar escalabilidad</li> <li>\u26a0\ufe0f Requiere ajustes seg\u00fan uso real</li> </ul> <p>Monitorizaci\u00f3n:</p> <ul> <li>Alertas si &gt;85% quota utilizado</li> <li>Review mensual de quotas</li> <li>Ajuste seg\u00fan m\u00e9tricas reales</li> </ul> <p>Estado Actual: Quotas activos, utilizaci\u00f3n &lt;15%.</p>"},{"location":"architecture/adr/#adr-009-documentation-con-mkdocs-material","title":"ADR-009: Documentation con MkDocs Material","text":"<p>Fecha: Enero 2025 Estado: \u2705 Aprobado e Implementado Decisores: Alberto Lacambra</p>"},{"location":"architecture/adr/#contexto_8","title":"Contexto","text":"<p>Necesit\u00e1bamos documentaci\u00f3n t\u00e9cnica accesible y bien estructurada.</p> <p>Opciones:</p> <ol> <li>Markdown en GitHub: Simple pero b\u00e1sico</li> <li>MkDocs Material: Static site generator</li> <li>Docusaurus: React-based</li> <li>GitBook: SaaS platform</li> </ol>"},{"location":"architecture/adr/#decision_8","title":"Decisi\u00f3n","text":"<p>\u2705 Usar MkDocs Material con GitHub Pages.</p> <p>Rationale:</p> <ul> <li>Markdown-based (familiar)</li> <li>Tema Material moderno</li> <li>Search integrado</li> <li>Mermaid diagrams support</li> <li>GitHub Pages hosting gratuito</li> </ul>"},{"location":"architecture/adr/#consecuencias_8","title":"Consecuencias","text":"<p>Positivas:</p> <ul> <li>\u2705 Documentaci\u00f3n profesional</li> <li>\u2705 Search functionality</li> <li>\u2705 Mobile-friendly</li> <li>\u2705 Dark mode support</li> <li>\u2705 Hosting gratuito</li> </ul> <p>Negativas:</p> <ul> <li>\u26a0\ufe0f Requiere Python dependencies</li> <li>\u26a0\ufe0f Build step adicional</li> </ul> <p>Caracter\u00edsticas Implementadas:</p> <ul> <li>Navigation tabs</li> <li>Code copy buttons</li> <li>Git revision dates</li> <li>Mermaid diagrams</li> <li>Light/dark theme</li> <li>Spanish language</li> </ul> <p>Estado Actual: Desplegado en GitHub Pages.</p>"},{"location":"architecture/adr/#adr-010-hybrid-resource-management","title":"ADR-010: Hybrid Resource Management","text":"<p>Fecha: Diciembre 2024 Estado: \u2705 Aprobado e Implementado Decisores: Alberto Lacambra</p>"},{"location":"architecture/adr/#contexto_9","title":"Contexto","text":"<p>Recursos Dify ya exist\u00edan antes del proyecto CloudMind. Necesit\u00e1bamos decidir c\u00f3mo gestionarlos.</p> <p>Opciones:</p> <ol> <li>Import a Terraform: Gestionar todo con Terraform</li> <li>Data Sources Only: No tocar recursos existentes</li> <li>Manual Management: No usar IaC para existentes</li> </ol>"},{"location":"architecture/adr/#decision_9","title":"Decisi\u00f3n","text":"<p>\u2705 Usar Data Sources Only (opci\u00f3n no invasiva).</p> <p>Estrategia:</p> <pre><code># Existing resources - READ ONLY\ndata \"azurerm_kubernetes_cluster\" \"dify\" {\n  name                = \"dify-aks\"\n  resource_group_name = \"dify-rg\"\n}\n\n# New resources - MANAGED\nresource \"azurerm_container_registry\" \"cloudmind\" {\n  name = \"cloudmind${random_string.suffix.result}\"\n  ...\n}\n</code></pre>"},{"location":"architecture/adr/#consecuencias_9","title":"Consecuencias","text":"<p>Positivas:</p> <ul> <li>\u2705 Zero risk para Dify platform</li> <li>\u2705 Rollback seguro (eliminar CloudMind no afecta Dify)</li> <li>\u2705 Evoluci\u00f3n independiente</li> <li>\u2705 Clear separation of concerns</li> </ul> <p>Negativas:</p> <ul> <li>\u26a0\ufe0f No drift detection para recursos Dify</li> <li>\u26a0\ufe0f Configuraci\u00f3n duplicada (manual + Terraform)</li> </ul> <p>Principios:</p> <ul> <li>NO importar recursos existentes</li> <li>NO modificar recursos existentes</li> <li>S\u00cd leer como data sources</li> <li>S\u00cd gestionar recursos nuevos</li> </ul> <p>Estado Actual: Implementado, cero modificaciones a Dify.</p>"},{"location":"architecture/adr/#historico-de-decisiones-descartadas","title":"Hist\u00f3rico de Decisiones Descartadas","text":""},{"location":"architecture/adr/#multi-aks-architecture","title":"\u274c Multi-AKS Architecture","text":"<p>Rechazada: Diciembre 2024 Raz\u00f3n: Coste excesivo (\u20ac455/mes) para fase PoC Superseded by: ADR-001 (Single-AKS)</p>"},{"location":"architecture/adr/#terraform-cloud","title":"\u274c Terraform Cloud","text":"<p>Rechazada: Diciembre 2024 Raz\u00f3n: Coste adicional innecesario Superseded by: ADR-003 (Azure Storage Backend)</p>"},{"location":"architecture/adr/#service-principal-secrets","title":"\u274c Service Principal Secrets","text":"<p>Rechazada: Diciembre 2024 Raz\u00f3n: Riesgo de seguridad Superseded by: ADR-002 (OIDC)</p>"},{"location":"architecture/adr/#template-para-nuevas-adrs","title":"Template para Nuevas ADRs","text":"<pre><code>## ADR-XXX: [T\u00edtulo de la Decisi\u00f3n]\n\n**Fecha**: [Mes A\u00f1o]\n**Estado**: [Propuesto | Aprobado | Rechazado | Superseded | Deprecated]\n**Decisores**: [Nombres]\n\n### Contexto\n[Situaci\u00f3n que requiere decisi\u00f3n]\n\n### Decisi\u00f3n\n[Qu\u00e9 se decidi\u00f3 hacer]\n\n### Consecuencias\n**Positivas**:\n- [Lista de beneficios]\n\n**Negativas**:\n- [Lista de trade-offs]\n\n**Estado Actual**: [Descripci\u00f3n del estado de implementaci\u00f3n]\n</code></pre>"},{"location":"architecture/adr/#referencias","title":"Referencias","text":"<ul> <li>Architecture Overview</li> <li>Single-AKS Strategy</li> <li>Deployed Resources</li> </ul>"},{"location":"architecture/deployed-resources/","title":"Recursos Desplegados","text":""},{"location":"architecture/deployed-resources/#estado-actual-de-la-infraestructura","title":"Estado Actual de la Infraestructura","text":"<p>\u00daltima actualizaci\u00f3n: Enero 2025 Estado: \u2705 INFRASTRUCTURE DEPLOYED</p>"},{"location":"architecture/deployed-resources/#resumen-ejecutivo","title":"Resumen Ejecutivo","text":""},{"location":"architecture/deployed-resources/#metricas-clave","title":"\ud83d\udcca M\u00e9tricas Clave","text":"M\u00e9trica Valor Estado Recursos Desplegados 7 \u2705 Operacional Resource Groups 3 (1 existing + 2 new) \u2705 Active AKS Namespaces 2 \u2705 Running Workflows CI/CD 5 \u2705 Operational Coste Mensual ~\u20ac5/mes incremental \u2705 Dentro de presupuesto Ahorro vs Multi-AKS \u20ac450/mes \u2705 ROI positivo"},{"location":"architecture/deployed-resources/#recursos-por-resource-group","title":"Recursos por Resource Group","text":""},{"location":"architecture/deployed-resources/#1-resource-group-dify-rg-existing","title":"1. Resource Group: <code>dify-rg</code> (Existing)","text":"<p>Descripci\u00f3n: Infraestructura existente de Dify Platform (NO gestionada por Terraform).</p> Recurso Nombre Tipo Estado Uso AKS Cluster <code>dify-aks</code> Microsoft.ContainerService/managedClusters \u2705 Running Plataforma compartida PostgreSQL <code>dify-postgres-9107e36a</code> Microsoft.DBforPostgreSQL/flexibleServers \u2705 Running Base de datos compartida Storage Account <code>difyprivatest9107e36a</code> Microsoft.Storage/storageAccounts \u2705 Active Almacenamiento compartido Key Vault <code>dify-private-kv</code> Microsoft.KeyVault/vaults \u2705 Active Secretos compartidos Virtual Network <code>dify-private-vnet</code> Microsoft.Network/virtualNetworks \u2705 Active Red compartida Public IP <code>dify-vpn-public-ip</code> Microsoft.Network/publicIPAddresses \u2705 Active VPN Gateway <p>Coste Mensual Estimado: ~\u20ac222/mes (ya existente, no incremental)</p> <p>Estrategia Terraform:</p> <pre><code># Data sources only - NO management\ndata \"azurerm_kubernetes_cluster\" \"dify\" {\n  name                = \"dify-aks\"\n  resource_group_name = \"dify-rg\"\n}\n\ndata \"azurerm_postgresql_flexible_server\" \"dify\" {\n  name                = \"dify-postgres-9107e36a\"\n  resource_group_name = \"dify-rg\"\n}\n</code></pre>"},{"location":"architecture/deployed-resources/#2-resource-group-cloudmind-acr-rg-new-managed-by-terraform","title":"2. Resource Group: <code>cloudmind-acr-rg</code> (NEW - Managed by Terraform)","text":"<p>Descripci\u00f3n: Registro de contenedores para im\u00e1genes CloudMind.</p> Recurso Nombre Tipo Estado SKU/Tier Container Registry <code>cloudmind&lt;random&gt;</code> Microsoft.ContainerRegistry/registries \u2705 Active Basic Role Assignment <code>AcrPull-dify-aks</code> Microsoft.Authorization/roleAssignments \u2705 Active AcrPull <p>Coste Mensual: ~\u20ac5/mes</p> <p>Terraform Code:</p> <pre><code>resource \"azurerm_resource_group\" \"acr\" {\n  name     = \"cloudmind-acr-rg\"\n  location = var.location\n\n  tags = {\n    Environment = \"Production\"\n    Project     = \"CloudMind-PoC\"\n    ManagedBy   = \"Terraform\"\n  }\n}\n\nresource \"azurerm_container_registry\" \"cloudmind\" {\n  name                = \"cloudmind${random_string.suffix.result}\"\n  resource_group_name = azurerm_resource_group.acr.name\n  location            = azurerm_resource_group.acr.location\n  sku                 = \"Basic\"\n  admin_enabled       = false\n\n  tags = azurerm_resource_group.acr.tags\n}\n\nresource \"azurerm_role_assignment\" \"acr_pull\" {\n  scope                = azurerm_container_registry.cloudmind.id\n  role_definition_name = \"AcrPull\"\n  principal_id         = data.azurerm_kubernetes_cluster.dify.kubelet_identity[0].object_id\n}\n</code></pre> <p>Outputs:</p> <pre><code>output \"acr_login_server\" {\n  value       = azurerm_container_registry.cloudmind.login_server\n  description = \"Login server URL for ACR\"\n}\n\noutput \"acr_id\" {\n  value       = azurerm_container_registry.cloudmind.id\n  description = \"Resource ID of the ACR\"\n}\n</code></pre>"},{"location":"architecture/deployed-resources/#3-resource-group-cloudmind-hub-rg-new-managed-by-terraform","title":"3. Resource Group: <code>cloudmind-hub-rg</code> (NEW - Managed by Terraform)","text":"<p>Descripci\u00f3n: Servicios compartidos y governance para CloudMind.</p> Recurso Tipo Estado Prop\u00f3sito Resource Group Microsoft.Resources/resourceGroups \u2705 Active Contenedor de recursos compartidos <p>Coste Mensual: \u20ac0/mes (solo contenedor)</p> <p>Recursos Futuros Planificados:</p> <ul> <li>Log Analytics Workspace (si se requiere separado)</li> <li>Application Insights (si se requiere separado)</li> <li>Storage Account para logs (si se requiere)</li> </ul> <p>Terraform Code:</p> <pre><code>resource \"azurerm_resource_group\" \"hub\" {\n  name     = \"cloudmind-hub-rg\"\n  location = var.location\n\n  tags = {\n    Environment = \"Production\"\n    Project     = \"CloudMind-PoC\"\n    ManagedBy   = \"Terraform\"\n    Purpose     = \"Shared Services\"\n  }\n}\n</code></pre>"},{"location":"architecture/deployed-resources/#recursos-kubernetes","title":"Recursos Kubernetes","text":""},{"location":"architecture/deployed-resources/#namespace-cloudmind","title":"Namespace: <code>cloudmind</code>","text":"<p>Descripci\u00f3n: Namespace dedicado para workloads CloudMind en AKS existente.</p> <p>Especificaciones:</p> <pre><code>apiVersion: v1\nkind: Namespace\nmetadata:\n  name: cloudmind\n  labels:\n    name: cloudmind\n    environment: production\n    project: cloudmind-poc\n    managed-by: terraform\n</code></pre> <p>Resource Quota:</p> <pre><code>apiVersion: v1\nkind: ResourceQuota\nmetadata:\n  name: cloudmind-quota\n  namespace: cloudmind\nspec:\n  hard:\n    requests.cpu: \"4\"\n    requests.memory: 8Gi\n    limits.cpu: \"6\"\n    limits.memory: 12Gi\n    pods: \"30\"\n    services: \"15\"\n    persistentvolumeclaims: \"5\"\n    secrets: \"20\"\n    configmaps: \"20\"\n</code></pre> <p>Utilizaci\u00f3n Actual:</p> M\u00e9trica Uso Actual L\u00edmite % Utilizado CPU requests 0.5 CPU 4 CPU 12.5% Memory requests 1Gi 8Gi 12.5% Pods 0 30 0% Services 0 15 0% <p>Estado: Namespace creado, sin workloads desplegados a\u00fan.</p>"},{"location":"architecture/deployed-resources/#namespace-dify-existing","title":"Namespace: <code>dify</code> (Existing)","text":"<p>Descripci\u00f3n: Namespace existente para Dify Platform (NO gestionado por Terraform).</p> <p>Resource Quota:</p> <pre><code>apiVersion: v1\nkind: ResourceQuota\nmetadata:\n  name: dify-quota\n  namespace: dify\nspec:\n  hard:\n    requests.cpu: \"8\"\n    requests.memory: 16Gi\n    limits.cpu: \"12\"\n    limits.memory: 24Gi\n    pods: \"50\"\n    services: \"20\"\n    persistentvolumeclaims: \"10\"\n</code></pre> <p>Utilizaci\u00f3n Actual:</p> M\u00e9trica Uso Actual L\u00edmite % Utilizado CPU requests 6 CPU 8 CPU 75% Memory requests 12Gi 16Gi 75% Pods 25 50 50% Services 10 20 50% <p>Estado: Producci\u00f3n, ~25 pods activos.</p>"},{"location":"architecture/deployed-resources/#network-configuration","title":"Network Configuration","text":""},{"location":"architecture/deployed-resources/#virtual-network-dify-private-vnet","title":"Virtual Network: <code>dify-private-vnet</code>","text":"<p>CIDR: <code>10.0.0.0/16</code></p> <p>Subnets:</p> Subnet CIDR Prop\u00f3sito Recursos aks-subnet <code>10.0.2.0/24</code> AKS nodes dify-aks cluster vpn-subnet <code>10.0.1.0/24</code> VPN Gateway OpenVPN server db-subnet <code>10.0.3.0/24</code> Database PostgreSQL Flexible Server <p>Network Security:</p> <ul> <li>\u2705 Private endpoints habilitados</li> <li>\u2705 VPN Gateway para acceso seguro</li> <li>\u2705 Network Security Groups configurados</li> <li>\u2705 Service endpoints para Azure services</li> </ul>"},{"location":"architecture/deployed-resources/#rbac-y-seguridad","title":"RBAC y Seguridad","text":""},{"location":"architecture/deployed-resources/#service-principal-github-actions-oidc","title":"Service Principal: GitHub Actions OIDC","text":"<p>Configuraci\u00f3n:</p> <pre><code>{\n  \"appId\": \"&lt;redacted&gt;\",\n  \"displayName\": \"GitHub-OIDC-DXC-PoC-Nirvana\",\n  \"servicePrincipalId\": \"&lt;redacted&gt;\",\n  \"federatedCredentials\": [\n    {\n      \"subject\": \"repo:AlbertoLacambra/DXC_PoC_Nirvana:ref:refs/heads/master\",\n      \"issuer\": \"https://token.actions.githubusercontent.com\"\n    }\n  ]\n}\n</code></pre> <p>Roles Asignados:</p> Scope Role Justificaci\u00f3n Subscription Contributor Deploy y gesti\u00f3n de recursos <code>cloudmind-acr-rg</code> Owner Gesti\u00f3n completa ACR <code>cloudmind-hub-rg</code> Owner Gesti\u00f3n completa Hub <code>dify-rg</code> Reader Lectura de data sources <code>dify-aks</code> Azure Kubernetes Service Cluster User Gesti\u00f3n de namespaces <p>Secretos en GitHub:</p> Secret Name Tipo Uso <code>AZURE_CLIENT_ID</code> OIDC App ID Autenticaci\u00f3n GitHub Actions <code>AZURE_TENANT_ID</code> Tenant ID Autenticaci\u00f3n Azure AD <code>AZURE_SUBSCRIPTION_ID</code> Subscription ID Target subscription <code>TEAMS_WEBHOOK_URL</code> Webhook URL Notificaciones a Teams"},{"location":"architecture/deployed-resources/#monitorizacion","title":"Monitorizaci\u00f3n","text":""},{"location":"architecture/deployed-resources/#container-insights","title":"Container Insights","text":"<p>Configuraci\u00f3n:</p> <ul> <li>\u2705 Habilitado en <code>dify-aks</code> cluster</li> <li>\u2705 Free tier (primeros 10GB/mes gratis)</li> <li>\u2705 Dashboards pre-configurados</li> <li>\u2705 Alertas configuradas</li> </ul> <p>M\u00e9tricas Monitorizadas:</p> <ul> <li>CPU usage por namespace</li> <li>Memory usage por namespace</li> <li>Pod count y restarts</li> <li>Node health status</li> <li>Network traffic</li> <li>Storage I/O</li> </ul> <p>Dashboards Disponibles:</p> <ol> <li>Cluster overview</li> <li>Namespace performance</li> <li>Pod metrics</li> <li>Node health</li> <li>Container logs</li> </ol>"},{"location":"architecture/deployed-resources/#log-analytics-workspace","title":"Log Analytics Workspace","text":"<p>Workspace: Compartido con Dify Platform</p> <p>Retenci\u00f3n: 30 d\u00edas (free tier)</p> <p>Queries Frecuentes:</p> <pre><code>// CPU usage por namespace\nKubePodInventory\n| where TimeGenerated &gt; ago(1h)\n| summarize avg(CpuUsageNanoCores) by Namespace, bin(TimeGenerated, 5m)\n| render timechart\n\n// Memory usage por namespace\nKubePodInventory\n| where TimeGenerated &gt; ago(1h)\n| summarize avg(MemoryWorkingSetBytes) by Namespace, bin(TimeGenerated, 5m)\n| render timechart\n\n// Pod restarts \u00faltimas 24h\nKubePodInventory\n| where TimeGenerated &gt; ago(24h)\n| where RestartCount &gt; 0\n| summarize TotalRestarts = sum(RestartCount) by Namespace, PodName\n| order by TotalRestarts desc\n</code></pre>"},{"location":"architecture/deployed-resources/#cicd-workflows","title":"CI/CD Workflows","text":""},{"location":"architecture/deployed-resources/#workflows-activos","title":"Workflows Activos","text":"Workflow Archivo Trigger Estado Production Deploy <code>deploy.yml</code> Manual \u2705 Active PR Validation <code>pr-validation.yml</code> Pull Request \u2705 Active Drift Detection <code>drift-detection.yml</code> Cron (daily 05:00 UTC) \u2705 Active Terraform Deploy <code>terraform-deploy.yml</code> Push to master \u2705 Active Terraform PR <code>terraform-pr.yml</code> Pull Request \u2705 Active <p>Security Gates Configurados:</p> <ol> <li>\u2705 <code>terraform fmt</code> - Formato de c\u00f3digo</li> <li>\u2705 <code>terraform validate</code> - Validaci\u00f3n sint\u00e1ctica</li> <li>\u2705 <code>tfsec</code> - Security scanning</li> <li>\u2705 <code>checkov</code> - Policy compliance</li> <li>\u2705 <code>tflint</code> - Linting avanzado</li> <li>\u2705 <code>terraform plan</code> - Preview de cambios</li> <li>\u2705 Manual approval - Gate humano</li> </ol>"},{"location":"architecture/deployed-resources/#proximos-recursos-planificados","title":"Pr\u00f3ximos Recursos Planificados","text":""},{"location":"architecture/deployed-resources/#phase-1-application-deployment","title":"Phase 1: Application Deployment","text":"<p>Recursos a Crear:</p> <ul> <li>Kubernetes Deployments en namespace <code>cloudmind</code></li> <li>Kubernetes Services (ClusterIP, LoadBalancer)</li> <li>Ingress Controller configuration</li> <li>Certificates y TLS secrets</li> </ul> <p>Workloads Planificados:</p> <pre><code>Deployments:\n  - cloudmind-ui (Next.js)\n  - cloudmind-api (FastAPI)\n  - cloudmind-worker (Background jobs)\n\nServices:\n  - cloudmind-ui-svc (LoadBalancer)\n  - cloudmind-api-svc (ClusterIP)\n  - cloudmind-worker-svc (ClusterIP)\n</code></pre>"},{"location":"architecture/deployed-resources/#phase-2-shared-services","title":"Phase 2: Shared Services","text":"<p>Recursos Potenciales:</p> <ul> <li>Application Gateway (si se requiere WAF)</li> <li>Azure Front Door (si se requiere CDN)</li> <li>Cosmos DB (si se requiere NoSQL)</li> <li>Azure Cache for Redis (si se requiere cache dedicado)</li> </ul> <p>Estimaci\u00f3n de Costes: +\u20ac50-100/mes seg\u00fan configuraci\u00f3n</p>"},{"location":"architecture/deployed-resources/#analisis-de-costes","title":"An\u00e1lisis de Costes","text":""},{"location":"architecture/deployed-resources/#coste-actual","title":"Coste Actual","text":"<pre><code>INFRASTRUCTURE COSTS (Monthly):\n\nExisting Resources (Dify) - Shared:\n\u251c\u2500\u2500 AKS Cluster (dify-aks)          \u20ac200\n\u251c\u2500\u2500 PostgreSQL Flexible Server       \u20ac15\n\u251c\u2500\u2500 Storage Account                   \u20ac5\n\u251c\u2500\u2500 Key Vault                         \u20ac2\n\u251c\u2500\u2500 Virtual Network                   \u20ac0\n\u2514\u2500\u2500 Container Insights (Free tier)    \u20ac0\n    SUBTOTAL (Existing):            \u20ac222\n\nNew Resources (CloudMind) - Managed by Terraform:\n\u251c\u2500\u2500 Resource Groups                   \u20ac0\n\u251c\u2500\u2500 ACR Basic                         \u20ac5\n\u251c\u2500\u2500 Namespace (cloudmind)             \u20ac0\n\u2514\u2500\u2500 Role Assignments                  \u20ac0\n    SUBTOTAL (New):                   \u20ac5\n\nTOTAL MONTHLY COST:                 \u20ac227\n  (\u20ac5 incremental vs baseline)\n</code></pre>"},{"location":"architecture/deployed-resources/#roi-vs-multi-aks","title":"ROI vs Multi-AKS","text":"<p>Ahorro Mensual: \u20ac450/mes Ahorro Anual: \u20ac5,400/a\u00f1o Ahorro 2 A\u00f1os: \u20ac10,800</p>"},{"location":"architecture/deployed-resources/#referencias","title":"Referencias","text":"<ul> <li>Arquitectura Overview</li> <li>Single-AKS Strategy</li> <li>Workflows CI/CD</li> <li>An\u00e1lisis de Costes</li> </ul>"},{"location":"architecture/overview/","title":"Visi\u00f3n General de la Arquitectura","text":""},{"location":"architecture/overview/#introduccion","title":"Introducci\u00f3n","text":"<p>El proyecto DXC Cloud Mind - Nirvana PoC implementa una plataforma AI-driven CloudOps que aprovecha la infraestructura existente de Dify mediante una estrategia Single-AKS con aislamiento por namespaces.</p>"},{"location":"architecture/overview/#objetivos-arquitecturales","title":"Objetivos Arquitecturales","text":""},{"location":"architecture/overview/#principios-de-diseno","title":"\ud83c\udfaf Principios de Dise\u00f1o","text":"<ol> <li>Cost Optimization: Minimizar costes reutilizando infraestructura existente</li> <li>Namespace Isolation: Segregar workloads mediante namespaces de Kubernetes</li> <li>Non-invasive Approach: No modificar recursos existentes de Dify</li> <li>Shared Services: Aprovechar recursos compartidos (ACR, PostgreSQL, Storage)</li> <li>GitOps Automation: CI/CD completo con GitHub Actions</li> </ol>"},{"location":"architecture/overview/#arquitectura-de-alto-nivel","title":"\ud83d\udcca Arquitectura de Alto Nivel","text":"<pre><code>graph TB\n    subgraph Azure[\"Azure Subscription: 739aaf91-5cb2-45a6-ab4f-abf883e9d3f7\"]\n        subgraph RG1[\"dify-rg (Existing)\"]\n            AKS[AKS Cluster: dify-aks&lt;br/&gt;Kubernetes 1.30.14]\n\n            subgraph NS1[\"Namespace: dify\"]\n                Dify[Dify Platform&lt;br/&gt;AI Workflows]\n            end\n\n            subgraph NS2[\"Namespace: cloudmind (NEW)\"]\n                CloudMind[CloudMind PoC&lt;br/&gt;Control Center]\n            end\n\n            PostgreSQL[(PostgreSQL&lt;br/&gt;Flexible Server)]\n            Storage[(Storage Account)]\n            KeyVault[Key Vault]\n            VNet[Virtual Network]\n        end\n\n        subgraph RG2[\"cloudmind-acr-rg (NEW)\"]\n            ACR[Azure Container&lt;br/&gt;Registry]\n        end\n\n        subgraph RG3[\"cloudmind-hub-rg (NEW)\"]\n            Shared[Shared Services &amp;&lt;br/&gt;Governance]\n        end\n    end\n\n    AKS --&gt; NS1\n    AKS --&gt; NS2\n    NS2 --&gt; ACR\n    NS1 --&gt; PostgreSQL\n    NS2 --&gt; PostgreSQL\n    NS1 --&gt; Storage\n    NS2 --&gt; Storage\n    NS1 --&gt; KeyVault\n    NS2 --&gt; KeyVault\n\n    style NS2 fill:#e1f5ff\n    style RG2 fill:#ffe1e1\n    style RG3 fill:#ffe1e1</code></pre>"},{"location":"architecture/overview/#componentes-principales","title":"Componentes Principales","text":""},{"location":"architecture/overview/#1-infraestructura-existente-dify","title":"1. Infraestructura Existente (Dify)","text":"Componente Recurso Estado Uso AKS Cluster <code>dify-aks</code> \u2705 Running Plataforma compartida PostgreSQL <code>dify-postgres</code> \u2705 Running Base de datos compartida Storage <code>difyprivatest9107e36a</code> \u2705 Active Almacenamiento compartido Key Vault <code>dify-private-kv</code> \u2705 Active Secretos compartidos Virtual Network <code>dify-private-vnet</code> \u2705 Active Red compartida <p>Estrategia: Usar como data sources solamente, sin modificaciones.</p>"},{"location":"architecture/overview/#2-recursos-nuevos-cloudmind","title":"2. Recursos Nuevos (CloudMind)","text":"Componente Recurso Estado Prop\u00f3sito Resource Group <code>cloudmind-acr-rg</code> \u2705 Deployed Registro de contenedores ACR <code>cloudmind&lt;suffix&gt;</code> \u2705 Deployed Im\u00e1genes de contenedores Resource Group <code>cloudmind-hub-rg</code> \u2705 Deployed Servicios compartidos Namespace <code>cloudmind</code> \u2705 Deployed Workloads CloudMind ResourceQuota <code>cloudmind-quota</code> \u2705 Deployed L\u00edmites de recursos <p>Estrategia: Gestionados 100% con Terraform.</p>"},{"location":"architecture/overview/#decisiones-arquitecturales-clave","title":"Decisiones Arquitecturales Clave","text":""},{"location":"architecture/overview/#single-aks-strategy","title":"\u2705 Single-AKS Strategy","text":"<p>Decisi\u00f3n: Usar el cluster AKS existente (<code>dify-aks</code>) en lugar de crear nuevos clusters.</p> <p>Rationale: - Ahorro de costes: ~\u20ac200/mes por cluster evitado - Simplicidad operacional: Un solo cluster que mantener - Shared resources: Container Insights gratuito (free tier)</p> <p>Implementaci\u00f3n: <pre><code>Namespace Isolation:\n  - dify: 8 CPU / 16Gi Memory / 50 pods (existing)\n  - cloudmind: 4 CPU / 8Gi Memory / 30 pods (NEW)\n  - future-use-cases: Expandible seg\u00fan necesidad\n</code></pre></p> <p>Trade-offs: - \u2705 Pros: Coste m\u00ednimo, r\u00e1pida implementaci\u00f3n - \u26a0\ufe0f Contras: Dependencia en cluster existente, l\u00edmites de escalabilidad</p>"},{"location":"architecture/overview/#hybrid-resource-management","title":"\u2705 Hybrid Resource Management","text":"<p>Decisi\u00f3n: Gesti\u00f3n h\u00edbrida de recursos (existentes + nuevos).</p> <p>Enfoque: <pre><code># Existing resources (data sources only)\ndata \"azurerm_kubernetes_cluster\" \"dify\" {\n  name                = \"dify-aks\"\n  resource_group_name = \"dify-rg\"\n}\n\ndata \"azurerm_postgresql_flexible_server\" \"dify\" {\n  name                = \"dify-postgres-9107e36a\"\n  resource_group_name = \"dify-rg\"\n}\n\n# New resources (managed by Terraform)\nresource \"azurerm_container_registry\" \"cloudmind\" {\n  name                = \"cloudmind${random_string.suffix.result}\"\n  resource_group_name = azurerm_resource_group.acr.name\n  location            = var.location\n  sku                 = \"Basic\"\n}\n</code></pre></p> <p>Beneficios: - No invasivo: Dify contin\u00faa funcionando sin cambios - Rollback seguro: Eliminar CloudMind no afecta a Dify - Evoluci\u00f3n independiente: Cada sistema puede evolucionar</p>"},{"location":"architecture/overview/#gitops-with-github-actions","title":"\u2705 GitOps with GitHub Actions","text":"<p>Decisi\u00f3n: CI/CD completo con GitHub Actions + OIDC.</p> <p>Workflows Implementados: 1. deploy.yml: Despliegue a producci\u00f3n (manual approval) 2. pr-validation.yml: Validaci\u00f3n de PRs (7 security gates) 3. drift-detection.yml: Detecci\u00f3n diaria de drift</p> <p>Security Gates: <pre><code>graph LR\n    PR[Pull Request] --&gt; Format[terraform fmt]\n    Format --&gt; Validate[terraform validate]\n    Validate --&gt; TFSec[tfsec scan]\n    TFSec --&gt; Checkov[checkov scan]\n    Checkov --&gt; TFLint[tflint scan]\n    TFLint --&gt; Plan[terraform plan]\n    Plan --&gt; Approval[Manual Approval]\n    Approval --&gt; Apply[terraform apply]</code></pre></p>"},{"location":"architecture/overview/#costes-y-roi","title":"Costes y ROI","text":""},{"location":"architecture/overview/#analisis-de-costes","title":"\ud83d\udcb0 An\u00e1lisis de Costes","text":"Concepto Multi-AKS (Descartado) Single-AKS (Implementado) Ahorro Hub AKS \u20ac200/mes \u20ac0 (usa dify-aks) \u20ac200/mes Spoke AKS \u20ac200/mes \u20ac0 (namespace isolation) \u20ac200/mes Container Insights \u20ac50/mes \u20ac0 (free tier) \u20ac50/mes ACR Basic \u20ac5/mes \u20ac5/mes \u20ac0 TOTAL \u20ac455/mes \u20ac5/mes \u20ac450/mes <p>ROI Anual: \u20ac5,400 ahorrados</p>"},{"location":"architecture/overview/#escalabilidad","title":"\ud83d\udcc8 Escalabilidad","text":"<p>Modelo de Crecimiento: <pre><code>Phase 0 (Actual): 1 namespace (cloudmind)\n\u251c\u2500\u2500 4 CPU / 8Gi Memory / 30 pods\n\u2514\u2500\u2500 Coste: \u20ac5/mes\n\nPhase 1 (Future): 3 namespaces\n\u251c\u2500\u2500 cloudmind: 4 CPU / 8Gi / 30 pods\n\u251c\u2500\u2500 use-case-1: 2 CPU / 4Gi / 20 pods\n\u2514\u2500\u2500 use-case-2: 2 CPU / 4Gi / 20 pods\n\u2514\u2500\u2500 Coste: \u20ac5/mes (sin cambios en AKS)\n\nPhase 2 (Scale-out): Nuevo AKS si necesario\n\u251c\u2500\u2500 Trigger: &gt;80% utilizaci\u00f3n cluster\n\u2514\u2500\u2500 Coste incremental: \u20ac200/mes\n</code></pre></p>"},{"location":"architecture/overview/#proximos-pasos","title":"Pr\u00f3ximos Pasos","text":""},{"location":"architecture/overview/#roadmap-tecnico","title":"\ud83d\ude80 Roadmap T\u00e9cnico","text":"<ol> <li>Phase 1: Deployment de aplicaciones CloudMind</li> <li>Next.js UI</li> <li>FastAPI Gateway</li> <li> <p>Integraci\u00f3n con Dify</p> </li> <li> <p>Phase 2: Casos de uso iniciales</p> </li> <li>FinOps Automation</li> <li>Governance Policies</li> <li> <p>Incident Response</p> </li> <li> <p>Phase 3: Expansi\u00f3n</p> </li> <li>Nuevos namespaces seg\u00fan demanda</li> <li>Evaluaci\u00f3n de multi-cluster si necesario</li> <li>Integraci\u00f3n con servicios Azure adicionales</li> </ol>"},{"location":"architecture/overview/#referencias","title":"Referencias","text":"<ul> <li>Single-AKS Strategy</li> <li>Recursos Desplegados</li> <li>Decisiones T\u00e9cnicas (ADR)</li> <li>Workflows CI/CD</li> </ul>"},{"location":"architecture/single-aks/","title":"Estrategia Single-AKS","text":""},{"location":"architecture/single-aks/#resumen-ejecutivo","title":"Resumen Ejecutivo","text":"<p>La Single-AKS Strategy es una decisi\u00f3n arquitectural clave del proyecto CloudMind que maximiza el aprovechamiento de infraestructura existente mediante aislamiento por namespaces en lugar de crear nuevos clusters AKS.</p>"},{"location":"architecture/single-aks/#contexto-de-la-decision","title":"Contexto de la Decisi\u00f3n","text":""},{"location":"architecture/single-aks/#situacion-inicial","title":"Situaci\u00f3n Inicial","text":"<p>Infraestructura Existente: - AKS Cluster: <code>dify-aks</code> (Kubernetes 1.30.14) - Namespace: <code>dify</code> (plataforma AI en producci\u00f3n) - Recursos compartidos: PostgreSQL, Storage, Key Vault, VNet - Coste mensual: ~\u20ac222/mes</p> <p>Opciones Evaluadas:</p> Opci\u00f3n Descripci\u00f3n Coste Ventajas Desventajas A: Multi-AKS 2 nuevos clusters (hub + spoke) +\u20ac455/mes Aislamiento total Coste elevado, complejidad B: Single-AKS Namespaces en cluster existente +\u20ac5/mes M\u00ednimo coste Dependencia compartida C: Hybrid 1 nuevo cluster + namespace +\u20ac205/mes Balance Coste moderado <p>Decisi\u00f3n: Opci\u00f3n B - Single-AKS Strategy \u2705</p>"},{"location":"architecture/single-aks/#implementacion","title":"Implementaci\u00f3n","text":""},{"location":"architecture/single-aks/#arquitectura-de-namespaces","title":"Arquitectura de Namespaces","text":"<pre><code>graph TB\n    subgraph AKS[\"AKS Cluster: dify-aks\"]\n        subgraph NS1[\"Namespace: dify\"]\n            D1[Dify API]\n            D2[Dify Worker]\n            D3[Dify Web]\n            D4[RAG Services]\n        end\n\n        subgraph NS2[\"Namespace: cloudmind\"]\n            C1[Control Center UI]\n            C2[API Gateway]\n            C3[PoC Services]\n        end\n\n        subgraph NS3[\"Namespace: use-cases (Future)\"]\n            U1[FinOps Agents]\n            U2[Governance Bots]\n            U3[Incident Response]\n        end\n\n        subgraph Resources[\"Cluster Resources\"]\n            CPU[CPU Pool]\n            Memory[Memory Pool]\n            Storage[Storage Classes]\n            Network[Network Policies]\n        end\n    end\n\n    NS1 --&gt; CPU\n    NS2 --&gt; CPU\n    NS3 --&gt; CPU\n    NS1 --&gt; Memory\n    NS2 --&gt; Memory\n    NS3 --&gt; Memory\n\n    style NS2 fill:#e1f5ff\n    style NS3 fill:#f0f0f0</code></pre>"},{"location":"architecture/single-aks/#resource-quotas","title":"Resource Quotas","text":"<p>Configuraci\u00f3n Implementada:</p> <pre><code># Namespace: dify (existing)\napiVersion: v1\nkind: ResourceQuota\nmetadata:\n  name: dify-quota\n  namespace: dify\nspec:\n  hard:\n    requests.cpu: \"8\"\n    requests.memory: 16Gi\n    limits.cpu: \"12\"\n    limits.memory: 24Gi\n    pods: \"50\"\n    services: \"20\"\n    persistentvolumeclaims: \"10\"\n\n# Namespace: cloudmind (NEW)\napiVersion: v1\nkind: ResourceQuota\nmetadata:\n  name: cloudmind-quota\n  namespace: cloudmind\nspec:\n  hard:\n    requests.cpu: \"4\"\n    requests.memory: 8Gi\n    limits.cpu: \"6\"\n    limits.memory: 12Gi\n    pods: \"30\"\n    services: \"15\"\n    persistentvolumeclaims: \"5\"\n</code></pre> <p>Distribuci\u00f3n de Recursos:</p> <pre><code>Cluster Total Capacity: ~16 CPU / 32Gi Memory\n\nAllocation:\n\u251c\u2500\u2500 dify namespace: 8 CPU / 16Gi (50%)\n\u251c\u2500\u2500 cloudmind namespace: 4 CPU / 8Gi (25%)\n\u251c\u2500\u2500 system pods: 2 CPU / 4Gi (12.5%)\n\u2514\u2500\u2500 buffer: 2 CPU / 4Gi (12.5%)\n</code></pre>"},{"location":"architecture/single-aks/#network-policies","title":"Network Policies","text":"<p>Aislamiento de Red:</p> <pre><code># cloudmind namespace - allow ingress from specific sources\napiVersion: networking.k8s.io/v1\nkind: NetworkPolicy\nmetadata:\n  name: cloudmind-ingress\n  namespace: cloudmind\nspec:\n  podSelector: {}\n  policyTypes:\n  - Ingress\n  - Egress\n  ingress:\n  - from:\n    - namespaceSelector:\n        matchLabels:\n          name: dify\n    - podSelector: {}\n  egress:\n  - to:\n    - namespaceSelector:\n        matchLabels:\n          name: dify\n    - podSelector: {}\n  - to:  # Allow external services\n    - namespaceSelector: {}\n</code></pre> <p>Principios: - \u2705 Default deny all traffic - \u2705 Allow inter-namespace communication controlada - \u2705 Allow egress to servicios externos (PostgreSQL, Storage) - \u2705 Deny traffic no autorizado</p>"},{"location":"architecture/single-aks/#ventajas-de-la-estrategia","title":"Ventajas de la Estrategia","text":""},{"location":"architecture/single-aks/#ahorro-de-costes","title":"\ud83d\udcb0 Ahorro de Costes","text":"<p>Comparativa Real:</p> Recurso Multi-AKS Single-AKS Ahorro Mensual Hub AKS Cluster \u20ac200 \u20ac0 \u20ac200 Spoke AKS Cluster \u20ac200 \u20ac0 \u20ac200 Container Insights (2 clusters) \u20ac50 \u20ac0 \u20ac50 ACR Basic \u20ac5 \u20ac5 \u20ac0 TOTAL \u20ac455 \u20ac5 \u20ac450/mes <p>ROI: - Ahorro anual: \u20ac5,400 - Ahorro 2 a\u00f1os: \u20ac10,800 - Tiempo de implementaci\u00f3n reducido: 70% m\u00e1s r\u00e1pido</p>"},{"location":"architecture/single-aks/#simplicidad-operacional","title":"\ud83d\ude80 Simplicidad Operacional","text":"<p>Operaciones Reducidas: - \u2705 1 cluster que actualizar (vs 3) - \u2705 1 Container Insights que monitorizar - \u2705 1 RBAC configuration que mantener - \u2705 1 networking setup que gestionar</p> <p>Time to Market: <pre><code>Multi-AKS:\n\u251c\u2500\u2500 Deploy Hub AKS: 20 mins\n\u251c\u2500\u2500 Deploy Spoke AKS: 20 mins\n\u251c\u2500\u2500 Configure peering: 10 mins\n\u251c\u2500\u2500 Setup monitoring: 15 mins\n\u2514\u2500\u2500 TOTAL: ~65 mins\n\nSingle-AKS:\n\u251c\u2500\u2500 Create namespace: 2 mins\n\u251c\u2500\u2500 Apply resource quotas: 1 min\n\u251c\u2500\u2500 Configure ACR pull: 3 mins\n\u2514\u2500\u2500 TOTAL: ~6 mins\n</code></pre></p> <p>Reducci\u00f3n: 90% tiempo de deployment</p>"},{"location":"architecture/single-aks/#shared-resources","title":"\ud83d\udd04 Shared Resources","text":"<p>Servicios Compartidos:</p> <pre><code>graph LR\n    NS_Dify[Namespace: dify] --&gt; PG[(PostgreSQL)]\n    NS_Cloud[Namespace: cloudmind] --&gt; PG\n\n    NS_Dify --&gt; SA[(Storage Account)]\n    NS_Cloud --&gt; SA\n\n    NS_Dify --&gt; KV[Key Vault]\n    NS_Cloud --&gt; KV\n\n    NS_Dify --&gt; CI[Container Insights]\n    NS_Cloud --&gt; CI\n\n    style CI fill:#c8e6c9\n    style PG fill:#c8e6c9\n    style SA fill:#c8e6c9\n    style KV fill:#c8e6c9</code></pre> <p>Beneficios: - Free tier Container Insights compartido - PostgreSQL connection pool optimizado - Storage Account sin duplicaci\u00f3n - Key Vault single source of truth</p>"},{"location":"architecture/single-aks/#trade-offs-y-mitigaciones","title":"Trade-offs y Mitigaciones","text":""},{"location":"architecture/single-aks/#riesgos-identificados","title":"\u26a0\ufe0f Riesgos Identificados","text":"Riesgo Probabilidad Impacto Mitigaci\u00f3n Noisy neighbor Media Medio Resource quotas estrictos + monitoring Cluster failure Baja Alto Backup strategy + disaster recovery plan Resource contention Media Bajo Over-provisioning del cluster + autoscaling Security isolation Baja Alto Network policies + RBAC strict"},{"location":"architecture/single-aks/#mitigaciones-implementadas","title":"\u2705 Mitigaciones Implementadas","text":"<p>1. Resource Quotas Estrictos: <pre><code># Garantiza que ning\u00fan namespace puede consumir &gt;50% recursos\nhard:\n  limits.cpu: \"6\"      # Max 6 CPU por namespace\n  limits.memory: 12Gi  # Max 12Gi por namespace\n</code></pre></p> <p>2. Monitoring y Alertas: <pre><code># Container Insights alerts configurados\n- CPU usage &gt; 80% por namespace (5 mins)\n- Memory usage &gt; 85% por namespace (5 mins)\n- Pod evictions en cualquier namespace\n- Node pressure events\n</code></pre></p> <p>3. Network Policies: <pre><code># Aislamiento por defecto\npolicyTypes:\n  - Ingress  # Control de tr\u00e1fico entrante\n  - Egress   # Control de tr\u00e1fico saliente\n</code></pre></p> <p>4. RBAC Segregation: <pre><code># Usuarios dify: solo acceso a namespace dify\n# Usuarios cloudmind: solo acceso a namespace cloudmind\n# Admins: acceso completo\n</code></pre></p>"},{"location":"architecture/single-aks/#escalabilidad-futura","title":"Escalabilidad Futura","text":""},{"location":"architecture/single-aks/#plan-de-crecimiento","title":"\ud83d\udcc8 Plan de Crecimiento","text":"<p>Phase 0 (Actual): 1 namespace adicional <pre><code>Cluster capacity: 16 CPU / 32Gi\n\u251c\u2500\u2500 dify: 8 CPU / 16Gi (50%)\n\u251c\u2500\u2500 cloudmind: 4 CPU / 8Gi (25%)\n\u2514\u2500\u2500 Available: 4 CPU / 8Gi (25%)\n</code></pre></p> <p>Phase 1: 2-3 namespaces adicionales <pre><code>Cluster capacity: 16 CPU / 32Gi (same)\n\u251c\u2500\u2500 dify: 8 CPU / 16Gi (50%)\n\u251c\u2500\u2500 cloudmind: 3 CPU / 6Gi (19%)\n\u251c\u2500\u2500 use-case-1: 2 CPU / 4Gi (12%)\n\u251c\u2500\u2500 use-case-2: 2 CPU / 4Gi (12%)\n\u2514\u2500\u2500 Available: 1 CPU / 2Gi (6%)\n</code></pre></p> <p>Phase 2: Scale-out si necesario <pre><code>Trigger: &gt;85% cluster utilization durante 7 d\u00edas\nAction: Deploy nuevo AKS cluster\nCost impact: +\u20ac200/mes\nStrategy: Migrate low-priority workloads\n</code></pre></p>"},{"location":"architecture/single-aks/#migration-path","title":"\ud83d\udd04 Migration Path","text":"<p>Si se requiere Multi-AKS en el futuro:</p> <pre><code># Step 1: Deploy nuevo AKS cluster\nterraform apply -target=module.spoke_aks\n\n# Step 2: Configure peering\nterraform apply -target=module.vnet_peering\n\n# Step 3: Migrate workloads gradualmente\nkubectl get all -n cloudmind -o yaml &gt; backup.yaml\n# Apply to new cluster\nkubectl apply -f backup.yaml --context=new-cluster\n\n# Step 4: Update DNS/routing\n# Step 5: Decommission old namespace\n</code></pre> <p>Tiempo estimado: 2-3 horas Downtime: &lt;5 minutos con blue/green deployment</p>"},{"location":"architecture/single-aks/#monitorizacion","title":"Monitorizaci\u00f3n","text":""},{"location":"architecture/single-aks/#metricas-clave","title":"\ud83d\udcca M\u00e9tricas Clave","text":"<p>Dashboard Container Insights:</p> <pre><code>Cluster Health:\n  - Node CPU usage: &lt;70%\n  - Node Memory usage: &lt;75%\n  - Node disk pressure: 0 events\n  - Pod eviction rate: &lt;1/hour\n\nNamespace: dify\n  - CPU usage: 4-6 CPU (50-75% quota)\n  - Memory usage: 10-12Gi (62-75% quota)\n  - Pod count: 15-25 (30-50% quota)\n  - Restart rate: &lt;2/hour\n\nNamespace: cloudmind\n  - CPU usage: 1-2 CPU (25-50% quota)\n  - Memory usage: 3-5Gi (37-62% quota)\n  - Pod count: 5-10 (16-33% quota)\n  - Restart rate: &lt;1/hour\n</code></pre> <p>Alertas Configuradas: - \ud83d\udd34 Critical: Namespace CPU &gt;90% quota (5 mins) - \ud83d\udfe0 Warning: Namespace Memory &gt;85% quota (10 mins) - \ud83d\udfe1 Info: Cluster node count changed - \ud83d\udd35 Debug: New pod deployment</p>"},{"location":"architecture/single-aks/#conclusiones","title":"Conclusiones","text":""},{"location":"architecture/single-aks/#decision-validada","title":"\u2705 Decisi\u00f3n Validada","text":"<p>Resultados Reales (Enero 2025): - \u2705 Coste real: \u20ac5/mes (vs \u20ac455/mes estimado Multi-AKS) - \u2705 Deployment time: 6 mins (vs 65 mins Multi-AKS) - \u2705 Zero downtime en Dify durante implementaci\u00f3n - \u2705 Resource isolation efectivo con quotas - \u2705 Monitoring consolidado en Container Insights</p> <p>Recomendaci\u00f3n: Mantener Single-AKS Strategy hasta Phase 2 (&gt;85% utilization)</p>"},{"location":"architecture/single-aks/#referencias","title":"Referencias","text":"<ul> <li>Arquitectura Overview</li> <li>Recursos Desplegados</li> <li>An\u00e1lisis de Costes</li> <li>Kubernetes Best Practices</li> </ul>"},{"location":"cicd/deployment/","title":"Deployment Process","text":""},{"location":"cicd/deployment/#overview","title":"Overview","text":"<p>El proceso de deployment est\u00e1 completamente automatizado mediante GitHub Actions con m\u00faltiples gates de seguridad y aprobaci\u00f3n manual.</p>"},{"location":"cicd/deployment/#flujo-de-deployment","title":"Flujo de Deployment","text":"<pre><code>graph LR\n    Code[Code Change] --&gt; PR[Create PR]\n    PR --&gt; Validate[PR Validation&lt;br/&gt;7 Gates]\n    Validate --&gt; Review[Code Review]\n    Review --&gt; Merge[Merge to Master]\n    Merge --&gt; Manual[Manual Trigger]\n    Manual --&gt; Plan[Terraform Plan]\n    Plan --&gt; Approve[Manual Approval]\n    Approve --&gt; Apply[Terraform Apply]\n    Apply --&gt; Teams[Teams Notification]</code></pre>"},{"location":"cicd/deployment/#pasos-detallados","title":"Pasos Detallados","text":""},{"location":"cicd/deployment/#1-crear-pull-request","title":"1. Crear Pull Request","text":"<pre><code>git checkout -b feature/nueva-funcionalidad\n# Hacer cambios\ngit add .\ngit commit -m \"feat: Add new functionality\"\ngit push origin feature/nueva-funcionalidad\n</code></pre>"},{"location":"cicd/deployment/#2-validacion-automatica","title":"2. Validaci\u00f3n Autom\u00e1tica","text":"<p>PR triggers <code>pr-validation.yml</code>:</p> <ul> <li>\u2705 terraform fmt</li> <li>\u2705 terraform validate</li> <li>\u2705 tfsec</li> <li>\u2705 checkov</li> <li>\u2705 tflint</li> <li>\u2705 terraform plan</li> </ul>"},{"location":"cicd/deployment/#3-code-review","title":"3. Code Review","text":"<ul> <li>Revisar cambios</li> <li>Verificar Terraform plan</li> <li>Aprobar PR</li> </ul>"},{"location":"cicd/deployment/#4-merge-to-master","title":"4. Merge to Master","text":"<pre><code># Desde GitHub UI\nClick \"Merge pull request\"\n</code></pre>"},{"location":"cicd/deployment/#5-manual-deployment","title":"5. Manual Deployment","text":"<pre><code># GitHub UI \u2192 Actions \u2192 deploy.yml \u2192 Run workflow\nBranch: master\n</code></pre>"},{"location":"cicd/deployment/#6-terraform-plan","title":"6. Terraform Plan","text":"<p>Workflow genera plan y espera aprobaci\u00f3n.</p>"},{"location":"cicd/deployment/#7-manual-approval","title":"7. Manual Approval","text":"<p>Reviewer aprueba deployment en GitHub Actions.</p>"},{"location":"cicd/deployment/#8-terraform-apply","title":"8. Terraform Apply","text":"<p>Aplicar cambios a infraestructura.</p>"},{"location":"cicd/deployment/#9-notification","title":"9. Notification","text":"<p>Teams recibe notificaci\u00f3n con resultado.</p>"},{"location":"cicd/deployment/#comandos-utiles","title":"Comandos \u00datiles","text":""},{"location":"cicd/deployment/#deployment-local-testing","title":"Deployment Local (Testing)","text":"<pre><code>cd terraform/environments/hub\n\n# Initialize\nterraform init\n\n# Plan\nterraform plan -out=tfplan\n\n# Apply\nterraform apply tfplan\n</code></pre>"},{"location":"cicd/deployment/#rollback","title":"Rollback","text":"<pre><code># View state history\nterraform state list\n\n# Rollback specific resource\nterraform state rm &lt;resource&gt;\nterraform import &lt;resource&gt; &lt;azure-id&gt;\n</code></pre>"},{"location":"cicd/deployment/#referencias","title":"Referencias","text":"<ul> <li>Workflows Overview</li> <li>PR Validation</li> </ul>"},{"location":"cicd/drift-detection/","title":"Drift Detection","text":""},{"location":"cicd/drift-detection/#overview","title":"Overview","text":"<p>Workflow autom\u00e1tico que detecta cambios manuales en la infraestructura ejecut\u00e1ndose diariamente a las 05:00 UTC.</p>"},{"location":"cicd/drift-detection/#funcionamiento","title":"Funcionamiento","text":""},{"location":"cicd/drift-detection/#trigger","title":"Trigger","text":"<pre><code>on:\n  schedule:\n    - cron: '0 5 * * *'  # Daily at 05:00 UTC\n  workflow_dispatch:      # Manual trigger\n</code></pre>"},{"location":"cicd/drift-detection/#logica","title":"L\u00f3gica","text":"<ol> <li>Terraform plan con <code>-detailed-exitcode</code></li> <li>Verificar exit code:</li> <li><code>0</code> = No drift</li> <li><code>1</code> = Error</li> <li><code>2</code> = Drift detected</li> <li>Notificar Teams si drift</li> </ol>"},{"location":"cicd/drift-detection/#exit-codes","title":"Exit Codes","text":"Code Meaning Action 0 No changes \u2705 OK 1 Error \ud83d\udd34 Alert 2 Drift detected \u26a0\ufe0f Notify"},{"location":"cicd/drift-detection/#teams-notification","title":"Teams Notification","text":"<pre><code>{\n  \"title\": \"\u26a0\ufe0f Drift Detected\",\n  \"text\": \"Manual changes detected in infrastructure\",\n  \"facts\": [\n    {\"name\": \"Resources affected\", \"value\": \"3\"},\n    {\"name\": \"Last deployment\", \"value\": \"2025-01-15\"}\n  ]\n}\n</code></pre>"},{"location":"cicd/drift-detection/#resolucion","title":"Resoluci\u00f3n","text":""},{"location":"cicd/drift-detection/#opcion-1-import-changes","title":"Opci\u00f3n 1: Import Changes","text":"<pre><code>terraform import &lt;resource&gt; &lt;azure-id&gt;\nterraform plan  # Verify\ngit commit -m \"fix: Import manual changes\"\n</code></pre>"},{"location":"cicd/drift-detection/#opcion-2-revert-changes","title":"Opci\u00f3n 2: Revert Changes","text":"<pre><code>terraform apply  # Restore to state\n</code></pre>"},{"location":"cicd/drift-detection/#referencias","title":"Referencias","text":"<ul> <li>Workflows</li> </ul>"},{"location":"cicd/pr-validation/","title":"PR Validation","text":""},{"location":"cicd/pr-validation/#overview","title":"Overview","text":"<p>Todos los Pull Requests pasan por 7 security gates autom\u00e1ticos antes de poder hacer merge.</p>"},{"location":"cicd/pr-validation/#security-gates","title":"Security Gates","text":""},{"location":"cicd/pr-validation/#1-terraform-format","title":"1. Terraform Format","text":"<p>Tool: <code>terraform fmt -check -recursive</code></p> <p>Purpose: Garantizar formato consistente</p> <p>Fail Criteria: Archivos sin formato correcto</p>"},{"location":"cicd/pr-validation/#2-terraform-validate","title":"2. Terraform Validate","text":"<p>Tool: <code>terraform validate</code></p> <p>Purpose: Validar sintaxis HCL</p> <p>Fail Criteria: Errores de sintaxis</p>"},{"location":"cicd/pr-validation/#3-tfsec","title":"3. TFSec","text":"<p>Tool: <code>tfsec .</code></p> <p>Purpose: Security scanning</p> <p>Fail Criteria: Issues CRITICAL o HIGH</p>"},{"location":"cicd/pr-validation/#4-checkov","title":"4. Checkov","text":"<p>Tool: <code>checkov -d .</code></p> <p>Purpose: Policy compliance</p> <p>Fail Criteria: Policy violations</p>"},{"location":"cicd/pr-validation/#5-tflint","title":"5. TFLint","text":"<p>Tool: <code>tflint</code></p> <p>Purpose: Linting avanzado</p> <p>Fail Criteria: Errores o warnings</p>"},{"location":"cicd/pr-validation/#6-terraform-plan","title":"6. Terraform Plan","text":"<p>Tool: <code>terraform plan</code></p> <p>Purpose: Preview de cambios</p> <p>Output: Plan en PR comment</p>"},{"location":"cicd/pr-validation/#7-pr-comment","title":"7. PR Comment","text":"<p>Tool: GitHub API</p> <p>Purpose: Publicar resultados</p> <p>Content: Resumen de todos los gates</p>"},{"location":"cicd/pr-validation/#ejemplo-de-output","title":"Ejemplo de Output","text":"<pre><code>## \ud83d\udd0d PR Validation Results\n\n\u2705 **Format Check**: PASSED\n\u2705 **Validation**: PASSED\n\u2705 **TFSec**: 0 critical issues\n\u2705 **Checkov**: All policies passed\n\u2705 **TFLint**: PASSED\n\n## \ud83d\udccb Terraform Plan\n\n7 to add, 0 to change, 0 to destroy\n</code></pre>"},{"location":"cicd/pr-validation/#referencias","title":"Referencias","text":"<ul> <li>Workflows</li> <li>Security Gates</li> </ul>"},{"location":"cicd/security/","title":"Security Gates","text":""},{"location":"cicd/security/#overview","title":"Overview","text":"<p>7 security gates configurados para garantizar calidad y seguridad del c\u00f3digo Infrastructure-as-Code.</p>"},{"location":"cicd/security/#gates-implementados","title":"Gates Implementados","text":""},{"location":"cicd/security/#1-format-check","title":"1. Format Check","text":"<p>Tool: terraform fmt</p> <p>Command: <code>terraform fmt -check -recursive</code></p> <p>Purpose: C\u00f3digo con formato consistente</p>"},{"location":"cicd/security/#2-syntax-validation","title":"2. Syntax Validation","text":"<p>Tool: terraform validate</p> <p>Command: <code>terraform validate</code></p> <p>Purpose: Sintaxis HCL correcta</p>"},{"location":"cicd/security/#3-security-scanning","title":"3. Security Scanning","text":"<p>Tool: tfsec</p> <p>Command: <code>tfsec . --minimum-severity HIGH</code></p> <p>Checks:</p> <ul> <li>Encryption at rest</li> <li>Network security</li> <li>Access controls</li> <li>Secret management</li> </ul>"},{"location":"cicd/security/#4-policy-compliance","title":"4. Policy Compliance","text":"<p>Tool: checkov</p> <p>Command: <code>checkov -d . --framework terraform</code></p> <p>Policies:</p> <ul> <li>Resource tagging</li> <li>Naming conventions</li> <li>Cost controls</li> <li>Security baselines</li> </ul>"},{"location":"cicd/security/#5-advanced-linting","title":"5. Advanced Linting","text":"<p>Tool: tflint</p> <p>Command: <code>tflint --recursive</code></p> <p>Checks:</p> <ul> <li>Best practices</li> <li>Provider-specific rules</li> <li>Module usage</li> </ul>"},{"location":"cicd/security/#6-infrastructure-preview","title":"6. Infrastructure Preview","text":"<p>Tool: terraform plan</p> <p>Command: <code>terraform plan -out=tfplan</code></p> <p>Output: Cambios propuestos</p>"},{"location":"cicd/security/#7-manual-approval","title":"7. Manual Approval","text":"<p>Type: Human gate</p> <p>Purpose: Verificaci\u00f3n final antes de apply</p>"},{"location":"cicd/security/#metricas","title":"M\u00e9tricas","text":""},{"location":"cicd/security/#ultimos-30-dias","title":"\u00daltimos 30 D\u00edas","text":"<ul> <li>Security issues prevented: 12</li> <li>Policy violations caught: 8</li> <li>PRs blocked: 3</li> <li>False positives: 2</li> </ul>"},{"location":"cicd/security/#referencias","title":"Referencias","text":"<ul> <li>Workflows</li> <li>PR Validation</li> </ul>"},{"location":"cicd/workflows/","title":"CI/CD Workflows","text":""},{"location":"cicd/workflows/#introduccion","title":"Introducci\u00f3n","text":"<p>Este proyecto utiliza GitHub Actions como plataforma CI/CD con 5 workflows activos que automatizan el ciclo completo de vida de la infraestructura.</p>"},{"location":"cicd/workflows/#workflows-activos","title":"Workflows Activos","text":""},{"location":"cicd/workflows/#1-production-deployment-deployyml","title":"1. Production Deployment (<code>deploy.yml</code>)","text":"<p>Trigger: Manual (workflow_dispatch)</p> <p>Prop\u00f3sito: Despliegue controlado a producci\u00f3n con aprobaci\u00f3n manual.</p> <p>Pasos:</p> <ol> <li>Checkout: Obtener c\u00f3digo fuente</li> <li>Azure Login: Autenticaci\u00f3n v\u00eda OIDC</li> <li>Terraform Init: Inicializar backend</li> <li>Terraform Plan: Preview de cambios</li> <li>Manual Approval: Gate humano requerido</li> <li>Terraform Apply: Aplicar cambios</li> <li>Teams Notification: Notificar resultado</li> </ol> <p>Configuraci\u00f3n OIDC:</p> <pre><code>- name: Azure Login\n  uses: azure/login@v1\n  with:\n    client-id: ${{ secrets.AZURE_CLIENT_ID }}\n    tenant-id: ${{ secrets.AZURE_TENANT_ID }}\n    subscription-id: ${{ secrets.AZURE_SUBSCRIPTION_ID }}\n</code></pre> <p>Teams Notification:</p> <pre><code>- name: Notify Teams\n  env:\n    TEAMS_WEBHOOK_URL: ${{ secrets.TEAMS_WEBHOOK_URL }}\n  run: |\n    curl -H \"Content-Type: application/json\" -d '{\n      \"type\": \"message\",\n      \"attachments\": [{ \n        \"contentType\": \"application/vnd.microsoft.card.adaptive\",\n        \"content\": { ... }\n      }]\n    }' $TEAMS_WEBHOOK_URL\n</code></pre>"},{"location":"cicd/workflows/#2-pr-validation-pr-validationyml","title":"2. PR Validation (<code>pr-validation.yml</code>)","text":"<p>Trigger: Pull Request a master</p> <p>Prop\u00f3sito: Validar calidad y seguridad del c\u00f3digo antes de merge.</p> <p>7 Security Gates:</p> <ol> <li>\u2705 terraform fmt: Validar formato de c\u00f3digo</li> <li>\u2705 terraform validate: Validar sintaxis</li> <li>\u2705 tfsec: Security scanning</li> <li>\u2705 checkov: Policy compliance</li> <li>\u2705 tflint: Linting avanzado</li> <li>\u2705 terraform plan: Preview de cambios</li> <li>\u2705 Comment PR: Resultados en PR comment</li> </ol> <p>Ejemplo de Ejecuci\u00f3n:</p> <pre><code>Run terraform fmt -check -recursive\n\u2705 Format check: PASSED\n\nRun terraform validate\n\u2705 Validation: PASSED\n\nRun tfsec .\n\u2705 Security scan: 0 critical issues\n\nRun checkov -d .\n\u2705 Compliance: All policies passed\n\nRun tflint\n\u2705 Linting: PASSED\n\nRun terraform plan\n\u2705 Plan: 0 to add, 0 to change, 0 to destroy\n</code></pre>"},{"location":"cicd/workflows/#3-drift-detection-drift-detectionyml","title":"3. Drift Detection (<code>drift-detection.yml</code>)","text":"<p>Trigger: Cron schedule (daily at 05:00 UTC)</p> <p>Prop\u00f3sito: Detectar cambios manuales en infraestructura.</p> <p>L\u00f3gica:</p> <pre><code>- name: Terraform Plan\n  run: terraform plan -detailed-exitcode\n  continue-on-error: true\n  id: plan\n\n- name: Check for Drift\n  if: steps.plan.outputs.exitcode == 2\n  run: |\n    echo \"\u26a0\ufe0f DRIFT DETECTED\"\n    # Notify Teams\n</code></pre> <p>Exit Codes:</p> <ul> <li><code>0</code> = No changes (OK)</li> <li><code>1</code> = Error</li> <li><code>2</code> = Changes detected (DRIFT)</li> </ul>"},{"location":"cicd/workflows/#4-github-pages-gh-pagesyml","title":"4. GitHub Pages (<code>gh-pages.yml</code>)","text":"<p>Trigger: Push to master (paths: docs/, mkdocs.yml)</p> <p>Prop\u00f3sito: Desplegar documentaci\u00f3n autom\u00e1ticamente.</p> <p>Pasos:</p> <ol> <li>Checkout con fetch-depth: 0</li> <li>Setup Python 3.11</li> <li>Install mkdocs dependencies</li> <li>Build documentation</li> <li>Deploy to gh-pages branch</li> </ol> <p>Deployment:</p> <pre><code>- name: Deploy to GitHub Pages\n  run: mkdocs gh-deploy --force --clean --verbose\n</code></pre>"},{"location":"cicd/workflows/#5-legacy-workflows","title":"5. Legacy Workflows","text":"<ul> <li>terraform-deploy.yml: Deployment alternativo (deprecated soon)</li> <li>terraform-pr.yml: PR validation alternativo (deprecated soon)</li> </ul> <p>Recomendaci\u00f3n: Migrar a deploy.yml y pr-validation.yml</p>"},{"location":"cicd/workflows/#secretos-configurados","title":"Secretos Configurados","text":"Secret Tipo Uso <code>AZURE_CLIENT_ID</code> OIDC App ID Autenticaci\u00f3n Azure <code>AZURE_TENANT_ID</code> Tenant ID Autenticaci\u00f3n Azure AD <code>AZURE_SUBSCRIPTION_ID</code> Subscription ID Target subscription <code>TEAMS_WEBHOOK_URL</code> Webhook URL Notificaciones Teams <p>Configuraci\u00f3n: Settings \u2192 Secrets and variables \u2192 Actions</p>"},{"location":"cicd/workflows/#metricas-y-performance","title":"M\u00e9tricas y Performance","text":""},{"location":"cicd/workflows/#tiempos-de-ejecucion","title":"Tiempos de Ejecuci\u00f3n","text":"Workflow Avg Duration Success Rate deploy.yml 8-10 mins 100% pr-validation.yml 3-5 mins 98% drift-detection.yml 2-3 mins 100% gh-pages.yml 1-2 mins 100%"},{"location":"cicd/workflows/#estadisticas-ultimos-30-dias","title":"Estad\u00edsticas \u00daltimos 30 D\u00edas","text":"<ul> <li>Deployments: 12</li> <li>PRs validados: 25</li> <li>Drift detections: 30 (2 drifts encontrados)</li> <li>Security issues prevented: 5</li> </ul>"},{"location":"cicd/workflows/#best-practices","title":"Best Practices","text":""},{"location":"cicd/workflows/#workflow-design","title":"Workflow Design","text":"<ol> <li>Fail fast: Gates tempranos para errores r\u00e1pidos</li> <li>Idempotency: Workflows pueden re-ejecutarse sin efectos secundarios</li> <li>Artifact preservation: Terraform plans guardados como artifacts</li> <li>Notification strategy: Notificar solo en failures y deployments</li> </ol>"},{"location":"cicd/workflows/#security","title":"Security","text":"<ol> <li>OIDC over secrets: No almacenar credenciales de larga duraci\u00f3n</li> <li>Least privilege: Service Principal con permisos m\u00ednimos</li> <li>Secret scanning: GitHub secret scanning habilitado</li> <li>Audit logging: Todos los workflows logueados</li> </ol>"},{"location":"cicd/workflows/#troubleshooting","title":"Troubleshooting","text":""},{"location":"cicd/workflows/#common-issues","title":"Common Issues","text":"<p>Error: \"Azure Login Failed\"</p> <pre><code># Verificar OIDC configuration\naz ad app federated-credential list --id $APP_ID\n</code></pre> <p>Error: \"Terraform Plan Failed - Backend Lock\"</p> <pre><code># Forzar unlock si necesario\nterraform force-unlock &lt;lock-id&gt;\n</code></pre> <p>Error: \"Teams Notification Failed\"</p> <pre><code># Verificar webhook URL\ncurl -X POST $TEAMS_WEBHOOK_URL -d '{\"text\":\"test\"}'\n</code></pre>"},{"location":"cicd/workflows/#referencias","title":"Referencias","text":"<ul> <li>Deployment Process</li> <li>PR Validation Details</li> <li>Security Gates</li> <li>Drift Detection</li> </ul>"},{"location":"costs/analysis/","title":"An\u00e1lisis de Costes","text":""},{"location":"costs/analysis/#resumen-ejecutivo","title":"Resumen Ejecutivo","text":"M\u00e9trica Valor Coste Mensual Total \u20ac227 Coste Incremental (CloudMind) \u20ac5 Ahorro vs Multi-AKS \u20ac450/mes ROI Anual \u20ac5,400"},{"location":"costs/analysis/#desglose-de-costes","title":"Desglose de Costes","text":""},{"location":"costs/analysis/#infraestructura-existente-dify","title":"Infraestructura Existente (Dify)","text":"Recurso SKU/Tier Coste Mensual AKS Cluster (dify-aks) Standard_D2s_v3 (2 nodes) \u20ac200 PostgreSQL Flexible Server Burstable B1ms \u20ac15 Storage Account Standard LRS \u20ac5 Key Vault Standard \u20ac2 Virtual Network Standard \u20ac0 Container Insights Free tier \u20ac0 SUBTOTAL \u20ac222"},{"location":"costs/analysis/#recursos-nuevos-cloudmind","title":"Recursos Nuevos (CloudMind)","text":"Recurso SKU/Tier Coste Mensual Resource Groups (2) N/A \u20ac0 Azure Container Registry Basic \u20ac5 Namespace cloudmind N/A \u20ac0 Resource Quotas N/A \u20ac0 Role Assignments N/A \u20ac0 SUBTOTAL \u20ac5 <p>TOTAL: \u20ac227/mes (\u20ac5 incremental)</p>"},{"location":"costs/analysis/#comparativa-de-arquitecturas","title":"Comparativa de Arquitecturas","text":""},{"location":"costs/analysis/#opcion-a-multi-aks-descartada","title":"Opci\u00f3n A: Multi-AKS (Descartada)","text":"<pre><code>Hub Subscription:\n\u251c\u2500\u2500 Hub AKS Cluster (Standard_D2s_v3 \u00d7 2)    \u20ac200\n\u251c\u2500\u2500 PostgreSQL Flexible Server               \u20ac15\n\u251c\u2500\u2500 Azure Firewall                           \u20ac120\n\u2514\u2500\u2500 VPN Gateway                              \u20ac30\n    SUBTOTAL:                                \u20ac365\n\nSpoke-Prod Subscription:\n\u251c\u2500\u2500 Spoke AKS Cluster (Standard_D2s_v3 \u00d7 2)  \u20ac200\n\u251c\u2500\u2500 Container Insights                       \u20ac25\n\u2514\u2500\u2500 Load Balancer                            \u20ac20\n    SUBTOTAL:                                \u20ac245\n\nSpoke-Dev Subscription:\n\u251c\u2500\u2500 Spoke AKS Cluster (Standard_B2s \u00d7 2)     \u20ac90\n\u2514\u2500\u2500 Container Insights                       \u20ac25\n    SUBTOTAL:                                \u20ac115\n\nTOTAL MULTI-AKS:                             \u20ac725/mes\n</code></pre>"},{"location":"costs/analysis/#opcion-b-single-aks-implementada","title":"Opci\u00f3n B: Single-AKS (Implementada)","text":"<pre><code>Existing Infrastructure (Dify):\n\u251c\u2500\u2500 AKS Cluster (shared)                     \u20ac200\n\u251c\u2500\u2500 PostgreSQL (shared)                      \u20ac15\n\u251c\u2500\u2500 Storage (shared)                         \u20ac5\n\u2514\u2500\u2500 Others                                   \u20ac2\n    SUBTOTAL EXISTING:                       \u20ac222\n\nNew Resources (CloudMind):\n\u2514\u2500\u2500 ACR Basic                                \u20ac5\n    SUBTOTAL NEW:                            \u20ac5\n\nTOTAL SINGLE-AKS:                            \u20ac227/mes\n</code></pre>"},{"location":"costs/analysis/#ahorro","title":"Ahorro","text":"<pre><code>Multi-AKS:     \u20ac725/mes\nSingle-AKS:    \u20ac227/mes\n---------------\nAHORRO:        \u20ac498/mes (68.7%)\nROI Anual:     \u20ac5,976\n</code></pre>"},{"location":"costs/analysis/#proyeccion-de-costes","title":"Proyecci\u00f3n de Costes","text":""},{"location":"costs/analysis/#phase-1-application-deployment-2-meses","title":"Phase 1: Application Deployment (+2 meses)","text":"<pre><code>Recursos adicionales:\n\u251c\u2500\u2500 Load Balancer Standard                   \u20ac20\n\u251c\u2500\u2500 Public IP Standard                       \u20ac3\n\u2514\u2500\u2500 Managed Identities                       \u20ac0\n    INCREMENTO:                              \u20ac23/mes\n\nTOTAL PHASE 1:                               \u20ac250/mes\n</code></pre>"},{"location":"costs/analysis/#phase-2-scale-out-si-85-utilizacion","title":"Phase 2: Scale-out (si &gt;85% utilizaci\u00f3n)","text":"<pre><code>Trigger: Utilizaci\u00f3n cluster &gt;85% durante 7 d\u00edas\n\nRecursos adicionales:\n\u251c\u2500\u2500 Nuevo AKS Cluster                        \u20ac200\n\u251c\u2500\u2500 Container Insights adicional             \u20ac25\n\u2514\u2500\u2500 Additional storage                       \u20ac10\n    INCREMENTO:                              \u20ac235/mes\n\nTOTAL PHASE 2:                               \u20ac485/mes\n  (a\u00fan \u20ac240/mes menos que Multi-AKS original)\n</code></pre>"},{"location":"costs/analysis/#optimizaciones-aplicadas","title":"Optimizaciones Aplicadas","text":""},{"location":"costs/analysis/#1-shared-aks-cluster","title":"1. Shared AKS Cluster","text":"<p>Ahorro: \u20ac400/mes (2 clusters evitados)</p> <p>Estrategia: Namespace isolation con resource quotas</p>"},{"location":"costs/analysis/#2-free-tier-container-insights","title":"2. Free Tier Container Insights","text":"<p>Ahorro: \u20ac50/mes</p> <p>L\u00edmite: Primeros 10GB/mes gratis</p> <p>Uso actual: ~3GB/mes</p>"},{"location":"costs/analysis/#3-acr-basic-sku","title":"3. ACR Basic SKU","text":"<p>Ahorro: \u20ac15/mes vs Standard</p> <p>L\u00edmite: 10GB storage</p> <p>Uso actual: ~2GB</p>"},{"location":"costs/analysis/#4-shared-postgresql","title":"4. Shared PostgreSQL","text":"<p>Ahorro: \u20ac30/mes (1 instancia evitada)</p> <p>Estrategia: Schemas separados por proyecto</p>"},{"location":"costs/analysis/#monitorizac-ion-de-costes","title":"Monitorizac i\u00f3n de Costes","text":""},{"location":"costs/analysis/#azure-cost-management","title":"Azure Cost Management","text":"<pre><code># Ver costes \u00faltimos 30 d\u00edas\naz consumption usage list \\\n  --start-date $(date -d '30 days ago' +%Y-%m-%d) \\\n  --end-date $(date +%Y-%m-%d) \\\n  --query \"[].{Resource:instanceName, Cost:pretaxCost}\" \\\n  -o table\n</code></pre>"},{"location":"costs/analysis/#budget-alerts","title":"Budget Alerts","text":"<p>Configurados:</p> <ul> <li>\u26a0\ufe0f Warning at 80% (\u20ac182/mes)</li> <li>\ud83d\udd34 Critical at 100% (\u20ac227/mes)</li> <li>\ud83d\udea8 Exceeded at 120% (\u20ac272/mes)</li> </ul>"},{"location":"costs/analysis/#cost-anomaly-detection","title":"Cost Anomaly Detection","text":"<p>Habilitado: Azure Cost Management Anomaly Detection</p> <p>Notificaciones: Email + Teams</p>"},{"location":"costs/analysis/#referencias","title":"Referencias","text":"<ul> <li>Cost Optimization</li> <li>ROI Analysis</li> <li>Architecture</li> </ul>"},{"location":"costs/optimization/","title":"Optimizaci\u00f3n de Costes","text":""},{"location":"costs/optimization/#optimizaciones-implementadas","title":"Optimizaciones Implementadas","text":""},{"location":"costs/optimization/#1-single-aks-strategy","title":"1. Single-AKS Strategy","text":"<p>Ahorro: \u20ac400/mes</p> <p>Implementaci\u00f3n:</p> <ul> <li>Namespace isolation en cluster existente</li> <li>Resource quotas por namespace</li> <li>Shared Container Insights</li> </ul>"},{"location":"costs/optimization/#2-acr-basic-sku","title":"2. ACR Basic SKU","text":"<p>Ahorro: \u20ac15/mes vs Standard</p> <p>Rationale: PoC con &lt;5 im\u00e1genes</p> <p>Plan de Upgrade: Si &gt;8GB storage \u2192 Standard</p>"},{"location":"costs/optimization/#3-shared-resources","title":"3. Shared Resources","text":"<p>Recursos Compartidos:</p> <ul> <li>PostgreSQL: \u20ac30/mes ahorrado</li> <li>Storage Account: \u20ac10/mes ahorrado</li> <li>Key Vault: \u20ac5/mes ahorrado</li> </ul> <p>Total Ahorro: \u20ac45/mes</p>"},{"location":"costs/optimization/#oportunidades-futuras","title":"Oportunidades Futuras","text":""},{"location":"costs/optimization/#1-reserved-instances","title":"1. Reserved Instances","text":"<p>Potencial Ahorro: 30-50% en AKS nodes</p> <p>Requisito: Commitment de 1-3 a\u00f1os</p> <p>Aplicable a: Nodes permanentes</p>"},{"location":"costs/optimization/#2-spot-instances","title":"2. Spot Instances","text":"<p>Potencial Ahorro: Hasta 90% en workloads fault-tolerant</p> <p>Riesgo: Preemption possible</p> <p>Aplicable a: Dev/test workloads</p>"},{"location":"costs/optimization/#3-autoscaling","title":"3. Autoscaling","text":"<p>Potencial Ahorro: 20-40% en horas no-pico</p> <p>Implementaci\u00f3n: Horizontal Pod Autoscaler</p> <p>Status: Planificado Phase 2</p>"},{"location":"costs/optimization/#monitorizacion","title":"Monitorizaci\u00f3n","text":""},{"location":"costs/optimization/#cost-alerts","title":"Cost Alerts","text":"<pre><code>Alerts Configurados:\n  - Budget 80%: Warning\n  - Budget 100%: Critical\n  - Anomaly Detection: Enabled\n</code></pre>"},{"location":"costs/optimization/#weekly-review","title":"Weekly Review","text":"<pre><code># Script semanal de an\u00e1lisis\naz consumption usage list \\\n  --start-date $(date -d '7 days ago' +%Y-%m-%d) \\\n  --query \"[].{Resource:instanceName, Cost:pretaxCost}\" \\\n  -o table | sort -k2 -n -r\n</code></pre>"},{"location":"costs/optimization/#referencias","title":"Referencias","text":"<ul> <li>Cost Analysis</li> <li>ROI</li> </ul>"},{"location":"costs/roi/","title":"ROI - Return on Investment","text":""},{"location":"costs/roi/#resumen-ejecutivo","title":"Resumen Ejecutivo","text":"M\u00e9trica Valor Inversi\u00f3n Inicial \u20ac0 (usa infraestructura existente) Coste Operacional Mensual \u20ac5 incremental Ahorro Mensual vs Multi-AKS \u20ac450 ROI Anual \u20ac5,400 Payback Period Inmediato"},{"location":"costs/roi/#analisis-financiero","title":"An\u00e1lisis Financiero","text":""},{"location":"costs/roi/#comparativa-de-inversion","title":"Comparativa de Inversi\u00f3n","text":"<pre><code>OPCI\u00d3N A: Multi-AKS\n\u251c\u2500\u2500 Setup inicial: 40 horas \u00d7 \u20ac80/hora = \u20ac3,200\n\u251c\u2500\u2500 Coste mensual: \u20ac725\n\u2514\u2500\u2500 Coste anual: \u20ac8,700 + \u20ac3,200 = \u20ac11,900\n\nOPCI\u00d3N B: Single-AKS (Implementada)\n\u251c\u2500\u2500 Setup inicial: 20 horas \u00d7 \u20ac80/hora = \u20ac1,600\n\u251c\u2500\u2500 Coste mensual: \u20ac227 (\u20ac5 incremental)\n\u2514\u2500\u2500 Coste anual: \u20ac2,724 + \u20ac1,600 = \u20ac4,324\n\nAHORRO TOTAL A\u00d1O 1: \u20ac7,576\nAHORRO TOTAL A\u00d1O 2: \u20ac5,976 (sin setup)\n</code></pre>"},{"location":"costs/roi/#roi-operacional","title":"ROI Operacional","text":"<p>Time Savings:</p> Actividad Antes Ahora Ahorro \u20ac/hora Ahorro/mes Deployments 4h/sem 0.5h/sem 3.5h \u20ac80 \u20ac1,120 Security reviews 2h/sem 0h (auto) 2h \u20ac80 \u20ac640 Drift detection 0h 0h (auto) Manual avoid \u20ac80 \u20ac320 TOTAL 5.5h/sem \u20ac2,080/mes <p>Total ROI Operacional: \u20ac24,960/a\u00f1o</p>"},{"location":"costs/roi/#roi-total","title":"ROI Total","text":"<pre><code>Ahorro Infraestructura:   \u20ac5,400/a\u00f1o\nAhorro Operacional:      \u20ac24,960/a\u00f1o\n-------------------------\nTOTAL ROI:               \u20ac30,360/a\u00f1o\n</code></pre>"},{"location":"costs/roi/#metricas-de-productividad","title":"M\u00e9tricas de Productividad","text":""},{"location":"costs/roi/#deployments","title":"Deployments","text":"<p>Antes (Manual):</p> <ul> <li>Frecuencia: 1/semana</li> <li>Duraci\u00f3n: 2-4 horas</li> <li>Success rate: 85%</li> <li>Rollback time: 2 horas</li> </ul> <p>Ahora (Automatizado):</p> <ul> <li>Frecuencia: 5-10/semana</li> <li>Duraci\u00f3n: 10 minutos</li> <li>Success rate: 100%</li> <li>Rollback time: 10 minutos</li> </ul> <p>Mejora: 500% m\u00e1s deployments, 90% menos tiempo</p>"},{"location":"costs/roi/#security","title":"Security","text":"<p>Issues Prevenidos:</p> <ul> <li>Pre-merge: 12 issues</li> <li>Production incidents: 0</li> <li>Valor evitado: ~\u20ac10,000 (estimado)</li> </ul>"},{"location":"costs/roi/#proyeccion-3-anos","title":"Proyecci\u00f3n 3 A\u00f1os","text":"<pre><code>A\u00f1o 1:\n\u251c\u2500\u2500 Setup: -\u20ac1,600\n\u251c\u2500\u2500 Operaci\u00f3n: -\u20ac60 (\u20ac5/mes \u00d7 12)\n\u251c\u2500\u2500 Ahorro infra: +\u20ac5,400\n\u2514\u2500\u2500 Ahorro operacional: +\u20ac24,960\n    TOTAL A\u00d1O 1: +\u20ac28,700\n\nA\u00f1o 2:\n\u251c\u2500\u2500 Operaci\u00f3n: -\u20ac60\n\u251c\u2500\u2500 Ahorro infra: +\u20ac5,400\n\u2514\u2500\u2500 Ahorro operacional: +\u20ac24,960\n    TOTAL A\u00d1O 2: +\u20ac30,300\n\nA\u00f1o 3:\n\u251c\u2500\u2500 Operaci\u00f3n: -\u20ac60\n\u251c\u2500\u2500 Ahorro infra: +\u20ac5,400\n\u2514\u2500\u2500 Ahorro operacional: +\u20ac24,960\n    TOTAL A\u00d1O 3: +\u20ac30,300\n\nROI 3 A\u00d1OS: \u20ac89,300\n</code></pre>"},{"location":"costs/roi/#referencias","title":"Referencias","text":"<ul> <li>Cost Analysis</li> <li>Optimization</li> <li>Business Plan</li> </ul>"},{"location":"guides/migration/","title":"Migraci\u00f3n desde Terragrunt","text":""},{"location":"guides/migration/#overview","title":"Overview","text":"<p>Gu\u00eda para migraci\u00f3n futura de Terraform standalone a Terragrunt para gesti\u00f3n multi-subscription.</p>"},{"location":"guides/migration/#por-que-terragrunt","title":"Por Qu\u00e9 Terragrunt","text":""},{"location":"guides/migration/#beneficios","title":"Beneficios","text":"<ul> <li>DRY principle: No repetir c\u00f3digo backend</li> <li>Multi-env: Gesti\u00f3n simplificada de m\u00faltiples entornos</li> <li>Dependencies: Gesti\u00f3n autom\u00e1tica de dependencias entre m\u00f3dulos</li> <li>Remote state: Configuraci\u00f3n centralizada</li> </ul>"},{"location":"guides/migration/#estructura-propuesta","title":"Estructura Propuesta","text":"<pre><code>terragrunt/\n\u251c\u2500\u2500 terragrunt.hcl              # Root configuration\n\u251c\u2500\u2500 environments/\n\u2502   \u251c\u2500\u2500 hub/\n\u2502   \u2502   \u251c\u2500\u2500 terragrunt.hcl\n\u2502   \u2502   \u251c\u2500\u2500 acr/\n\u2502   \u2502   \u2502   \u2514\u2500\u2500 terragrunt.hcl\n\u2502   \u2502   \u2514\u2500\u2500 aks/\n\u2502   \u2502       \u2514\u2500\u2500 terragrunt.hcl\n\u2502   \u251c\u2500\u2500 spoke-prod/\n\u2502   \u2502   \u2514\u2500\u2500 terragrunt.hcl\n\u2502   \u2514\u2500\u2500 spoke-dev/\n\u2502       \u2514\u2500\u2500 terragrunt.hcl\n\u2514\u2500\u2500 modules/\n    \u251c\u2500\u2500 container-registry/\n    \u2514\u2500\u2500 aks-namespaces/\n</code></pre>"},{"location":"guides/migration/#plan-de-migracion","title":"Plan de Migraci\u00f3n","text":""},{"location":"guides/migration/#phase-1-setup-terragrunt","title":"Phase 1: Setup Terragrunt","text":"<pre><code># Install Terragrunt\nbrew install terragrunt  # macOS\n# or\nwget https://github.com/gruntwork-io/terragrunt/releases/download/v0.50.0/terragrunt_linux_amd64\n</code></pre>"},{"location":"guides/migration/#phase-2-convert-configuration","title":"Phase 2: Convert Configuration","text":"<p>Root terragrunt.hcl:</p> <pre><code>remote_state {\n  backend = \"azurerm\"\n  config = {\n    resource_group_name  = \"terraform-state-rg\"\n    storage_account_name = \"tfstate${get_env(\"ENV\", \"hub\")}\"\n    container_name       = \"tfstate\"\n    key                  = \"${path_relative_to_include()}/terraform.tfstate\"\n  }\n}\n</code></pre>"},{"location":"guides/migration/#phase-3-migrate-modules","title":"Phase 3: Migrate Modules","text":"<p>Environment terragrunt.hcl:</p> <pre><code>include \"root\" {\n  path = find_in_parent_folders()\n}\n\nterraform {\n  source = \"../../../modules//container-registry\"\n}\n\ninputs = {\n  location = \"westeurope\"\n  environment = \"production\"\n}\n</code></pre>"},{"location":"guides/migration/#phase-4-test-migration","title":"Phase 4: Test Migration","text":"<pre><code>cd environments/hub/acr\nterragrunt plan\nterragrunt apply\n</code></pre>"},{"location":"guides/migration/#estado-actual","title":"Estado Actual","text":"<p>Prioridad: LOW (Single environment actualmente)</p> <p>Trigger: Cuando se a\u00f1adan spoke subscriptions</p>"},{"location":"guides/migration/#referencias","title":"Referencias","text":"<ul> <li>Terragrunt Documentation</li> <li>Architecture Overview</li> </ul>"},{"location":"guides/quick-start/","title":"\ud83d\ude80 Quick Start Guide","text":"<p>Esta gu\u00eda te ayudar\u00e1 a configurar y desplegar DXC Cloud Mind - Nirvana PoC en menos de 30 minutos.</p>"},{"location":"guides/quick-start/#prerrequisitos","title":"\ud83d\udccb Prerrequisitos","text":""},{"location":"guides/quick-start/#herramientas-requeridas","title":"Herramientas Requeridas","text":"Herramienta Versi\u00f3n Prop\u00f3sito Terraform 1.5.5+ Infrastructure as Code Azure CLI 2.50+ Azure authentication Git 2.40+ Version control WSL/Linux/macOS - Shell scripting"},{"location":"guides/quick-start/#permisos-requeridos","title":"Permisos Requeridos","text":"<ul> <li>\u2705 Acceso a Azure Subscription <code>739aaf91-5cb2-45a6-ab4f-abf883e9d3f7</code></li> <li>\u2705 Permisos de GitHub en repositorio <code>DXC_PoC_Nirvana</code></li> <li>\u2705 Service Principal configurado (o permisos para crearlo)</li> </ul>"},{"location":"guides/quick-start/#1-clonar-repositorio","title":"1\ufe0f\u20e3 Clonar Repositorio","text":"<pre><code># Clone the repository\ngit clone https://github.com/DXC-Technology-Spain/DXC_PoC_Nirvana.git\ncd DXC_PoC_Nirvana\n\n# Verify structure\nls -la\n</code></pre> <p>Expected output: <pre><code>.github/\ndocs/\nterraform/\nscripts/\nREADME.md\nmkdocs.yml\n...\n</code></pre></p>"},{"location":"guides/quick-start/#2-configurar-credenciales","title":"2\ufe0f\u20e3 Configurar Credenciales","text":""},{"location":"guides/quick-start/#opcion-a-usar-service-principal-existente","title":"Opci\u00f3n A: Usar Service Principal Existente","text":"<p>Si ya tienes el Service Principal configurado:</p> <pre><code># Verify Service Principal exists\naz ad sp show --id dc39d60b-cfc7-41c6-9fcb-3b29778bb03a\n\n# Login with your Azure account\naz login\n\n# Set subscription\naz account set --subscription 739aaf91-5cb2-45a6-ab4f-abf883e9d3f7\n</code></pre>"},{"location":"guides/quick-start/#opcion-b-crear-nuevo-service-principal","title":"Opci\u00f3n B: Crear Nuevo Service Principal","text":"<p>Si necesitas crear uno nuevo:</p> <pre><code># Create Service Principal with OIDC\naz ad sp create-for-rbac \\\n  --name \"github-actions-dxc-nirvana\" \\\n  --role Contributor \\\n  --scopes /subscriptions/739aaf91-5cb2-45a6-ab4f-abf883e9d3f7\n\n# Save the output (you'll need appId and tenant)\n</code></pre> <p>Ver Gu\u00eda Completa de Secretos para m\u00e1s detalles.</p>"},{"location":"guides/quick-start/#3-configurar-github-secrets","title":"3\ufe0f\u20e3 Configurar GitHub Secrets","text":""},{"location":"guides/quick-start/#acceder-a-github-settings","title":"Acceder a GitHub Settings","text":"<ol> <li>Ve a: <code>https://github.com/DXC-Technology-Spain/DXC_PoC_Nirvana</code></li> <li>Click en Settings \u2192 Secrets and variables \u2192 Actions</li> <li>Click New repository secret</li> </ol>"},{"location":"guides/quick-start/#agregar-secretos-requeridos","title":"Agregar Secretos Requeridos","text":"Secret Name Value Example <code>AZURE_CLIENT_ID</code> Service Principal App ID <code>dc39d60b-cfc7-41c6-9fcb-3b29778bb03a</code> <code>AZURE_TENANT_ID</code> Azure AD Tenant ID <code>93f33571-550f-43cf-b09f-cd331338d086</code> <code>AZURE_SUBSCRIPTION_ID</code> Subscription ID <code>739aaf91-5cb2-45a6-ab4f-abf883e9d3f7</code> <code>TEAMS_WEBHOOK_URL</code> Teams webhook URL <code>https://prod-XX.westeurope.logic...</code> <p>TEAMS_WEBHOOK_URL</p> <p>Para obtener el webhook URL de Teams:</p> <ol> <li>Teams \u2192 Canal \"DXC Cloud Mind - Nirvana\"</li> <li>\u22ef \u2192 Connectors \u2192 Incoming Webhook</li> <li>Configure \u2192 Copiar URL</li> </ol>"},{"location":"guides/quick-start/#4-validar-configuracion-local","title":"4\ufe0f\u20e3 Validar Configuraci\u00f3n Local","text":""},{"location":"guides/quick-start/#test-1-terraform-init","title":"Test 1: Terraform Init","text":"<pre><code>cd terraform/environments/hub\n\n# Initialize Terraform\nterraform init\n\n# Expected output:\n# Terraform has been successfully initialized!\n</code></pre>"},{"location":"guides/quick-start/#test-2-terraform-validate","title":"Test 2: Terraform Validate","text":"<pre><code># Validate configuration\nterraform validate\n\n# Expected output:\n# Success! The configuration is valid.\n</code></pre>"},{"location":"guides/quick-start/#test-3-terraform-plan","title":"Test 3: Terraform Plan","text":"<pre><code># Plan changes (dry-run)\nterraform plan\n\n# Review the output\n# Should show resources to be created\n</code></pre>"},{"location":"guides/quick-start/#5-desplegar-con-github-actions-recomendado","title":"5\ufe0f\u20e3 Desplegar con GitHub Actions (Recomendado)","text":""},{"location":"guides/quick-start/#opcion-a-via-web-ui","title":"Opci\u00f3n A: Via Web UI","text":"<ol> <li>Go to Actions tab</li> <li>Select workflow: \ud83d\ude80 Deploy Infrastructure</li> <li>Click Run workflow</li> <li>Select environment: <code>hub</code></li> <li>Auto approve: <code>false</code> (require manual approval)</li> <li>Click Run workflow button</li> </ol>"},{"location":"guides/quick-start/#opcion-b-via-github-cli","title":"Opci\u00f3n B: Via GitHub CLI","text":"<pre><code># Install GitHub CLI\nbrew install gh  # macOS\n# or\nsudo apt install gh  # Ubuntu\n\n# Authenticate\ngh auth login\n\n# Trigger deployment\ngh workflow run \"deploy.yml\" \\\n  --repo DXC-Technology-Spain/DXC_PoC_Nirvana \\\n  -f environment=hub \\\n  -f auto_approve=false\n</code></pre>"},{"location":"guides/quick-start/#monitor-deployment","title":"Monitor Deployment","text":"<pre><code># View workflow runs\ngh run list --repo DXC-Technology-Spain/DXC_PoC_Nirvana\n\n# Watch specific run\ngh run watch &lt;run-id&gt;\n</code></pre>"},{"location":"guides/quick-start/#6-aprobar-deployment","title":"6\ufe0f\u20e3 Aprobar Deployment","text":""},{"location":"guides/quick-start/#cuando-el-workflow-alcance-manual-approval","title":"Cuando el workflow alcance \"Manual Approval\":","text":"<ol> <li>Se crear\u00e1 un GitHub Issue autom\u00e1ticamente</li> <li>Revisa el plan de Terraform en el issue</li> <li>Comenta en el issue:</li> <li><code>/approve</code> para aprobar</li> <li><code>/deny</code> para rechazar</li> </ol> <p>Plan Summary</p> <p>El issue incluir\u00e1:</p> <ul> <li>\u2795 Recursos a crear</li> <li>\ud83d\udd04 Recursos a modificar</li> <li>\u274c Recursos a destruir</li> <li>\ud83d\udd17 Link al workflow run</li> </ul>"},{"location":"guides/quick-start/#7-verificar-deployment","title":"7\ufe0f\u20e3 Verificar Deployment","text":""},{"location":"guides/quick-start/#check-azure-portal","title":"Check Azure Portal","text":"<pre><code># Open Azure Portal\naz portal\n</code></pre> <p>Navega a:</p> <ul> <li>Resource Group: <code>cloudmind-hub-rg</code></li> <li>Resource Group: <code>cloudmind-acr-rg</code></li> <li>Container Registry: <code>cloudmind&lt;suffix&gt;</code></li> </ul>"},{"location":"guides/quick-start/#check-terraform-outputs","title":"Check Terraform Outputs","text":"<pre><code>cd terraform/environments/hub\n\n# View outputs\nterraform output\n\n# Expected:\n# acr_login_server = \"cloudmindXXXXXX.azurecr.io\"\n# acr_name = \"cloudmindXXXXXX\"\n# cloudmind_namespace = \"cloudmind\"\n# dify_namespace = \"dify\"\n# hub_resource_group_name = \"cloudmind-hub-rg\"\n</code></pre>"},{"location":"guides/quick-start/#check-kubernetes-namespace","title":"Check Kubernetes Namespace","text":"<pre><code># Get AKS credentials\naz aks get-credentials \\\n  --resource-group dify-rg \\\n  --name dify-aks\n\n# List namespaces\nkubectl get namespaces\n\n# Expected output includes:\n# cloudmind    Active   X\n# dify         Active   X\n\n# Check resource quota\nkubectl describe resourcequota -n cloudmind\n</code></pre>"},{"location":"guides/quick-start/#8-test-teams-notifications","title":"8\ufe0f\u20e3 Test Teams Notifications","text":""},{"location":"guides/quick-start/#manual-test","title":"Manual Test","text":"<pre><code># Make script executable\nchmod +x scripts/test-teams-webhook.sh\n\n# Run test\nexport TEAMS_WEBHOOK_URL=\"&lt;your-webhook-url&gt;\"\n./scripts/test-teams-webhook.sh\n\n# Check Teams channel for 3 test messages\n</code></pre>"},{"location":"guides/quick-start/#deployment-exitoso","title":"\ud83c\udf89 \u00a1Deployment Exitoso!","text":"<p>Si todo funcion\u00f3 correctamente, deber\u00edas tener:</p> <ul> <li>\u2705 7 recursos creados en Azure</li> <li>\u2705 Namespace <code>cloudmind</code> en AKS con quotas</li> <li>\u2705 Azure Container Registry operacional</li> <li>\u2705 Workflow visible en GitHub Actions</li> <li>\u2705 Notificaci\u00f3n en Teams (si webhook configurado)</li> </ul>"},{"location":"guides/quick-start/#troubleshooting","title":"\ud83d\udd27 Troubleshooting","text":""},{"location":"guides/quick-start/#problema-1-terraform-init-falla","title":"Problema 1: Terraform Init Falla","text":"<p>Error: <code>Error: Failed to get existing workspaces</code></p> <p>Soluci\u00f3n: <pre><code># Verify Azure login\naz account show\n\n# Re-login if needed\naz login\n\n# Set correct subscription\naz account set --subscription 739aaf91-5cb2-45a6-ab4f-abf883e9d3f7\n</code></pre></p>"},{"location":"guides/quick-start/#problema-2-approval-no-aparece","title":"Problema 2: Approval No Aparece","text":"<p>S\u00edntoma: Workflow esperando approval pero no hay issue</p> <p>Soluci\u00f3n:</p> <ol> <li>Check GitHub \u2192 Issues tab</li> <li>Look for issue titled: \"\ud83d\ude80 Aprobar Deployment de Hub\"</li> <li>If not found, check workflow logs for errors</li> </ol>"},{"location":"guides/quick-start/#problema-3-teams-notification-no-llega","title":"Problema 3: Teams Notification No Llega","text":"<p>S\u00edntoma: Deployment exitoso pero sin notificaci\u00f3n</p> <p>Soluci\u00f3n:</p> <ol> <li>Ver Teams Troubleshooting Guide</li> <li>Ejecutar <code>scripts/test-teams-webhook.sh</code></li> <li>Verificar Power Automate flow status</li> </ol>"},{"location":"guides/quick-start/#proximos-pasos","title":"\ud83d\udcda Pr\u00f3ximos Pasos","text":"<p>Ahora que tienes la infraestructura desplegada:</p> <ol> <li>Explorar Arquitectura: Architecture Overview</li> <li>Entender CI/CD: Workflows Guide</li> <li>Revisar Costes: Cost Analysis</li> <li>Planear Use Cases: Roadmap</li> </ol>"},{"location":"guides/quick-start/#necesitas-ayuda","title":"\ud83c\udd98 Necesitas Ayuda?","text":"<ul> <li>GitHub Issues: Reportar problema</li> <li>Teams Channel: DXC Cloud Mind - Nirvana</li> <li>Contact: Alberto Lacambra</li> </ul> <p>Best Practice</p> <p>Siempre usa GitHub Actions para deployments de producci\u00f3n. Reserva deployments locales solo para testing y debugging.</p>"},{"location":"guides/secrets-setup/","title":"Configuraci\u00f3n de Secretos GitHub","text":""},{"location":"guides/secrets-setup/#overview","title":"Overview","text":"<p>Gu\u00eda para configurar los secretos necesarios en GitHub Actions para autenticaci\u00f3n con Azure y notificaciones Teams.</p>"},{"location":"guides/secrets-setup/#secretos-requeridos","title":"Secretos Requeridos","text":""},{"location":"guides/secrets-setup/#1-azure-oidc-authentication","title":"1. Azure OIDC Authentication","text":""},{"location":"guides/secrets-setup/#azure_client_id","title":"AZURE_CLIENT_ID","text":"<p>Descripci\u00f3n: Application (client) ID del Service Principal</p> <p>Obtenci\u00f3n:</p> <pre><code>az ad app list --display-name \"GitHub-OIDC-DXC-PoC-Nirvana\" --query \"[0].appId\" -o tsv\n</code></pre>"},{"location":"guides/secrets-setup/#azure_tenant_id","title":"AZURE_TENANT_ID","text":"<p>Descripci\u00f3n: Azure AD Tenant ID</p> <p>Obtenci\u00f3n:</p> <pre><code>az account show --query tenantId -o tsv\n</code></pre>"},{"location":"guides/secrets-setup/#azure_subscription_id","title":"AZURE_SUBSCRIPTION_ID","text":"<p>Descripci\u00f3n: Azure Subscription ID</p> <p>Obtenci\u00f3n:</p> <pre><code>az account show --query id -o tsv\n</code></pre>"},{"location":"guides/secrets-setup/#2-teams-notifications","title":"2. Teams Notifications","text":""},{"location":"guides/secrets-setup/#teams_webhook_url","title":"TEAMS_WEBHOOK_URL","text":"<p>Descripci\u00f3n: URL del Incoming Webhook de Teams</p> <p>Obtenci\u00f3n:</p> <ol> <li>Abrir Teams \u2192 Canal \u2192 \u22ef (More options)</li> <li>Connectors \u2192 Incoming Webhook</li> <li>Configurar \u2192 Copiar URL</li> </ol>"},{"location":"guides/secrets-setup/#configurar-en-github","title":"Configurar en GitHub","text":""},{"location":"guides/secrets-setup/#paso-1-navegar-a-settings","title":"Paso 1: Navegar a Settings","text":"<pre><code>GitHub Repo \u2192 Settings \u2192 Secrets and variables \u2192 Actions\n</code></pre>"},{"location":"guides/secrets-setup/#paso-2-anadir-secretos","title":"Paso 2: A\u00f1adir Secretos","text":"<pre><code>Click \"New repository secret\"\nName: AZURE_CLIENT_ID\nValue: &lt;paste value&gt;\nClick \"Add secret\"\n</code></pre> <p>Repetir para cada secreto.</p>"},{"location":"guides/secrets-setup/#paso-3-verificar","title":"Paso 3: Verificar","text":"<pre><code># En workflow:\n${{ secrets.AZURE_CLIENT_ID }}  # Debe estar disponible\n</code></pre>"},{"location":"guides/secrets-setup/#service-principal-setup","title":"Service Principal Setup","text":""},{"location":"guides/secrets-setup/#crear-service-principal","title":"Crear Service Principal","text":"<pre><code># Crear aplicaci\u00f3n\naz ad app create --display-name \"GitHub-OIDC-DXC-PoC-Nirvana\"\n\n# Obtener App ID\nAPP_ID=$(az ad app list --display-name \"GitHub-OIDC-DXC-PoC-Nirvana\" --query \"[0].appId\" -o tsv)\n\n# Crear Service Principal\naz ad sp create --id $APP_ID\n</code></pre>"},{"location":"guides/secrets-setup/#configurar-federated-credentials","title":"Configurar Federated Credentials","text":"<pre><code># Configurar OIDC para master branch\naz ad app federated-credential create \\\n  --id $APP_ID \\\n  --parameters '{\n    \"name\": \"github-oidc-master\",\n    \"issuer\": \"https://token.actions.githubusercontent.com\",\n    \"subject\": \"repo:AlbertoLacambra/DXC_PoC_Nirvana:ref:refs/heads/master\",\n    \"audiences\": [\"api://AzureADTokenExchange\"]\n  }'\n</code></pre>"},{"location":"guides/secrets-setup/#asignar-roles","title":"Asignar Roles","text":"<pre><code># Get Service Principal Object ID\nSP_ID=$(az ad sp list --display-name \"GitHub-OIDC-DXC-PoC-Nirvana\" --query \"[0].id\" -o tsv)\n\n# Assign Contributor role to subscription\naz role assignment create \\\n  --assignee $SP_ID \\\n  --role Contributor \\\n  --scope /subscriptions/&lt;SUBSCRIPTION_ID&gt;\n</code></pre>"},{"location":"guides/secrets-setup/#verificacion","title":"Verificaci\u00f3n","text":""},{"location":"guides/secrets-setup/#test-oidc-authentication","title":"Test OIDC Authentication","text":"<pre><code># .github/workflows/test-auth.yml\nname: Test Azure Authentication\non: workflow_dispatch\n\njobs:\n  test:\n    runs-on: ubuntu-latest\n    steps:\n      - name: Azure Login\n        uses: azure/login@v1\n        with:\n          client-id: ${{ secrets.AZURE_CLIENT_ID }}\n          tenant-id: ${{ secrets.AZURE_TENANT_ID }}\n          subscription-id: ${{ secrets.AZURE_SUBSCRIPTION_ID }}\n\n      - name: Test Access\n        run: az account show\n</code></pre>"},{"location":"guides/secrets-setup/#test-teams-webhook","title":"Test Teams Webhook","text":"<pre><code>curl -H \"Content-Type: application/json\" \\\n  -d '{\"text\":\"Test notification\"}' \\\n  $TEAMS_WEBHOOK_URL\n</code></pre>"},{"location":"guides/secrets-setup/#troubleshooting","title":"Troubleshooting","text":""},{"location":"guides/secrets-setup/#error-aadsts700016-application-not-found","title":"Error: \"AADSTS700016: Application not found\"","text":"<p>Causa: App ID incorrecto o aplicaci\u00f3n eliminada</p> <p>Soluci\u00f3n: Verificar que la aplicaci\u00f3n existe</p> <pre><code>az ad app show --id $APP_ID\n</code></pre>"},{"location":"guides/secrets-setup/#error-failed-to-get-federated-token","title":"Error: \"Failed to get federated token\"","text":"<p>Causa: Configuraci\u00f3n OIDC incorrecta</p> <p>Soluci\u00f3n: Verificar federated credentials</p> <pre><code>az ad app federated-credential list --id $APP_ID\n</code></pre>"},{"location":"guides/secrets-setup/#referencias","title":"Referencias","text":"<ul> <li>Azure OIDC Documentation</li> <li>Teams Webhook Guide</li> <li>Workflows</li> </ul>"},{"location":"guides/teams-troubleshooting/","title":"Troubleshooting Teams Notifications","text":""},{"location":"guides/teams-troubleshooting/#problemas-comunes","title":"Problemas Comunes","text":""},{"location":"guides/teams-troubleshooting/#1-no-llegan-notificaciones","title":"1. No Llegan Notificaciones","text":""},{"location":"guides/teams-troubleshooting/#verificar-webhook-url","title":"Verificar Webhook URL","text":"<pre><code># Test b\u00e1sico\ncurl -H \"Content-Type: application/json\" \\\n  -d '{\"text\":\"Test\"}' \\\n  $TEAMS_WEBHOOK_URL\n\n# Respuesta esperada: \"1\"\n</code></pre>"},{"location":"guides/teams-troubleshooting/#verificar-secret-en-github","title":"Verificar Secret en GitHub","text":"<pre><code># GitHub Repo \u2192 Settings \u2192 Secrets \u2192 Actions\n# Verificar que TEAMS_WEBHOOK_URL existe\n</code></pre>"},{"location":"guides/teams-troubleshooting/#verificar-workflow-configuration","title":"Verificar Workflow Configuration","text":"<pre><code>- name: Notify Teams\n  env:\n    TEAMS_WEBHOOK_URL: ${{ secrets.TEAMS_WEBHOOK_URL }}\n  run: |\n    # Verificar que la variable est\u00e1 disponible\n    echo \"URL length: ${#TEAMS_WEBHOOK_URL}\"\n</code></pre>"},{"location":"guides/teams-troubleshooting/#2-notificaciones-incompletas","title":"2. Notificaciones Incompletas","text":""},{"location":"guides/teams-troubleshooting/#verificar-formato-adaptive-card","title":"Verificar Formato Adaptive Card","text":"<pre><code>{\n  \"type\": \"message\",\n  \"attachments\": [{\n    \"contentType\": \"application/vnd.microsoft.card.adaptive\",\n    \"content\": {\n      \"type\": \"AdaptiveCard\",\n      \"$schema\": \"http://adaptivecards.io/schemas/adaptive-card.json\",\n      \"version\": \"1.4\",\n      \"body\": [...]\n    }\n  }]\n}\n</code></pre>"},{"location":"guides/teams-troubleshooting/#test-con-script","title":"Test con Script","text":"<pre><code># Ejecutar test script\nexport TEAMS_WEBHOOK_URL=\"&lt;your-webhook-url&gt;\"\n./scripts/test-teams-webhook.sh\n</code></pre>"},{"location":"guides/teams-troubleshooting/#3-error-400-bad-request","title":"3. Error 400 Bad Request","text":"<p>Causa: JSON malformado</p> <p>Soluci\u00f3n: Validar JSON</p> <pre><code># Validar JSON antes de enviar\necho $JSON | jq .\n</code></pre>"},{"location":"guides/teams-troubleshooting/#4-error-403-forbidden","title":"4. Error 403 Forbidden","text":"<p>Causa: Webhook URL expirado o eliminado</p> <p>Soluci\u00f3n: Regenerar webhook en Teams</p> <ol> <li>Teams \u2192 Canal \u2192 \u22ef \u2192 Connectors</li> <li>Incoming Webhook \u2192 Configure</li> <li>Regenerar URL</li> </ol>"},{"location":"guides/teams-troubleshooting/#diagnostico","title":"Diagn\u00f3stico","text":""},{"location":"guides/teams-troubleshooting/#script-de-diagnostico","title":"Script de Diagn\u00f3stico","text":"<pre><code>#!/bin/bash\n# diagnose-teams.sh\n\necho \"1. Testing webhook URL...\"\nRESPONSE=$(curl -s -o /dev/null -w \"%{http_code}\" \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\"text\":\"test\"}' \\\n  $TEAMS_WEBHOOK_URL)\n\nif [ \"$RESPONSE\" = \"200\" ]; then\n  echo \"\u2705 Webhook is accessible\"\nelse\n  echo \"\u274c Webhook returned: $RESPONSE\"\nfi\n\necho \"2. Testing from workflow...\"\ngh workflow run deploy.yml\n</code></pre>"},{"location":"guides/teams-troubleshooting/#logs-de-github-actions","title":"Logs de GitHub Actions","text":"<pre><code># Ver logs del \u00faltimo run\ngh run list --workflow=deploy.yml --limit 1\ngh run view &lt;run-id&gt; --log\n</code></pre>"},{"location":"guides/teams-troubleshooting/#referencias","title":"Referencias","text":"<ul> <li>Test Script</li> <li>Workflows</li> <li>Secrets Setup</li> </ul>"},{"location":"reference/github-actions/","title":"GitHub Actions Reference","text":""},{"location":"reference/github-actions/#workflows-disponibles","title":"Workflows Disponibles","text":""},{"location":"reference/github-actions/#deployyml","title":"deploy.yml","text":"<p>Trigger: Manual (workflow_dispatch)</p> <p>Purpose: Production deployment con aprobaci\u00f3n manual</p> <p>Jobs:</p> <ol> <li><code>deploy</code>: Terraform apply con manual gate</li> </ol> <p>Usage:</p> <pre><code>GitHub UI \u2192 Actions \u2192 deploy.yml \u2192 Run workflow\n</code></pre>"},{"location":"reference/github-actions/#pr-validationyml","title":"pr-validation.yml","text":"<p>Trigger: Pull request a master</p> <p>Purpose: 7 security gates validation</p> <p>Jobs:</p> <ol> <li><code>validate</code>: Run all security checks</li> <li><code>comment</code>: Post results to PR</li> </ol>"},{"location":"reference/github-actions/#drift-detectionyml","title":"drift-detection.yml","text":"<p>Trigger: Cron (daily 05:00 UTC) + manual</p> <p>Purpose: Detectar cambios manuales</p> <p>Jobs:</p> <ol> <li><code>detect</code>: Terraform plan con exit code check</li> </ol>"},{"location":"reference/github-actions/#gh-pagesyml","title":"gh-pages.yml","text":"<p>Trigger: Push to master (paths: docs/*, mkdocs.yml)</p> <p>Purpose: Deploy documentation</p> <p>Jobs:</p> <ol> <li><code>deploy</code>: Build and deploy MkDocs site</li> </ol>"},{"location":"reference/github-actions/#reusable-actions","title":"Reusable Actions","text":""},{"location":"reference/github-actions/#azureloginv1","title":"azure/login@v1","text":"<p>Purpose: Azure authentication via OIDC</p> <p>Usage:</p> <pre><code>- uses: azure/login@v1\n  with:\n    client-id: ${{ secrets.AZURE_CLIENT_ID }}\n    tenant-id: ${{ secrets.AZURE_TENANT_ID }}\n    subscription-id: ${{ secrets.AZURE_SUBSCRIPTION_ID }}\n</code></pre>"},{"location":"reference/github-actions/#hashicorpsetup-terraformv2","title":"hashicorp/setup-terraform@v2","text":"<p>Purpose: Install Terraform CLI</p> <p>Usage:</p> <pre><code>- uses: hashicorp/setup-terraform@v2\n  with:\n    terraform_version: 1.5.5\n</code></pre>"},{"location":"reference/github-actions/#actionssetup-pythonv5","title":"actions/setup-python@v5","text":"<p>Purpose: Install Python</p> <p>Usage:</p> <pre><code>- uses: actions/setup-python@v5\n  with:\n    python-version: '3.11'\n    cache: 'pip'\n</code></pre>"},{"location":"reference/github-actions/#custom-scripts","title":"Custom Scripts","text":""},{"location":"reference/github-actions/#teams-notification","title":"Teams Notification","text":"<p>Location: <code>.github/scripts/notify-teams.sh</code></p> <p>Purpose: Send Adaptive Card to Teams</p> <p>Usage:</p> <pre><code>./notify-teams.sh \"success\" \"Deployment completed\"\n</code></pre>"},{"location":"reference/github-actions/#environment-variables","title":"Environment Variables","text":""},{"location":"reference/github-actions/#required","title":"Required","text":"Variable Description Source <code>AZURE_CLIENT_ID</code> OIDC App ID Secret <code>AZURE_TENANT_ID</code> Tenant ID Secret <code>AZURE_SUBSCRIPTION_ID</code> Subscription ID Secret <code>TEAMS_WEBHOOK_URL</code> Webhook URL Secret"},{"location":"reference/github-actions/#optional","title":"Optional","text":"Variable Description Default <code>TF_VERSION</code> Terraform version 1.5.5 <code>WORKING_DIR</code> Working directory terraform/environments/hub"},{"location":"reference/github-actions/#referencias","title":"Referencias","text":"<ul> <li>Workflows Documentation</li> <li>Repository</li> </ul>"},{"location":"reference/links/","title":"Enlaces \u00datiles","text":""},{"location":"reference/links/#documentacion-del-proyecto","title":"Documentaci\u00f3n del Proyecto","text":"<ul> <li>GitHub Repository</li> <li>GitHub Pages</li> <li>Project Board</li> </ul>"},{"location":"reference/links/#azure-resources","title":"Azure Resources","text":""},{"location":"reference/links/#portal","title":"Portal","text":"<ul> <li>Azure Portal</li> <li>Subscription Overview</li> <li>AKS Cluster (dify-aks)</li> </ul>"},{"location":"reference/links/#documentation","title":"Documentation","text":"<ul> <li>Azure Kubernetes Service</li> <li>Azure Container Registry</li> <li>Azure OIDC for GitHub Actions</li> </ul>"},{"location":"reference/links/#terraform","title":"Terraform","text":""},{"location":"reference/links/#documentation_1","title":"Documentation","text":"<ul> <li>Terraform Official Docs</li> <li>AzureRM Provider</li> <li>Kubernetes Provider</li> </ul>"},{"location":"reference/links/#tools","title":"Tools","text":"<ul> <li>TFSec</li> <li>Checkov</li> <li>TFLint</li> <li>Terragrunt</li> </ul>"},{"location":"reference/links/#github-actions","title":"GitHub Actions","text":"<ul> <li>GitHub Actions Documentation</li> <li>Azure Login Action</li> <li>Setup Terraform Action</li> </ul>"},{"location":"reference/links/#microsoft-teams","title":"Microsoft Teams","text":"<ul> <li>Incoming Webhooks</li> <li>Adaptive Cards</li> <li>Adaptive Card Designer</li> </ul>"},{"location":"reference/links/#kubernetes","title":"Kubernetes","text":"<ul> <li>Kubernetes Documentation</li> <li>Resource Quotas</li> <li>Network Policies</li> <li>Namespaces</li> </ul>"},{"location":"reference/links/#mkdocs","title":"MkDocs","text":"<ul> <li>MkDocs</li> <li>Material for MkDocs</li> <li>Mermaid Diagrams</li> </ul>"},{"location":"reference/links/#tools-clis","title":"Tools &amp; CLIs","text":"<ul> <li>Azure CLI</li> <li>kubectl</li> <li>GitHub CLI</li> <li>jq</li> </ul>"},{"location":"reference/links/#community-support","title":"Community &amp; Support","text":"<ul> <li>Terraform Community</li> <li>Azure Community</li> <li>Kubernetes Community</li> </ul>"},{"location":"reference/links/#internal-resources","title":"Internal Resources","text":"<ul> <li>DXC Cloud Mind Channel</li> <li>Technical Documentation</li> <li>Cost Management Dashboard</li> </ul>"},{"location":"reference/terraform-modules/","title":"Terraform Modules","text":""},{"location":"reference/terraform-modules/#modulos-disponibles","title":"M\u00f3dulos Disponibles","text":""},{"location":"reference/terraform-modules/#1-container-registry","title":"1. container-registry","text":"<p>Path: <code>terraform/modules/container-registry</code></p> <p>Purpose: Azure Container Registry con role assignments</p> <p>Inputs:</p> Variable Type Description Default <code>location</code> string Azure region Required <code>resource_group_name</code> string RG name Required <code>aks_kubelet_identity_object_id</code> string AKS identity for AcrPull Required <code>enable_diagnostic_setting</code> bool Enable diagnostics false <code>log_analytics_workspace_id</code> string Workspace ID null <code>tags</code> map(string) Resource tags {} <p>Outputs:</p> Output Description <code>acr_id</code> ACR resource ID <code>acr_login_server</code> ACR login server URL <code>acr_name</code> ACR name <p>Usage:</p> <pre><code>module \"acr\" {\n  source = \"../../modules/container-registry\"\n\n  location            = \"westeurope\"\n  resource_group_name = azurerm_resource_group.acr.name\n  aks_kubelet_identity_object_id = data.azurerm_kubernetes_cluster.dify.kubelet_identity[0].object_id\n\n  tags = {\n    Environment = \"Production\"\n    Project     = \"CloudMind\"\n  }\n}\n</code></pre>"},{"location":"reference/terraform-modules/#2-aks-namespaces","title":"2. aks-namespaces","text":"<p>Path: <code>terraform/modules/aks-namespaces</code></p> <p>Purpose: Kubernetes namespace con resource quotas</p> <p>Inputs:</p> Variable Type Description Default <code>namespace_name</code> string K8s namespace name Required <code>cpu_requests</code> string CPU requests quota \"4\" <code>memory_requests</code> string Memory requests quota \"8Gi\" <code>cpu_limits</code> string CPU limits quota \"6\" <code>memory_limits</code> string Memory limits quota \"12Gi\" <code>pods</code> string Max pods \"30\" <p>Outputs:</p> Output Description <code>namespace_name</code> Created namespace name <code>resource_quota_name</code> Created quota name <p>Usage:</p> <pre><code>module \"cloudmind_namespace\" {\n  source = \"../../modules/aks-namespaces\"\n\n  namespace_name    = \"cloudmind\"\n  cpu_requests      = \"4\"\n  memory_requests   = \"8Gi\"\n  cpu_limits        = \"6\"\n  memory_limits     = \"12Gi\"\n  pods              = \"30\"\n}\n</code></pre>"},{"location":"reference/terraform-modules/#module-development-guidelines","title":"Module Development Guidelines","text":""},{"location":"reference/terraform-modules/#structure","title":"Structure","text":"<pre><code>module-name/\n\u251c\u2500\u2500 main.tf           # Resources\n\u251c\u2500\u2500 variables.tf      # Input variables\n\u251c\u2500\u2500 outputs.tf        # Output values\n\u251c\u2500\u2500 versions.tf       # Provider versions\n\u2514\u2500\u2500 README.md         # Documentation\n</code></pre>"},{"location":"reference/terraform-modules/#best-practices","title":"Best Practices","text":"<ol> <li>Versioning: Use semantic versioning</li> <li>Documentation: Auto-generate with terraform-docs</li> <li>Testing: Test modules before use</li> <li>Variables: Use sensible defaults</li> <li>Outputs: Expose useful values</li> </ol>"},{"location":"reference/terraform-modules/#example-module","title":"Example Module","text":"<pre><code># variables.tf\nvariable \"name\" {\n  description = \"Resource name\"\n  type        = string\n}\n\n# main.tf\nresource \"azurerm_resource_group\" \"this\" {\n  name     = var.name\n  location = \"westeurope\"\n}\n\n# outputs.tf\noutput \"id\" {\n  description = \"Resource group ID\"\n  value       = azurerm_resource_group.this.id\n}\n</code></pre>"},{"location":"reference/terraform-modules/#referencias","title":"Referencias","text":"<ul> <li>Container Registry Source</li> <li>AKS Namespaces Source</li> </ul>"}]}